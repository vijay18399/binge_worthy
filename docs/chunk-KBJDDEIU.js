import{a as Uh,b as pa,c as jh,d as os,e as zh,f as as,g as Gh,h as Kh,i as J,j as rn,k as te,l as us,m as Or,n as $h,o as Wh,p as Ce,q as kt}from"./chunk-KDVLCGCJ.js";import{$ as z,A as M,B as ns,C as nn,Ca as Oh,Da as is,Ea as Lh,F as Sh,G as Rh,Ga as qh,Ha as Bh,Ia as ss,K as bh,L as Bn,O as ma,S as j,V as Ph,W as Pe,Y as rt,_ as Ft,a as Ln,aa as $,b as wh,ba as rs,c as Ji,ca as Ch,d as vh,e as tn,ea as Un,f as qn,fa as Zt,g as Se,h as Re,i as gt,ia as ut,ja as qt,k as Ih,ka as xh,l as Mr,la as Dh,m as Eh,n as Th,o as Zi,p as ts,q as da,qa as kh,r as es,ra as Vh,s as me,sa as Nh,t as fa,ta as Fh,u as Ah,ua as Mh,wa as ga,x as be,y as en,z as bt}from"./chunk-3XNOP7I3.js";import{a as Ze,b as la,f as ha,g as p}from"./chunk-FXTXBT5Q.js";function u_(n,t){if(n&1&&(z(0,"span",13),ut(1),$()),n&2){let e=t.$implicit;j(1),qt(e)}}function c_(n,t){if(n&1&&(z(0,"span",17),ut(1),$()),n&2){let e=t.$implicit;j(1),qt(e)}}function l_(n,t){if(n&1&&(z(0,"div",10)(1,"span",14),ut(2,"Tags:"),$(),z(3,"span",15),Ft(4,c_,2,1,"span",16),$()()),n&2){let e=Zt(2);j(4),rt("ngForOf",e.content.tags)}}function h_(n,t){if(n&1&&(z(0,"div",1)(1,"span",14),ut(2,"Release Date:"),$(),z(3,"span"),ut(4),Vh(5,"date"),$()()),n&2){let e=Zt(2);j(4),qt(Nh(5,1,e.content.releaseDate,"medium"))}}function d_(n,t){if(n&1&&(z(0,"div",20),rs(1,"img",21),z(2,"span",22),ut(3),$()()),n&2){let e=t.$implicit;j(1),rt("src",e.profile||"assets/images/default-profile.png",ma),j(2),qt(e.name)}}function f_(n,t){if(n&1&&(z(0,"div",18),Ft(1,d_,4,2,"div",19),$()),n&2){let e=Zt(2);j(1),rt("ngForOf",e.content.actors)}}var m_=(n,t)=>({"bg-blue-500":n,"bg-gray-500":t});function g_(n,t){if(n&1){let e=Ch();z(0,"button",23),Un("click",function(){let s=Sh(e).index,o=Zt(2);return Rh(o.toggleSeason(s))}),ut(1),$()}if(n&2){let e=t.$implicit,r=t.index,i=Zt(2);rt("ngClass",kh(2,m_,e.number==i.activeSeason.number,e.number!=i.activeSeason.number)),j(1),qt("Season "+(r+1))}}function p_(n,t){if(n&1&&(z(0,"p",27),ut(1),$()),n&2){let e=Zt(3);j(1),qt(e.activeSeason.description)}}function __(n,t){if(n&1&&(z(0,"li",28)(1,"div",29)(2,"span"),ut(3),$(),z(4,"span"),rs(5,"i",30),ut(6," 5 Mar 2021 "),$()(),z(7,"h2",31),ut(8),$(),z(9,"p"),ut(10),$()()),n&2){let e=t.$implicit,r=t.index,i=Zt(3);j(3),qt("S"+i.activeSeason.number+"E"+(r+1)),j(5),qt(e.title),j(2),qt(e.description)}}function y_(n,t){if(n&1&&(z(0,"div",5)(1,"div"),Ft(2,p_,2,1,"p",24),z(3,"ul",25),Ft(4,__,11,3,"li",26),$()()()),n&2){let e=Zt(2);j(2),rt("ngIf",e.activeSeason.description),j(2),rt("ngForOf",e.activeSeason.episodes)}}function w_(n,t){if(n&1&&(z(0,"div",1),rs(1,"img",2),z(2,"div",3)(3,"h2",4),ut(4),$(),z(5,"div",5),Ft(6,u_,2,1,"span",6),$(),z(7,"p",7),ut(8),$(),z(9,"div",7),Ft(10,l_,5,1,"div",8)(11,h_,6,4,"div",0),$(),Ft(12,f_,2,1,"div",9),z(13,"div",7)(14,"div",10)(15,"div",1),Ft(16,g_,2,5,"button",11),$()(),Ft(17,y_,5,2,"div",12),$()()()),n&2){let e=Zt();j(1),rt("src",e.content.poster||"assets/images/no-poster.jpg",ma),j(3),qt(e.content.title),j(2),rt("ngForOf",e.content.genres),j(2),qt(e.content.plot),j(2),rt("ngIf",e.content.tags.length),j(1),rt("ngIf",e.content.releaseDate),j(1),rt("ngIf",e.content.actors.length),j(4),rt("ngForOf",e.content.seasons),j(1),rt("ngIf",e.activeSeason)}}var lI=(()=>{let t=class t{toggleSeason(r){this.activeSeason=this.content.seasons[r]}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=ns({type:t,selectors:[["content-info"]],inputs:{content:"content"},decls:1,vars:1,consts:[["class","flex",4,"ngIf"],[1,"flex"],["alt","",1,"w-72","h-full","border-r","border-gray-200",3,"src"],[1,"flex","flex-col","sticky","top-0","pt-8","pl-8","w-full"],[1,"text-2xl","font-bold","text-black","mb-4"],[1,"mb-4"],["class","inline-flex items-center m-2 p-2 rounded-md font-medium text-gray-700 bg-gray-100",4,"ngFor","ngForOf"],[1,"mb-8"],["class","flex mb-4",4,"ngIf"],["class","flex flex-wrap mb-8",4,"ngIf"],[1,"flex","mb-4"],["class","px-4 py-2 mr-2 rounded-md text-white font-semibold ",3,"ngClass","click",4,"ngFor","ngForOf"],["class","mb-4",4,"ngIf"],[1,"inline-flex","items-center","m-2","p-2","rounded-md","font-medium","text-gray-700","bg-gray-100"],[1,"font-bold","mr-2"],[1,"flex","flex-wrap"],["class","inline-flex items-center m-1 p-2 rounded-md text-gray-700 bg-gray-100",4,"ngFor","ngForOf"],[1,"inline-flex","items-center","m-1","p-2","rounded-md","text-gray-700","bg-gray-100"],[1,"flex","flex-wrap","mb-8"],["class","flex items-center mr-4 mb-4",4,"ngFor","ngForOf"],[1,"flex","items-center","mr-4","mb-4"],["alt","",1,"w-10","h-10","rounded-full","object-cover","mr-2",3,"src"],[1,"text-sm"],[1,"px-4","py-2","mr-2","rounded-md","text-white","font-semibold",3,"ngClass","click"],["class","border-2 border-dotted border-indigo-700 p-4 rounded-md bg-indigo-100",4,"ngIf"],[1,"list-none","p-0","m-0"],["class","border-2 border-solid border-gray-300 rounded-md p-4 mt-4",4,"ngFor","ngForOf"],[1,"border-2","border-dotted","border-indigo-700","p-4","rounded-md","bg-indigo-100"],[1,"border-2","border-solid","border-gray-300","rounded-md","p-4","mt-4"],[1,"flex","justify-between","mb-2"],[1,"fa-solid","fa-calendar-days"],[1,"text-lg","font-semibold","mb-2"]],template:function(i,s){i&1&&Ft(0,w_,18,9,"div",0),i&2&&rt("ngIf",s.content)},dependencies:[Oh,is,Lh,qh]});let n=t;return n})();function v_(n,t){if(n&1&&(z(0,"option",7),ut(1),$()),n&2){let e=t.$implicit;rt("value",e),j(1),xh(" ",e," ")}}var pI=(()=>{let t=class t{constructor(){this.totalItems=0,this.pageSize=1,this.currentPage=1,this.pageChange=new Ph}get totalPages(){return Math.ceil(this.totalItems/this.pageSize)}get pageList(){return Array(this.totalPages).fill(0).map((r,i)=>i+1)}gotToPage(r){console.log(r,"wwd"),r>=1&&r<=this.totalPages&&(console.log(r,"d"),this.pageChange.emit(r),this.currentPage=r)}changePage(r){console.log(r.target.value),this.gotToPage(Number(r.target.value))}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=ns({type:t,selectors:[["app-pagination"]],inputs:{totalItems:"totalItems",pageSize:"pageSize",currentPage:"currentPage"},outputs:{pageChange:"pageChange"},decls:10,vars:6,consts:[[1,"flex","justify-center","items-center"],[1,"px-3","py-2","border","border-gray-300","rounded-l-md","cursor-pointer","focus:outline-none",3,"disabled","click"],[1,"mx-4"],[1,"px-3","py-2","border","border-gray-300","rounded-r-md","cursor-pointer","focus:outline-none",3,"disabled","click"],[1,"ml-auto"],[1,"px-3","py-2","border","border-gray-300","cursor-pointer","focus:outline-none",3,"value","change"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(i,s){i&1&&(z(0,"div",0)(1,"button",1),Un("click",function(){return s.gotToPage(s.currentPage-1)}),ut(2," Previous "),$(),z(3,"div",2),ut(4),$(),z(5,"button",3),Un("click",function(){return s.gotToPage(s.currentPage+1)}),ut(6," Next "),$(),z(7,"div",4)(8,"select",5),Un("change",function(a){return s.changePage(a)}),Ft(9,v_,2,2,"option",6),$()()()),i&2&&(j(1),rt("disabled",s.currentPage===1),j(3),Dh(" Page ",s.currentPage," of ",s.totalPages," "),j(1),rt("disabled",s.currentPage===s.totalPages),j(3),rt("value",s.currentPage),j(1),rt("ngForOf",s.pageList))},dependencies:[is]});let n=t;return n})();var TI=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=nn({type:t}),t.\u0275inj=en({imports:[Bh]});let n=t;return n})();var I_="firebase",E_="10.7.1";Ce(I_,E_,"app");var jn=new Fh("ANGULARFIRE2_VERSION");var T_=(n,t)=>{let e=t?[t]:Wh(),r=[];return e.forEach(i=>{i.container.getProvider(n).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r},on=class{constructor(){return T_(A_)}},A_="app-check";function _a(){}var cs=class{zone;delegate;constructor(t,e=vh){this.zone=t,this.delegate=e}now(){return this.delegate.now()}schedule(t,e,r){let i=this.zone,s=function(o){i.runGuarded(()=>{t.apply(this,[o])})};return this.delegate.schedule(s,e,r)}},ya=class{zone;task=null;constructor(t){this.zone=t}call(t,e){let r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",_a,{},_a,_a)),e.pipe(Ah({next:r,complete:r,error:r})).subscribe(t).add(r)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},ls=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(e){this.ngZone=e,this.outsideAngular=e.runOutsideAngular(()=>new cs(Zone.current)),this.insideAngular=e.run(()=>new cs(Zone.current,Ji)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||n)(M(Pe))};static \u0275prov=be({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function S_(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function Vt(n){return R_(S_())(n)}function R_(n){return function(e){return e=e.lift(new ya(n.ngZone)),e.pipe(qn(n.outsideAngular),tn(n.insideAngular))}}var C_=new Map,x_={activated:!1,tokenObservers:[]},D_={initialized:!1,enabled:!1};function Kt(n){return C_.get(n)||Object.assign({},x_)}function Zh(){return D_}var k_="https://content-firebaseappcheck.googleapis.com/v1";var V_="exchangeDebugToken",Hh={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},UI=24*60*60*1e3;var va=class{constructor(t,e,r,i,s){if(this.operation=t,this.retryPolicy=e,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(t){return p(this,null,function*(){this.stop();try{this.pending=new pa,this.pending.promise.catch(e=>{}),yield N_(this.getNextRun(t)),this.pending.resolve(),yield this.pending.promise,this.pending=new pa,this.pending.promise.catch(e=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(e){this.retryPolicy(e)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(t){if(t)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let e=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),e}}};function N_(n){return new Promise(t=>{setTimeout(t,n)})}var F_={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},xe=new Kh("appCheck","AppCheck",F_);function td(n){if(!Kt(n).activated)throw xe.create("use-before-activation",{appName:n.name})}function ed(r,i){return p(this,arguments,function*({url:n,body:t},e){let s={"Content-Type":"application/json"},o=e.getImmediate({optional:!0});if(o){let f=yield o.getHeartbeatsHeader();f&&(s["X-Firebase-Client"]=f)}let a={method:"POST",body:JSON.stringify(t),headers:s},u;try{u=yield fetch(n,a)}catch(f){throw xe.create("fetch-network-error",{originalErrorMessage:f?.message})}if(u.status!==200)throw xe.create("fetch-status-error",{httpStatus:u.status});let c;try{c=yield u.json()}catch(f){throw xe.create("fetch-parse-error",{originalErrorMessage:f?.message})}let l=c.ttl.match(/^([\d.]+)(s)$/);if(!l||!l[2]||isNaN(Number(l[1])))throw xe.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${c.ttl}`});let h=Number(l[1])*1e3,d=Date.now();return{token:c.token,expireTimeMillis:d+h,issuedAtTimeMillis:d}})}function nd(n,t){let{projectId:e,appId:r,apiKey:i}=n.options;return{url:`${k_}/projects/${e}/apps/${r}:${V_}?key=${i}`,body:{debug_token:t}}}var M_="firebase-app-check-database",O_=1,Ia="firebase-app-check-store";var hs=null;function L_(){return hs||(hs=new Promise((n,t)=>{try{let e=indexedDB.open(M_,O_);e.onsuccess=r=>{n(r.target.result)},e.onerror=r=>{var i;t(xe.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},e.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore(Ia,{keyPath:"compositeKey"})}}}catch(e){t(xe.create("storage-open",{originalErrorMessage:e?.message}))}}),hs)}function q_(n,t){return B_(U_(n),t)}function B_(n,t){return p(this,null,function*(){let r=(yield L_()).transaction(Ia,"readwrite"),s=r.objectStore(Ia).put({compositeKey:n,value:t});return new Promise((o,a)=>{s.onsuccess=u=>{o()},r.onerror=u=>{var c;a(xe.create("storage-set",{originalErrorMessage:(c=u.target.error)===null||c===void 0?void 0:c.message}))}})})}function U_(n){return`${n.options.appId}-${n.name}`}var Ea=new us("@firebase/app-check");function wa(n,t){return as()?q_(n,t).catch(e=>{Ea.warn(`Failed to write token to IndexedDB. Error: ${e}`)}):Promise.resolve()}function rd(){return Zh().enabled}function id(){return p(this,null,function*(){let n=Zh();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var j_={error:"UNKNOWN_ERROR"};function z_(n){return Uh.encodeString(JSON.stringify(n),!1)}function Ta(n,t=!1){return p(this,null,function*(){let e=n.app;td(e);let r=Kt(e),i=r.token,s;if(i&&!Lr(i)&&(r.token=void 0,i=void 0),!i){let u=yield r.cachedTokenPromise;u&&(Lr(u)?i=u:yield wa(e,void 0))}if(!t&&i&&Lr(i))return{token:i.token};let o=!1;if(rd()){r.exchangeTokenPromise||(r.exchangeTokenPromise=ed(nd(e,yield id()),n.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),o=!0);let u=yield r.exchangeTokenPromise;return yield wa(e,u),r.token=u,{token:u.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),o=!0),i=yield Kt(e).exchangeTokenPromise}catch(u){u.code==="appCheck/throttled"?Ea.warn(u.message):Ea.error(u),s=u}let a;return i?s?Lr(i)?a={token:i.token,internalError:s}:a=Xh(s):(a={token:i.token},r.token=i,yield wa(e,i)):a=Xh(s),o&&W_(e,a),a})}function G_(n){return p(this,null,function*(){let t=n.app;td(t);let{provider:e}=Kt(t);if(rd()){let r=yield id(),{token:i}=yield ed(nd(t,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield e.getToken();return{token:r}}})}function K_(n,t,e,r){let{app:i}=n,s=Kt(i),o={next:e,error:r,type:t};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&Lr(s.token)){let a=s.token;Promise.resolve().then(()=>{e({token:a.token}),Yh(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>Yh(n))}function sd(n,t){let e=Kt(n),r=e.tokenObservers.filter(i=>i.next!==t);r.length===0&&e.tokenRefresher&&e.tokenRefresher.isRunning()&&e.tokenRefresher.stop(),e.tokenObservers=r}function Yh(n){let{app:t}=n,e=Kt(t),r=e.tokenRefresher;r||(r=$_(n),e.tokenRefresher=r),!r.isRunning()&&e.isTokenAutoRefreshEnabled&&r.start()}function $_(n){let{app:t}=n;return new va(()=>p(this,null,function*(){let e=Kt(t),r;if(e.token?r=yield Ta(n,!0):r=yield Ta(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let e=Kt(t);if(e.token){let r=e.token.issuedAtTimeMillis+(e.token.expireTimeMillis-e.token.issuedAtTimeMillis)*.5+3e5,i=e.token.expireTimeMillis-5*60*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},Hh.RETRIAL_MIN_WAIT,Hh.RETRIAL_MAX_WAIT)}function W_(n,t){let e=Kt(n).tokenObservers;for(let r of e)try{r.type==="EXTERNAL"&&t.error!=null?r.error(t.error):r.next(t)}catch{}}function Lr(n){return n.expireTimeMillis-Date.now()>0}function Xh(n){return{token:z_(j_),error:n}}var Aa=class{constructor(t,e){this.app=t,this.heartbeatServiceProvider=e}_delete(){let{tokenObservers:t}=Kt(this.app);for(let e of t)sd(this.app,e.next);return Promise.resolve()}};function Q_(n,t){return new Aa(n,t)}function H_(n){return{getToken:t=>Ta(n,t),getLimitedUseToken:()=>G_(n),addTokenListener:t=>K_(n,"INTERNAL",t),removeTokenListener:t=>sd(n.app,t)}}var Y_="@firebase/app-check",X_="0.8.1";var J_="app-check",Jh="app-check-internal";function Z_(){Or(new rn(J_,n=>{let t=n.getProvider("app").getImmediate(),e=n.getProvider("heartbeat");return Q_(t,e)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,t,e)=>{n.getProvider(Jh).initialize()})),Or(new rn(Jh,n=>{let t=n.getProvider("app-check").getImmediate();return H_(t)},"PUBLIC").setInstantiationMode("EXPLICIT")),Ce(Y_,X_)}Z_();var ty=["localhost","0.0.0.0","127.0.0.1"],ZI=typeof window<"u"&&ty.includes(window.location.hostname);var ey="firebase",ny="10.7.1";kt.registerVersion(ey,ny,"app-compat");var ry=["ngOnDestroy"],ud=(n,t,e,r={})=>new Proxy(n,{get:(i,s)=>e.runOutsideAngular(()=>{if(n[s])return r?.spy?.get&&r.spy.get(s,n[s]),n[s];if(ry.indexOf(s)>-1)return()=>{};let o=t.toPromise().then(a=>{let u=a?.[s];return typeof u=="function"?u.bind(a):u?.then?u.then(c=>e.run(()=>c)):e.run(()=>u)});return new Proxy(()=>{},{get:(a,u)=>o[u],apply:(a,u,c)=>o.then(l=>{let h=l?.(...c);return r?.spy?.apply&&r.spy.apply(s,c,h),h})})})});var ds=class{constructor(t){return t}},zn=new bt("angularfire2.app.options"),Gn=new bt("angularfire2.app.name");function qr(n,t,e){let r=typeof e=="string"&&e||"[DEFAULT]",i=typeof e=="object"&&e||{};i.name=i.name||r;let o=kt.apps.filter(a=>a&&a.name===i.name)[0]||t.runOutsideAngular(()=>kt.initializeApp(n,i));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;iy("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new ds(o)}var iy=(n,...t)=>{ga()&&typeof console<"u"&&console[n](...t)},sy={provide:ds,useFactory:qr,deps:[zn,Pe,[new bh,Gn]]},lE=(()=>{class n{static initializeApp(e,r){return{ngModule:n,providers:[{provide:zn,useValue:e},{provide:Gn,useValue:r}]}}constructor(e){kt.registerVersion("angularfire",jn.full,"core"),kt.registerVersion("angularfire",jn.full,"app-compat"),kt.registerVersion("angular",Mh.full,e.toString())}static \u0275fac=function(r){return new(r||n)(M(Bn))};static \u0275mod=nn({type:n});static \u0275inj=en({providers:[sy]})}return n})();function fs(n,t,e,r,i){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(s)return oy(i,o)||(ad("error",`${t} was already initialized on the ${e} Firebase App with different settings.${ay?" You may need to reload as Firebase is not HMR aware.":""}`),ad("warn",{is:i,was:o})),s;{let a=r();return globalThis.\u0275AngularfireInstanceCache.push([n,a,i]),a}}function oy(n,t){try{return n.toString()===t.toString()}catch{return n===t}}var ay=typeof module<"u"&&!!module.hot,ad=(n,...t)=>{ga()&&typeof console<"u"&&console[n](...t)};globalThis.\u0275AngularfireInstanceCache||=[];var Sa=new bt("angularfire2.auth.use-emulator"),Ra=new bt("angularfire2.auth.settings"),ba=new bt("angularfire2.auth.tenant-id"),Pa=new bt("angularfire2.auth.langugage-code"),Ca=new bt("angularfire2.auth.use-device-language"),xa=new bt("angularfire.auth.persistence"),Da=(n,t,e,r,i,s,o,a)=>fs(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let u=t.runOutsideAngular(()=>n.auth());if(e&&u.useEmulator(...e),r&&(u.tenantId=r),u.languageCode=i,s&&u.useDeviceLanguage(),o)for(let[c,l]of Object.entries(o))u.settings[c]=l;return a&&u.setPersistence(a),u},[e,r,i,s,o,a]),cd=(()=>{class n{authState;idToken;user;idTokenResult;credential;constructor(e,r,i,s,o,a,u,c,l,h,d,f){let E=new wh,v=Re(void 0).pipe(tn(o.outsideAngular),me(()=>s.runOutsideAngular(()=>import("./chunk-CI5O54IZ.js"))),gt(()=>qr(e,s,r)),gt(w=>Da(w,s,a,c,l,h,u,d)),da({bufferSize:1,refCount:!1}));if(ss(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=Re(null);else{v.pipe(Th()).subscribe();let w=v.pipe(me(R=>R.getRedirectResult().then(N=>N,()=>null)),Vt,da({bufferSize:1,refCount:!1})),C=v.pipe(me(R=>new Ln(N=>({unsubscribe:s.runOutsideAngular(()=>R.onAuthStateChanged(F=>N.next(F),F=>N.error(F),()=>N.complete()))})))),V=v.pipe(me(R=>new Ln(N=>({unsubscribe:s.runOutsideAngular(()=>R.onIdTokenChanged(F=>N.next(F),F=>N.error(F),()=>N.complete()))}))));this.authState=w.pipe(fa(C),qn(o.outsideAngular),tn(o.insideAngular)),this.user=w.pipe(fa(V),qn(o.outsideAngular),tn(o.insideAngular)),this.idToken=this.user.pipe(me(R=>R?Se(R.getIdToken()):Re(null))),this.idTokenResult=this.user.pipe(me(R=>R?Se(R.getIdTokenResult()):Re(null))),this.credential=Ih(w,E,this.authState.pipe(Mr(R=>!R))).pipe(gt(R=>R?.user?R:null),qn(o.outsideAngular),tn(o.insideAngular))}return ud(this,v,s,{spy:{apply:(w,C,V)=>{(w.startsWith("signIn")||w.startsWith("createUser"))&&V.then(R=>E.next(R))}}})}static \u0275fac=function(r){return new(r||n)(M(zn),M(Gn,8),M(Bn),M(Pe),M(ls),M(Sa,8),M(Ra,8),M(ba,8),M(Pa,8),M(Ca,8),M(xa,8),M(on,8))};static \u0275prov=be({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var cy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Wt={},T,Za=Za||{},x=cy||self;function bs(n){var t=typeof n;return t=t!="object"?t:n?Array.isArray(n)?"array":t:"null",t=="array"||t=="object"&&typeof n.length=="number"}function Zr(n){var t=typeof n;return t=="object"&&n!=null||t=="function"}function ly(n){return Object.prototype.hasOwnProperty.call(n,ka)&&n[ka]||(n[ka]=++hy)}var ka="closure_uid_"+(1e9*Math.random()>>>0),hy=0;function dy(n,t,e){return n.call.apply(n.bind,arguments)}function fy(n,t,e){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(t,i)}}return function(){return n.apply(t,arguments)}}function Tt(n,t,e){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?Tt=dy:Tt=fy,Tt.apply(null,arguments)}function ms(n,t){var e=Array.prototype.slice.call(arguments,1);return function(){var r=e.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function _t(n,t){function e(){}e.prototype=t.prototype,n.$=t.prototype,n.prototype=new e,n.prototype.constructor=n,n.ac=function(r,i,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return t.prototype[i].apply(r,o)}}function De(){this.s=this.s,this.o=this.o}var my=0;De.prototype.s=!1;De.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),my!=0)&&ly(this)};De.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var Ed=Array.prototype.indexOf?function(n,t){return Array.prototype.indexOf.call(n,t,void 0)}:function(n,t){if(typeof n=="string")return typeof t!="string"||t.length!=1?-1:n.indexOf(t,0);for(let e=0;e<n.length;e++)if(e in n&&n[e]===t)return e;return-1};function tu(n){let t=n.length;if(0<t){let e=Array(t);for(let r=0;r<t;r++)e[r]=n[r];return e}return[]}function ld(n,t){for(let e=1;e<arguments.length;e++){let r=arguments[e];if(bs(r)){let i=n.length||0,s=r.length||0;n.length=i+s;for(let o=0;o<s;o++)n[i+o]=r[o]}else n.push(r)}}function At(n,t){this.type=n,this.g=this.target=t,this.defaultPrevented=!1}At.prototype.h=function(){this.defaultPrevented=!0};var gy=function(){if(!x.addEventListener||!Object.defineProperty)return!1;var n=!1,t=Object.defineProperty({},"passive",{get:function(){n=!0}});try{let e=()=>{};x.addEventListener("test",e,t),x.removeEventListener("test",e,t)}catch{}return n}();function Kr(n){return/^[\s\xa0]*$/.test(n)}function Ps(){var n=x.navigator;return n&&(n=n.userAgent)?n:""}function ee(n){return Ps().indexOf(n)!=-1}function eu(n){return eu[" "](n),n}eu[" "]=function(){};function py(n,t){var e=iw;return Object.prototype.hasOwnProperty.call(e,n)?e[n]:e[n]=t(n)}var _y=ee("Opera"),Qn=ee("Trident")||ee("MSIE"),Td=ee("Edge"),Oa=Td||Qn,Ad=ee("Gecko")&&!(Ps().toLowerCase().indexOf("webkit")!=-1&&!ee("Edge"))&&!(ee("Trident")||ee("MSIE"))&&!ee("Edge"),yy=Ps().toLowerCase().indexOf("webkit")!=-1&&!ee("Edge");function Sd(){var n=x.document;return n?n.documentMode:void 0}var La;t:{if(gs="",ps=function(){var n=Ps();if(Ad)return/rv:([^\);]+)(\)|;)/.exec(n);if(Td)return/Edge\/([\d\.]+)/.exec(n);if(Qn)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n);if(yy)return/WebKit\/(\S+)/.exec(n);if(_y)return/(?:Version)[ \/]?(\S+)/.exec(n)}(),ps&&(gs=ps?ps[1]:""),Qn&&(_s=Sd(),_s!=null&&_s>parseFloat(gs))){La=String(_s);break t}La=gs}var gs,ps,_s,qa;x.document&&Qn?(Va=Sd(),qa=Va||parseInt(La,10)||void 0):qa=void 0;var Va,wy=qa;function $r(n,t){if(At.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var e=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=t,t=n.relatedTarget){if(Ad){t:{try{eu(t.nodeName);var i=!0;break t}catch{}i=!1}i||(t=null)}}else e=="mouseover"?t=n.fromElement:e=="mouseout"&&(t=n.toElement);this.relatedTarget=t,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=n.clientX!==void 0?n.clientX:n.pageX,this.clientY=n.clientY!==void 0?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType=typeof n.pointerType=="string"?n.pointerType:vy[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&$r.$.h.call(this)}}_t($r,At);var vy={2:"touch",3:"pen",4:"mouse"};$r.prototype.h=function(){$r.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var ti="closure_listenable_"+(1e6*Math.random()|0),Iy=0;function Ey(n,t,e,r,i){this.listener=n,this.proxy=null,this.src=t,this.type=e,this.capture=!!r,this.la=i,this.key=++Iy,this.fa=this.ia=!1}function Cs(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function nu(n,t,e){for(let r in n)t.call(e,n[r],r,n)}function Ty(n,t){for(let e in n)t.call(void 0,n[e],e,n)}function Rd(n){let t={};for(let e in n)t[e]=n[e];return t}var hd="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function bd(n,t){let e,r;for(let i=1;i<arguments.length;i++){r=arguments[i];for(e in r)n[e]=r[e];for(let s=0;s<hd.length;s++)e=hd[s],Object.prototype.hasOwnProperty.call(r,e)&&(n[e]=r[e])}}function xs(n){this.src=n,this.g={},this.h=0}xs.prototype.add=function(n,t,e,r,i){var s=n.toString();n=this.g[s],n||(n=this.g[s]=[],this.h++);var o=Ua(n,t,r,i);return-1<o?(t=n[o],e||(t.ia=!1)):(t=new Ey(t,this.src,s,!!r,i),t.ia=e,n.push(t)),t};function Ba(n,t){var e=t.type;if(e in n.g){var r=n.g[e],i=Ed(r,t),s;(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(Cs(t),n.g[e].length==0&&(delete n.g[e],n.h--))}}function Ua(n,t,e,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.fa&&s.listener==t&&s.capture==!!e&&s.la==r)return i}return-1}var ru="closure_lm_"+(1e6*Math.random()|0),Na={};function Pd(n,t,e,r,i){if(r&&r.once)return xd(n,t,e,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)Pd(n,t[s],e,r,i);return null}return e=ou(e),n&&n[ti]?n.O(t,e,Zr(r)?!!r.capture:!!r,i):Cd(n,t,e,!1,r,i)}function Cd(n,t,e,r,i,s){if(!t)throw Error("Invalid event type");var o=Zr(i)?!!i.capture:!!i,a=su(n);if(a||(n[ru]=a=new xs(n)),e=a.add(t,e,r,o,s),e.proxy)return e;if(r=Ay(),e.proxy=r,r.src=n,r.listener=e,n.addEventListener)gy||(i=o),i===void 0&&(i=!1),n.addEventListener(t.toString(),r,i);else if(n.attachEvent)n.attachEvent(kd(t.toString()),r);else if(n.addListener&&n.removeListener)n.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return e}function Ay(){function n(e){return t.call(n.src,n.listener,e)}let t=Sy;return n}function xd(n,t,e,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)xd(n,t[s],e,r,i);return null}return e=ou(e),n&&n[ti]?n.P(t,e,Zr(r)?!!r.capture:!!r,i):Cd(n,t,e,!0,r,i)}function Dd(n,t,e,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)Dd(n,t[s],e,r,i);else r=Zr(r)?!!r.capture:!!r,e=ou(e),n&&n[ti]?(n=n.i,t=String(t).toString(),t in n.g&&(s=n.g[t],e=Ua(s,e,r,i),-1<e&&(Cs(s[e]),Array.prototype.splice.call(s,e,1),s.length==0&&(delete n.g[t],n.h--)))):n&&(n=su(n))&&(t=n.g[t.toString()],n=-1,t&&(n=Ua(t,e,r,i)),(e=-1<n?t[n]:null)&&iu(e))}function iu(n){if(typeof n!="number"&&n&&!n.fa){var t=n.src;if(t&&t[ti])Ba(t.i,n);else{var e=n.type,r=n.proxy;t.removeEventListener?t.removeEventListener(e,r,n.capture):t.detachEvent?t.detachEvent(kd(e),r):t.addListener&&t.removeListener&&t.removeListener(r),(e=su(t))?(Ba(e,n),e.h==0&&(e.src=null,t[ru]=null)):Cs(n)}}}function kd(n){return n in Na?Na[n]:Na[n]="on"+n}function Sy(n,t){if(n.fa)n=!0;else{t=new $r(t,this);var e=n.listener,r=n.la||n.src;n.ia&&iu(n),n=e.call(r,t)}return n}function su(n){return n=n[ru],n instanceof xs?n:null}var Fa="__closure_events_fn_"+(1e9*Math.random()>>>0);function ou(n){return typeof n=="function"?n:(n[Fa]||(n[Fa]=function(t){return n.handleEvent(t)}),n[Fa])}function pt(){De.call(this),this.i=new xs(this),this.S=this,this.J=null}_t(pt,De);pt.prototype[ti]=!0;pt.prototype.removeEventListener=function(n,t,e,r){Dd(this,n,t,e,r)};function It(n,t){var e,r=n.J;if(r)for(e=[];r;r=r.J)e.push(r);if(n=n.S,r=t.type||t,typeof t=="string")t=new At(t,n);else if(t instanceof At)t.target=t.target||n;else{var i=t;t=new At(r,n),bd(t,i)}if(i=!0,e)for(var s=e.length-1;0<=s;s--){var o=t.g=e[s];i=ys(o,r,!0,t)&&i}if(o=t.g=n,i=ys(o,r,!0,t)&&i,i=ys(o,r,!1,t)&&i,e)for(s=0;s<e.length;s++)o=t.g=e[s],i=ys(o,r,!1,t)&&i}pt.prototype.N=function(){if(pt.$.N.call(this),this.i){var n=this.i,t;for(t in n.g){for(var e=n.g[t],r=0;r<e.length;r++)Cs(e[r]);delete n.g[t],n.h--}}this.J=null};pt.prototype.O=function(n,t,e,r){return this.i.add(String(n),t,!1,e,r)};pt.prototype.P=function(n,t,e,r){return this.i.add(String(n),t,!0,e,r)};function ys(n,t,e,r){if(t=n.i.g[String(t)],!t)return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.fa&&o.capture==e){var a=o.listener,u=o.la||o.src;o.ia&&Ba(n.i,o),i=a.call(u,r)!==!1&&i}}return i&&!r.defaultPrevented}var au=x.JSON.stringify,ja=class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}};function Ry(){var n=uu;let t=null;return n.g&&(t=n.g,n.g=n.g.next,n.g||(n.h=null),t.next=null),t}var za=class{constructor(){this.h=this.g=null}add(t,e){let r=Vd.get();r.set(t,e),this.h?this.h.next=r:this.g=r,this.h=r}},Vd=new ja(()=>new Ga,n=>n.reset()),Ga=class{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}};function by(n){var t=1;n=n.split(":");let e=[];for(;0<t&&n.length;)e.push(n.shift()),t--;return n.length&&e.push(n.join(":")),e}function Py(n){x.setTimeout(()=>{throw n},0)}var Wr,Qr=!1,uu=new za,Nd=()=>{let n=x.Promise.resolve(void 0);Wr=()=>{n.then(Cy)}},Cy=()=>{for(var n;n=Ry();){try{n.h.call(n.g)}catch(e){Py(e)}var t=Vd;t.j(n),100>t.h&&(t.h++,n.next=t.g,t.g=n)}Qr=!1};function Ds(n,t){pt.call(this),this.h=n||1,this.g=t||x,this.j=Tt(this.qb,this),this.l=Date.now()}_t(Ds,pt);T=Ds.prototype;T.ga=!1;T.T=null;T.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),It(this,"tick"),this.ga&&(cu(this),this.start()))}};T.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function cu(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}T.N=function(){Ds.$.N.call(this),cu(this),delete this.g};function lu(n,t,e){if(typeof n=="function")e&&(n=Tt(n,e));else if(n&&typeof n.handleEvent=="function")n=Tt(n.handleEvent,n);else throw Error("Invalid listener argument");return 2147483647<Number(t)?-1:x.setTimeout(n,t||0)}function Fd(n){n.g=lu(()=>{n.g=null,n.i&&(n.i=!1,Fd(n))},n.j);let t=n.h;n.h=null,n.m.apply(null,t)}var Ka=class extends De{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:Fd(this)}N(){super.N(),this.g&&(x.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}};function Hr(n){De.call(this),this.h=n,this.g={}}_t(Hr,De);var dd=[];function Md(n,t,e,r){Array.isArray(e)||(e&&(dd[0]=e.toString()),e=dd);for(var i=0;i<e.length;i++){var s=Pd(t,e[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function Od(n){nu(n.g,function(t,e){this.g.hasOwnProperty(e)&&iu(t)},n),n.g={}}Hr.prototype.N=function(){Hr.$.N.call(this),Od(this)};Hr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function ks(){this.g=!0}ks.prototype.Ea=function(){this.g=!1};function xy(n,t,e,r,i,s){n.info(function(){if(n.g)if(s)for(var o="",a=s.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var l=c[0];c=c[1];var h=l.split("_");o=2<=h.length&&h[1]=="type"?o+(l+"="+c+"&"):o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+`
`+e+`
`+o})}function Dy(n,t,e,r,i,s,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+`
`+e+`
`+s+" "+o})}function $n(n,t,e,r){n.info(function(){return"XMLHTTP TEXT ("+t+"): "+Vy(n,e)+(r?" "+r:"")})}function ky(n,t){n.info(function(){return"TIMEOUT: "+t})}ks.prototype.info=function(){};function Vy(n,t){if(!n.g)return t;if(!t)return null;try{var e=JSON.parse(t);if(e){for(n=0;n<e.length;n++)if(Array.isArray(e[n])){var r=e[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if(s!="noop"&&s!="stop"&&s!="close")for(var o=1;o<i.length;o++)i[o]=""}}}}return au(e)}catch{return t}}var ln={},fd=null;function Vs(){return fd=fd||new pt}ln.Ta="serverreachability";function Ld(n){At.call(this,ln.Ta,n)}_t(Ld,At);function Yr(n){let t=Vs();It(t,new Ld(t))}ln.STAT_EVENT="statevent";function qd(n,t){At.call(this,ln.STAT_EVENT,n),this.stat=t}_t(qd,At);function Pt(n){let t=Vs();It(t,new qd(t,n))}ln.Ua="timingevent";function Bd(n,t){At.call(this,ln.Ua,n),this.size=t}_t(Bd,At);function ei(n,t){if(typeof n!="function")throw Error("Fn must not be null and must be a function");return x.setTimeout(function(){n()},t)}var Ns={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Ud={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function hu(){}hu.prototype.h=null;function md(n){return n.h||(n.h=n.i())}function jd(){}var ni={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function du(){At.call(this,"d")}_t(du,At);function fu(){At.call(this,"c")}_t(fu,At);var $a;function Fs(){}_t(Fs,hu);Fs.prototype.g=function(){return new XMLHttpRequest};Fs.prototype.i=function(){return{}};$a=new Fs;function ri(n,t,e,r){this.l=n,this.j=t,this.m=e,this.W=r||1,this.U=new Hr(this),this.P=Ny,n=Oa?125:void 0,this.V=new Ds(n),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new zd}function zd(){this.i=null,this.g="",this.h=!1}var Ny=45e3,Gd={},Wa={};T=ri.prototype;T.setTimeout=function(n){this.P=n};function Qa(n,t,e){n.L=1,n.A=Os(pe(t)),n.u=e,n.S=!0,Kd(n,null)}function Kd(n,t){n.G=Date.now(),ii(n),n.B=pe(n.A);var e=n.B,r=n.W;Array.isArray(r)||(r=[String(r)]),Zd(e.i,"t",r),n.o=0,e=n.l.J,n.h=new zd,n.g=If(n.l,e?t:null,!n.u),0<n.O&&(n.M=new Ka(Tt(n.Pa,n,n.g),n.O)),Md(n.U,n.g,"readystatechange",n.nb),t=n.I?Rd(n.I):{},n.u?(n.v||(n.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.B,n.v,n.u,t)):(n.v="GET",n.g.ha(n.B,n.v,null,t)),Yr(),xy(n.j,n.v,n.B,n.m,n.W,n.u)}T.nb=function(n){n=n.target;let t=this.M;t&&ne(n)==3?t.l():this.Pa(n)};T.Pa=function(n){try{if(n==this.g)t:{let l=ne(this.g);var t=this.g.Ia();let h=this.g.da();if(!(3>l)&&(l!=3||Oa||this.g&&(this.h.h||this.g.ja()||yd(this.g)))){this.J||l!=4||t==7||(t==8||0>=h?Yr(3):Yr(2)),Ms(this);var e=this.g.da();this.ca=e;e:if($d(this)){var r=yd(this.g);n="";var i=r.length,s=ne(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){an(this),Gr(this);var o="";break e}this.h.i=new x.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,n+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.length=0,this.h.g+=n,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=e==200,Dy(this.j,this.v,this.B,this.m,this.W,l,e),this.i){if(this.aa&&!this.K){e:{if(this.g){var a,u=this.g;if((a=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Kr(a)){var c=a;break e}}c=null}if(e=c)$n(this.j,this.m,e,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ha(this,e);else{this.i=!1,this.s=3,Pt(12),an(this),Gr(this);break t}}this.S?(Wd(this,l,o),Oa&&this.i&&l==3&&(Md(this.U,this.V,"tick",this.mb),this.V.start())):($n(this.j,this.m,o,null),Ha(this,o)),l==4&&an(this),this.i&&!this.J&&(l==4?_f(this.l,this):(this.i=!1,ii(this)))}else ew(this.g),e==400&&0<o.indexOf("Unknown SID")?(this.s=3,Pt(12)):(this.s=0,Pt(13)),an(this),Gr(this)}}}catch{}finally{}};function $d(n){return n.g?n.v=="GET"&&n.L!=2&&n.l.Ha:!1}function Wd(n,t,e){let r=!0,i;for(;!n.J&&n.o<e.length;)if(i=Fy(n,e),i==Wa){t==4&&(n.s=4,Pt(14),r=!1),$n(n.j,n.m,null,"[Incomplete Response]");break}else if(i==Gd){n.s=4,Pt(15),$n(n.j,n.m,e,"[Invalid Chunk]"),r=!1;break}else $n(n.j,n.m,i,null),Ha(n,i);$d(n)&&n.o!=0&&(n.h.g=n.h.g.slice(n.o),n.o=0),t!=4||e.length!=0||n.h.h||(n.s=1,Pt(16),r=!1),n.i=n.i&&r,r?0<e.length&&!n.ba&&(n.ba=!0,t=n.l,t.g==n&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+e.length),wu(t),t.M=!0,Pt(11))):($n(n.j,n.m,e,"[Invalid Chunked Response]"),an(n),Gr(n))}T.mb=function(){if(this.g){var n=ne(this.g),t=this.g.ja();this.o<t.length&&(Ms(this),Wd(this,n,t),this.i&&n!=4&&ii(this))}};function Fy(n,t){var e=n.o,r=t.indexOf(`
`,e);return r==-1?Wa:(e=Number(t.substring(e,r)),isNaN(e)?Gd:(r+=1,r+e>t.length?Wa:(t=t.slice(r,r+e),n.o=r+e,t)))}T.cancel=function(){this.J=!0,an(this)};function ii(n){n.Y=Date.now()+n.P,Qd(n,n.P)}function Qd(n,t){if(n.C!=null)throw Error("WatchDog timer not null");n.C=ei(Tt(n.lb,n),t)}function Ms(n){n.C&&(x.clearTimeout(n.C),n.C=null)}T.lb=function(){this.C=null;let n=Date.now();0<=n-this.Y?(ky(this.j,this.B),this.L!=2&&(Yr(),Pt(17)),an(this),this.s=2,Gr(this)):Qd(this,this.Y-n)};function Gr(n){n.l.H==0||n.J||_f(n.l,n)}function an(n){Ms(n);var t=n.M;t&&typeof t.sa=="function"&&t.sa(),n.M=null,cu(n.V),Od(n.U),n.g&&(t=n.g,n.g=null,t.abort(),t.sa())}function Ha(n,t){try{var e=n.l;if(e.H!=0&&(e.g==n||Ya(e.i,n))){if(!n.K&&Ya(e.i,n)&&e.H==3){try{var r=e.Ja.g.parse(t)}catch{r=null}if(Array.isArray(r)&&r.length==3){var i=r;if(i[0]==0){t:if(!e.u){if(e.g)if(e.g.G+3e3<n.G)Ts(e),Bs(e);else break t;yu(e),Pt(18)}}else e.Fa=i[1],0<e.Fa-e.V&&37500>i[2]&&e.G&&e.A==0&&!e.v&&(e.v=ei(Tt(e.ib,e),6e3));if(1>=nf(e.i)&&e.oa){try{e.oa()}catch{}e.oa=void 0}}else un(e,11)}else if((n.K||e.g==n)&&Ts(e),!Kr(t))for(i=e.Ja.g.parse(t),t=0;t<i.length;t++){let c=i[t];if(e.V=c[0],c=c[1],e.H==2)if(c[0]=="c"){e.K=c[1],e.pa=c[2];let l=c[3];l!=null&&(e.ra=l,e.l.info("VER="+e.ra));let h=c[4];h!=null&&(e.Ga=h,e.l.info("SVER="+e.Ga));let d=c[5];d!=null&&typeof d=="number"&&0<d&&(r=1.5*d,e.L=r,e.l.info("backChannelRequestTimeoutMs_="+r)),r=e;let f=n.g;if(f){let E=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(E){var s=r.i;s.g||E.indexOf("spdy")==-1&&E.indexOf("quic")==-1&&E.indexOf("h2")==-1||(s.j=s.l,s.g=new Set,s.h&&(mu(s,s.h),s.h=null))}if(r.F){let v=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null;v&&(r.Da=v,H(r.I,r.F,v))}}e.H=3,e.h&&e.h.Ba(),e.ca&&(e.S=Date.now()-n.G,e.l.info("Handshake RTT: "+e.S+"ms")),r=e;var o=n;if(r.wa=vf(r,r.J?r.pa:null,r.Y),o.K){rf(r.i,o);var a=o,u=r.L;u&&a.setTimeout(u),a.C&&(Ms(a),ii(a)),r.g=o}else gf(r);0<e.j.length&&Us(e)}else c[0]!="stop"&&c[0]!="close"||un(e,7);else e.H==3&&(c[0]=="stop"||c[0]=="close"?c[0]=="stop"?un(e,7):_u(e):c[0]!="noop"&&e.h&&e.h.Aa(c),e.A=0)}}Yr(4)}catch{}}function My(n){if(n.Z&&typeof n.Z=="function")return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if(typeof n=="string")return n.split("");if(bs(n)){for(var t=[],e=n.length,r=0;r<e;r++)t.push(n[r]);return t}t=[],e=0;for(r in n)t[e++]=n[r];return t}function Oy(n){if(n.ta&&typeof n.ta=="function")return n.ta();if(!n.Z||typeof n.Z!="function"){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(bs(n)||typeof n=="string"){var t=[];n=n.length;for(var e=0;e<n;e++)t.push(e);return t}t=[],e=0;for(let r in n)t[e++]=r;return t}}}function Hd(n,t){if(n.forEach&&typeof n.forEach=="function")n.forEach(t,void 0);else if(bs(n)||typeof n=="string")Array.prototype.forEach.call(n,t,void 0);else for(var e=Oy(n),r=My(n),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],e&&e[s],n)}var Yd=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ly(n,t){if(n){n=n.split("&");for(var e=0;e<n.length;e++){var r=n[e].indexOf("="),i=null;if(0<=r){var s=n[e].substring(0,r);i=n[e].substring(r+1)}else s=n[e];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function cn(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof cn){this.h=n.h,Is(this,n.j),this.s=n.s,this.g=n.g,Es(this,n.m),this.l=n.l;var t=n.i,e=new Xr;e.i=t.i,t.g&&(e.g=new Map(t.g),e.h=t.h),gd(this,e),this.o=n.o}else n&&(t=String(n).match(Yd))?(this.h=!1,Is(this,t[1]||"",!0),this.s=jr(t[2]||""),this.g=jr(t[3]||"",!0),Es(this,t[4]),this.l=jr(t[5]||"",!0),gd(this,t[6]||"",!0),this.o=jr(t[7]||"")):(this.h=!1,this.i=new Xr(null,this.h))}cn.prototype.toString=function(){var n=[],t=this.j;t&&n.push(zr(t,pd,!0),":");var e=this.g;return(e||t=="file")&&(n.push("//"),(t=this.s)&&n.push(zr(t,pd,!0),"@"),n.push(encodeURIComponent(String(e)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e=this.m,e!=null&&n.push(":",String(e))),(e=this.l)&&(this.g&&e.charAt(0)!="/"&&n.push("/"),n.push(zr(e,e.charAt(0)=="/"?Uy:By,!0))),(e=this.i.toString())&&n.push("?",e),(e=this.o)&&n.push("#",zr(e,zy)),n.join("")};function pe(n){return new cn(n)}function Is(n,t,e){n.j=e?jr(t,!0):t,n.j&&(n.j=n.j.replace(/:$/,""))}function Es(n,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);n.m=t}else n.m=null}function gd(n,t,e){t instanceof Xr?(n.i=t,Gy(n.i,n.h)):(e||(t=zr(t,jy)),n.i=new Xr(t,n.h))}function H(n,t,e){n.i.set(t,e)}function Os(n){return H(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function jr(n,t){return n?t?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function zr(n,t,e){return typeof n=="string"?(n=encodeURI(n).replace(t,qy),e&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function qy(n){return n=n.charCodeAt(0),"%"+(n>>4&15).toString(16)+(n&15).toString(16)}var pd=/[#\/\?@]/g,By=/[#\?:]/g,Uy=/[#\?]/g,jy=/[#\?@]/g,zy=/#/g;function Xr(n,t){this.h=this.g=null,this.i=n||null,this.j=!!t}function ke(n){n.g||(n.g=new Map,n.h=0,n.i&&Ly(n.i,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}T=Xr.prototype;T.add=function(n,t){ke(this),this.i=null,n=Hn(this,n);var e=this.g.get(n);return e||this.g.set(n,e=[]),e.push(t),this.h+=1,this};function Xd(n,t){ke(n),t=Hn(n,t),n.g.has(t)&&(n.i=null,n.h-=n.g.get(t).length,n.g.delete(t))}function Jd(n,t){return ke(n),t=Hn(n,t),n.g.has(t)}T.forEach=function(n,t){ke(this),this.g.forEach(function(e,r){e.forEach(function(i){n.call(t,i,r,this)},this)},this)};T.ta=function(){ke(this);let n=Array.from(this.g.values()),t=Array.from(this.g.keys()),e=[];for(let r=0;r<t.length;r++){let i=n[r];for(let s=0;s<i.length;s++)e.push(t[r])}return e};T.Z=function(n){ke(this);let t=[];if(typeof n=="string")Jd(this,n)&&(t=t.concat(this.g.get(Hn(this,n))));else{n=Array.from(this.g.values());for(let e=0;e<n.length;e++)t=t.concat(n[e])}return t};T.set=function(n,t){return ke(this),this.i=null,n=Hn(this,n),Jd(this,n)&&(this.h-=this.g.get(n).length),this.g.set(n,[t]),this.h+=1,this};T.get=function(n,t){return n?(n=this.Z(n),0<n.length?String(n[0]):t):t};function Zd(n,t,e){Xd(n,t),0<e.length&&(n.i=null,n.g.set(Hn(n,t),tu(e)),n.h+=e.length)}T.toString=function(){if(this.i)return this.i;if(!this.g)return"";let n=[],t=Array.from(this.g.keys());for(var e=0;e<t.length;e++){var r=t[e];let s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;o[r]!==""&&(i+="="+encodeURIComponent(String(o[r]))),n.push(i)}}return this.i=n.join("&")};function Hn(n,t){return t=String(t),n.j&&(t=t.toLowerCase()),t}function Gy(n,t){t&&!n.j&&(ke(n),n.i=null,n.g.forEach(function(e,r){var i=r.toLowerCase();r!=i&&(Xd(this,r),Zd(this,i,e))},n)),n.j=t}var Ky=class{constructor(n,t){this.g=n,this.map=t}};function tf(n){this.l=n||$y,x.PerformanceNavigationTiming?(n=x.performance.getEntriesByType("navigation"),n=0<n.length&&(n[0].nextHopProtocol=="hq"||n[0].nextHopProtocol=="h2")):n=!!(x.g&&x.g.Ka&&x.g.Ka()&&x.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var $y=10;function ef(n){return n.h?!0:n.g?n.g.size>=n.j:!1}function nf(n){return n.h?1:n.g?n.g.size:0}function Ya(n,t){return n.h?n.h==t:n.g?n.g.has(t):!1}function mu(n,t){n.g?n.g.add(t):n.h=t}function rf(n,t){n.h&&n.h==t?n.h=null:n.g&&n.g.has(t)&&n.g.delete(t)}tf.prototype.cancel=function(){if(this.i=sf(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let n of this.g.values())n.cancel();this.g.clear()}};function sf(n){if(n.h!=null)return n.i.concat(n.h.F);if(n.g!=null&&n.g.size!==0){let t=n.i;for(let e of n.g.values())t=t.concat(e.F);return t}return tu(n.i)}var Wy=class{stringify(n){return x.JSON.stringify(n,void 0)}parse(n){return x.JSON.parse(n,void 0)}};function Qy(){this.g=new Wy}function Hy(n,t,e){let r=e||"";try{Hd(n,function(i,s){let o=i;Zr(i)&&(o=au(i)),t.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw t.push(r+"type="+encodeURIComponent("_badmap")),i}}function Yy(n,t){let e=new ks;if(x.Image){let r=new Image;r.onload=ms(ws,e,r,"TestLoadImage: loaded",!0,t),r.onerror=ms(ws,e,r,"TestLoadImage: error",!1,t),r.onabort=ms(ws,e,r,"TestLoadImage: abort",!1,t),r.ontimeout=ms(ws,e,r,"TestLoadImage: timeout",!1,t),x.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else t(!1)}function ws(n,t,e,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch{}}function si(n){this.l=n.ec||null,this.j=n.ob||!1}_t(si,hu);si.prototype.g=function(){return new Ls(this.l,this.j)};si.prototype.i=function(n){return function(){return n}}({});function Ls(n,t){pt.call(this),this.F=n,this.u=t,this.m=void 0,this.readyState=gu,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}_t(Ls,pt);var gu=0;T=Ls.prototype;T.open=function(n,t){if(this.readyState!=gu)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=t,this.readyState=1,Jr(this)};T.send=function(n){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(t.body=n),(this.F||x).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))};T.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,oi(this)),this.readyState=gu};T.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,Jr(this)),this.g&&(this.readyState=3,Jr(this),this.g)))if(this.responseType==="arraybuffer")n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof x.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;of(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))};function of(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}T.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var t=n.value?n.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!n.done}))&&(this.response=this.responseText+=t)}n.done?oi(this):Jr(this),this.readyState==3&&of(this)}};T.Za=function(n){this.g&&(this.response=this.responseText=n,oi(this))};T.Ya=function(n){this.g&&(this.response=n,oi(this))};T.ka=function(){this.g&&oi(this)};function oi(n){n.readyState=4,n.l=null,n.j=null,n.A=null,Jr(n)}T.setRequestHeader=function(n,t){this.v.append(n,t)};T.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""};T.getAllResponseHeaders=function(){if(!this.h)return"";let n=[],t=this.h.entries();for(var e=t.next();!e.done;)e=e.value,n.push(e[0]+": "+e[1]),e=t.next();return n.join(`\r
`)};function Jr(n){n.onreadystatechange&&n.onreadystatechange.call(n)}Object.defineProperty(Ls.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(n){this.m=n?"include":"same-origin"}});var Xy=x.JSON.parse;function tt(n){pt.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=af,this.L=this.M=!1}_t(tt,pt);var af="",Jy=/^https?$/i,Zy=["POST","PUT"];T=tt.prototype;T.Oa=function(n){this.M=n};T.ha=function(n,t,e,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);t=t?t.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():$a.g(),this.C=this.u?md(this.u):md($a),this.g.onreadystatechange=Tt(this.La,this);try{this.G=!0,this.g.open(t,String(n),!0),this.G=!1}catch(s){_d(this,s);return}if(n=e||"",e=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)e.set(i,r[i]);else if(typeof r.keys=="function"&&typeof r.get=="function")for(let s of r.keys())e.set(s,r.get(s));else throw Error("Unknown input type for opt_headers: "+String(r));r=Array.from(e.keys()).find(s=>s.toLowerCase()=="content-type"),i=x.FormData&&n instanceof x.FormData,!(0<=Ed(Zy,t))||r||i||e.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[s,o]of e)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{lf(this),0<this.B&&((this.L=tw(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Tt(this.ua,this)):this.A=lu(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){_d(this,s)}};function tw(n){return Qn&&typeof n.timeout=="number"&&n.ontimeout!==void 0}T.ua=function(){typeof Za<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,It(this,"timeout"),this.abort(8))};function _d(n,t){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=t,n.m=5,uf(n),qs(n)}function uf(n){n.F||(n.F=!0,It(n,"complete"),It(n,"error"))}T.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,It(this,"complete"),It(this,"abort"),qs(this))};T.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),qs(this,!0)),tt.$.N.call(this)};T.La=function(){this.s||(this.G||this.v||this.l?cf(this):this.kb())};T.kb=function(){cf(this)};function cf(n){if(n.h&&typeof Za<"u"&&(!n.C[1]||ne(n)!=4||n.da()!=2)){if(n.v&&ne(n)==4)lu(n.La,0,n);else if(It(n,"readystatechange"),ne(n)==4){n.h=!1;try{let o=n.da();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break t;default:t=!1}var e;if(!(e=t)){var r;if(r=o===0){var i=String(n.I).match(Yd)[1]||null;!i&&x.self&&x.self.location&&(i=x.self.location.protocol.slice(0,-1)),r=!Jy.test(i?i.toLowerCase():"")}e=r}if(e)It(n,"complete"),It(n,"success");else{n.m=6;try{var s=2<ne(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",uf(n)}}finally{qs(n)}}}}function qs(n,t){if(n.g){lf(n);let e=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,t||It(n,"ready");try{e.onreadystatechange=r}catch{}}}function lf(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(x.clearTimeout(n.A),n.A=null)}T.isActive=function(){return!!this.g};function ne(n){return n.g?n.g.readyState:0}T.da=function(){try{return 2<ne(this)?this.g.status:-1}catch{return-1}};T.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};T.Wa=function(n){if(this.g){var t=this.g.responseText;return n&&t.indexOf(n)==0&&(t=t.substring(n.length)),Xy(t)}};function yd(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case af:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function ew(n){let t={};n=(n.g&&2<=ne(n)&&n.g.getAllResponseHeaders()||"").split(`\r
`);for(let r=0;r<n.length;r++){if(Kr(n[r]))continue;var e=by(n[r]);let i=e[0];if(e=e[1],typeof e!="string")continue;e=e.trim();let s=t[i]||[];t[i]=s,s.push(e)}Ty(t,function(r){return r.join(", ")})}T.Ia=function(){return this.m};T.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function hf(n){let t="";return nu(n,function(e,r){t+=r,t+=":",t+=e,t+=`\r
`}),t}function pu(n,t,e){t:{for(r in e){var r=!1;break t}r=!0}r||(e=hf(e),typeof n=="string"?e!=null&&encodeURIComponent(String(e)):H(n,t,e))}function Br(n,t,e){return e&&e.internalChannelParams&&e.internalChannelParams[n]||t}function df(n){this.Ga=0,this.j=[],this.l=new ks,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Br("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Br("baseRetryDelayMs",5e3,n),this.hb=Br("retryDelaySeedMs",1e4,n),this.eb=Br("forwardChannelMaxRetries",2,n),this.xa=Br("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new tf(n&&n.concurrentRequestLimit),this.Ja=new Qy,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}T=df.prototype;T.ra=8;T.H=1;function _u(n){if(ff(n),n.H==3){var t=n.W++,e=pe(n.I);if(H(e,"SID",n.K),H(e,"RID",t),H(e,"TYPE","terminate"),ai(n,e),t=new ri(n,n.l,t),t.L=2,t.A=Os(pe(e)),e=!1,x.navigator&&x.navigator.sendBeacon)try{e=x.navigator.sendBeacon(t.A.toString(),"")}catch{}!e&&x.Image&&(new Image().src=t.A,e=!0),e||(t.g=If(t.l,null),t.g.ha(t.A)),t.G=Date.now(),ii(t)}wf(n)}function Bs(n){n.g&&(wu(n),n.g.cancel(),n.g=null)}function ff(n){Bs(n),n.u&&(x.clearTimeout(n.u),n.u=null),Ts(n),n.i.cancel(),n.m&&(typeof n.m=="number"&&x.clearTimeout(n.m),n.m=null)}function Us(n){if(!ef(n.i)&&!n.m){n.m=!0;var t=n.Na;Wr||Nd(),Qr||(Wr(),Qr=!0),uu.add(t,n),n.C=0}}function nw(n,t){return nf(n.i)>=n.i.j-(n.m?1:0)?!1:n.m?(n.j=t.F.concat(n.j),!0):n.H==1||n.H==2||n.C>=(n.cb?0:n.eb)?!1:(n.m=ei(Tt(n.Na,n,t),yf(n,n.C)),n.C++,!0)}T.Na=function(n){if(this.m)if(this.m=null,this.H==1){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;let i=new ri(this,this.l,n),s=this.s;if(this.U&&(s?(s=Rd(s),bd(s,this.U)):s=this.U),this.o!==null||this.O||(i.I=s,s=null),this.P)t:{for(var t=0,e=0;e<this.j.length;e++){e:{var r=this.j[e];if("__data__"in r.map&&(r=r.map.__data__,typeof r=="string")){r=r.length;break e}r=void 0}if(r===void 0)break;if(t+=r,4096<t){t=e;break t}if(t===4096||e===this.j.length-1){t=e+1;break t}}t=1e3}else t=1e3;t=mf(this,i,t),e=pe(this.I),H(e,"RID",n),H(e,"CVER",22),this.F&&H(e,"X-HTTP-Session-Id",this.F),ai(this,e),s&&(this.O?t="headers="+encodeURIComponent(String(hf(s)))+"&"+t:this.o&&pu(e,this.o,s)),mu(this.i,i),this.bb&&H(e,"TYPE","init"),this.P?(H(e,"$req",t),H(e,"SID","null"),i.aa=!0,Qa(i,e,null)):Qa(i,e,t),this.H=2}}else this.H==3&&(n?wd(this,n):this.j.length==0||ef(this.i)||wd(this))};function wd(n,t){var e;t?e=t.m:e=n.W++;let r=pe(n.I);H(r,"SID",n.K),H(r,"RID",e),H(r,"AID",n.V),ai(n,r),n.o&&n.s&&pu(r,n.o,n.s),e=new ri(n,n.l,e,n.C+1),n.o===null&&(e.I=n.s),t&&(n.j=t.F.concat(n.j)),t=mf(n,e,1e3),e.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),mu(n.i,e),Qa(e,r,t)}function ai(n,t){n.na&&nu(n.na,function(e,r){H(t,r,e)}),n.h&&Hd({},function(e,r){H(t,r,e)})}function mf(n,t,e){e=Math.min(n.j.length,e);var r=n.h?Tt(n.h.Va,n.h,n):null;t:{var i=n.j;let s=-1;for(;;){let o=["count="+e];s==-1?0<e?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let u=0;u<e;u++){let c=i[u].g,l=i[u].map;if(c-=s,0>c)s=Math.max(0,i[u].g-100),a=!1;else try{Hy(l,o,"req"+c+"_")}catch{r&&r(l)}}if(a){r=o.join("&");break t}}}return n=n.j.splice(0,e),t.F=n,r}function gf(n){if(!n.g&&!n.u){n.ba=1;var t=n.Ma;Wr||Nd(),Qr||(Wr(),Qr=!0),uu.add(t,n),n.A=0}}function yu(n){return n.g||n.u||3<=n.A?!1:(n.ba++,n.u=ei(Tt(n.Ma,n),yf(n,n.A)),n.A++,!0)}T.Ma=function(){if(this.u=null,pf(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=ei(Tt(this.jb,this),n)}};T.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Pt(10),Bs(this),pf(this))};function wu(n){n.B!=null&&(x.clearTimeout(n.B),n.B=null)}function pf(n){n.g=new ri(n,n.l,"rpc",n.ba),n.o===null&&(n.g.I=n.s),n.g.O=0;var t=pe(n.wa);H(t,"RID","rpc"),H(t,"SID",n.K),H(t,"AID",n.V),H(t,"CI",n.G?"0":"1"),!n.G&&n.qa&&H(t,"TO",n.qa),H(t,"TYPE","xmlhttp"),ai(n,t),n.o&&n.s&&pu(t,n.o,n.s),n.L&&n.g.setTimeout(n.L);var e=n.g;n=n.pa,e.L=1,e.A=Os(pe(t)),e.u=null,e.S=!0,Kd(e,n)}T.ib=function(){this.v!=null&&(this.v=null,Bs(this),yu(this),Pt(19))};function Ts(n){n.v!=null&&(x.clearTimeout(n.v),n.v=null)}function _f(n,t){var e=null;if(n.g==t){Ts(n),wu(n),n.g=null;var r=2}else if(Ya(n.i,t))e=t.F,rf(n.i,t),r=1;else return;if(n.H!=0){if(t.i)if(r==1){e=t.u?t.u.length:0,t=Date.now()-t.G;var i=n.C;r=Vs(),It(r,new Bd(r,e)),Us(n)}else gf(n);else if(i=t.s,i==3||i==0&&0<t.ca||!(r==1&&nw(n,t)||r==2&&yu(n)))switch(e&&0<e.length&&(t=n.i,t.i=t.i.concat(e)),i){case 1:un(n,5);break;case 4:un(n,10);break;case 3:un(n,6);break;default:un(n,2)}}}function yf(n,t){let e=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(e*=2),e*t}function un(n,t){if(n.l.info("Error code "+t),t==2){var e=null;n.h&&(e=null);var r=Tt(n.pb,n);e||(e=new cn("//www.google.com/images/cleardot.gif"),x.location&&x.location.protocol=="http"||Is(e,"https"),Os(e)),Yy(e.toString(),r)}else Pt(2);n.H=0,n.h&&n.h.za(t),wf(n),ff(n)}T.pb=function(n){n?(this.l.info("Successfully pinged google.com"),Pt(2)):(this.l.info("Failed to ping google.com"),Pt(1))};function wf(n){if(n.H=0,n.ma=[],n.h){let t=sf(n.i);(t.length!=0||n.j.length!=0)&&(ld(n.ma,t),ld(n.ma,n.j),n.i.i.length=0,tu(n.j),n.j.length=0),n.h.ya()}}function vf(n,t,e){var r=e instanceof cn?pe(e):new cn(e);if(r.g!="")t&&(r.g=t+"."+r.g),Es(r,r.m);else{var i=x.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new cn(null);r&&Is(s,r),t&&(s.g=t),i&&Es(s,i),e&&(s.l=e),r=s}return e=n.F,t=n.Da,e&&t&&H(r,e,t),H(r,"VER",n.ra),ai(n,r),r}function If(n,t,e){if(t&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return t=n.Ha&&!n.va?new tt(new si({ob:e})):new tt(n.va),t.Oa(n.J),t}T.isActive=function(){return!!this.h&&this.h.isActive(this)};function Ef(){}T=Ef.prototype;T.Ba=function(){};T.Aa=function(){};T.za=function(){};T.ya=function(){};T.isActive=function(){return!0};T.Va=function(){};function As(){if(Qn&&!(10<=Number(wy)))throw Error("Environmental error: no available transport.")}As.prototype.g=function(n,t){return new Mt(n,t)};function Mt(n,t){pt.call(this),this.g=new df(t),this.l=n,this.h=t&&t.messageUrlParams||null,n=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(n?n["X-WebChannel-Content-Type"]=t.messageContentType:n={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(n?n["X-WebChannel-Client-Profile"]=t.Ca:n={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=n,(n=t&&t.cc)&&!Kr(n)&&(this.g.o=n),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!Kr(t)&&(this.g.F=t,n=this.h,n!==null&&t in n&&(n=this.h,t in n&&delete n[t])),this.j=new Yn(this)}_t(Mt,pt);Mt.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,t=this.l,e=this.h||void 0;Pt(0),n.Y=t,n.na=e||{},n.G=n.aa,n.I=vf(n,null,n.Y),Us(n)};Mt.prototype.close=function(){_u(this.g)};Mt.prototype.u=function(n){var t=this.g;if(typeof n=="string"){var e={};e.__data__=n,n=e}else this.v&&(e={},e.__data__=au(n),n=e);t.j.push(new Ky(t.fb++,n)),t.H==3&&Us(t)};Mt.prototype.N=function(){this.g.h=null,delete this.j,_u(this.g),delete this.g,Mt.$.N.call(this)};function Tf(n){du.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var t=n.__sm__;if(t){t:{for(let e in t){n=e;break t}n=void 0}(this.i=n)&&(n=this.i,t=t!==null&&n in t?t[n]:void 0),this.data=t}else this.data=n}_t(Tf,du);function Af(){fu.call(this),this.status=1}_t(Af,fu);function Yn(n){this.g=n}_t(Yn,Ef);Yn.prototype.Ba=function(){It(this.g,"a")};Yn.prototype.Aa=function(n){It(this.g,new Tf(n))};Yn.prototype.za=function(n){It(this.g,new Af)};Yn.prototype.ya=function(){It(this.g,"b")};function rw(){this.blockSize=-1}function $t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}_t($t,rw);$t.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function Ma(n,t,e){e||(e=0);var r=Array(16);if(typeof t=="string")for(var i=0;16>i;++i)r[i]=t.charCodeAt(e++)|t.charCodeAt(e++)<<8|t.charCodeAt(e++)<<16|t.charCodeAt(e++)<<24;else for(i=0;16>i;++i)r[i]=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24;t=n.g[0],e=n.g[1],i=n.g[2];var s=n.g[3],o=t+(s^e&(i^s))+r[0]+3614090360&4294967295;t=e+(o<<7&4294967295|o>>>25),o=s+(i^t&(e^i))+r[1]+3905402710&4294967295,s=t+(o<<12&4294967295|o>>>20),o=i+(e^s&(t^e))+r[2]+606105819&4294967295,i=s+(o<<17&4294967295|o>>>15),o=e+(t^i&(s^t))+r[3]+3250441966&4294967295,e=i+(o<<22&4294967295|o>>>10),o=t+(s^e&(i^s))+r[4]+4118548399&4294967295,t=e+(o<<7&4294967295|o>>>25),o=s+(i^t&(e^i))+r[5]+1200080426&4294967295,s=t+(o<<12&4294967295|o>>>20),o=i+(e^s&(t^e))+r[6]+2821735955&4294967295,i=s+(o<<17&4294967295|o>>>15),o=e+(t^i&(s^t))+r[7]+4249261313&4294967295,e=i+(o<<22&4294967295|o>>>10),o=t+(s^e&(i^s))+r[8]+1770035416&4294967295,t=e+(o<<7&4294967295|o>>>25),o=s+(i^t&(e^i))+r[9]+2336552879&4294967295,s=t+(o<<12&4294967295|o>>>20),o=i+(e^s&(t^e))+r[10]+4294925233&4294967295,i=s+(o<<17&4294967295|o>>>15),o=e+(t^i&(s^t))+r[11]+2304563134&4294967295,e=i+(o<<22&4294967295|o>>>10),o=t+(s^e&(i^s))+r[12]+1804603682&4294967295,t=e+(o<<7&4294967295|o>>>25),o=s+(i^t&(e^i))+r[13]+4254626195&4294967295,s=t+(o<<12&4294967295|o>>>20),o=i+(e^s&(t^e))+r[14]+2792965006&4294967295,i=s+(o<<17&4294967295|o>>>15),o=e+(t^i&(s^t))+r[15]+1236535329&4294967295,e=i+(o<<22&4294967295|o>>>10),o=t+(i^s&(e^i))+r[1]+4129170786&4294967295,t=e+(o<<5&4294967295|o>>>27),o=s+(e^i&(t^e))+r[6]+3225465664&4294967295,s=t+(o<<9&4294967295|o>>>23),o=i+(t^e&(s^t))+r[11]+643717713&4294967295,i=s+(o<<14&4294967295|o>>>18),o=e+(s^t&(i^s))+r[0]+3921069994&4294967295,e=i+(o<<20&4294967295|o>>>12),o=t+(i^s&(e^i))+r[5]+3593408605&4294967295,t=e+(o<<5&4294967295|o>>>27),o=s+(e^i&(t^e))+r[10]+38016083&4294967295,s=t+(o<<9&4294967295|o>>>23),o=i+(t^e&(s^t))+r[15]+3634488961&4294967295,i=s+(o<<14&4294967295|o>>>18),o=e+(s^t&(i^s))+r[4]+3889429448&4294967295,e=i+(o<<20&4294967295|o>>>12),o=t+(i^s&(e^i))+r[9]+568446438&4294967295,t=e+(o<<5&4294967295|o>>>27),o=s+(e^i&(t^e))+r[14]+3275163606&4294967295,s=t+(o<<9&4294967295|o>>>23),o=i+(t^e&(s^t))+r[3]+4107603335&4294967295,i=s+(o<<14&4294967295|o>>>18),o=e+(s^t&(i^s))+r[8]+1163531501&4294967295,e=i+(o<<20&4294967295|o>>>12),o=t+(i^s&(e^i))+r[13]+2850285829&4294967295,t=e+(o<<5&4294967295|o>>>27),o=s+(e^i&(t^e))+r[2]+4243563512&4294967295,s=t+(o<<9&4294967295|o>>>23),o=i+(t^e&(s^t))+r[7]+1735328473&4294967295,i=s+(o<<14&4294967295|o>>>18),o=e+(s^t&(i^s))+r[12]+2368359562&4294967295,e=i+(o<<20&4294967295|o>>>12),o=t+(e^i^s)+r[5]+4294588738&4294967295,t=e+(o<<4&4294967295|o>>>28),o=s+(t^e^i)+r[8]+2272392833&4294967295,s=t+(o<<11&4294967295|o>>>21),o=i+(s^t^e)+r[11]+1839030562&4294967295,i=s+(o<<16&4294967295|o>>>16),o=e+(i^s^t)+r[14]+4259657740&4294967295,e=i+(o<<23&4294967295|o>>>9),o=t+(e^i^s)+r[1]+2763975236&4294967295,t=e+(o<<4&4294967295|o>>>28),o=s+(t^e^i)+r[4]+1272893353&4294967295,s=t+(o<<11&4294967295|o>>>21),o=i+(s^t^e)+r[7]+4139469664&4294967295,i=s+(o<<16&4294967295|o>>>16),o=e+(i^s^t)+r[10]+3200236656&4294967295,e=i+(o<<23&4294967295|o>>>9),o=t+(e^i^s)+r[13]+681279174&4294967295,t=e+(o<<4&4294967295|o>>>28),o=s+(t^e^i)+r[0]+3936430074&4294967295,s=t+(o<<11&4294967295|o>>>21),o=i+(s^t^e)+r[3]+3572445317&4294967295,i=s+(o<<16&4294967295|o>>>16),o=e+(i^s^t)+r[6]+76029189&4294967295,e=i+(o<<23&4294967295|o>>>9),o=t+(e^i^s)+r[9]+3654602809&4294967295,t=e+(o<<4&4294967295|o>>>28),o=s+(t^e^i)+r[12]+3873151461&4294967295,s=t+(o<<11&4294967295|o>>>21),o=i+(s^t^e)+r[15]+530742520&4294967295,i=s+(o<<16&4294967295|o>>>16),o=e+(i^s^t)+r[2]+3299628645&4294967295,e=i+(o<<23&4294967295|o>>>9),o=t+(i^(e|~s))+r[0]+4096336452&4294967295,t=e+(o<<6&4294967295|o>>>26),o=s+(e^(t|~i))+r[7]+1126891415&4294967295,s=t+(o<<10&4294967295|o>>>22),o=i+(t^(s|~e))+r[14]+2878612391&4294967295,i=s+(o<<15&4294967295|o>>>17),o=e+(s^(i|~t))+r[5]+4237533241&4294967295,e=i+(o<<21&4294967295|o>>>11),o=t+(i^(e|~s))+r[12]+1700485571&4294967295,t=e+(o<<6&4294967295|o>>>26),o=s+(e^(t|~i))+r[3]+2399980690&4294967295,s=t+(o<<10&4294967295|o>>>22),o=i+(t^(s|~e))+r[10]+4293915773&4294967295,i=s+(o<<15&4294967295|o>>>17),o=e+(s^(i|~t))+r[1]+2240044497&4294967295,e=i+(o<<21&4294967295|o>>>11),o=t+(i^(e|~s))+r[8]+1873313359&4294967295,t=e+(o<<6&4294967295|o>>>26),o=s+(e^(t|~i))+r[15]+4264355552&4294967295,s=t+(o<<10&4294967295|o>>>22),o=i+(t^(s|~e))+r[6]+2734768916&4294967295,i=s+(o<<15&4294967295|o>>>17),o=e+(s^(i|~t))+r[13]+1309151649&4294967295,e=i+(o<<21&4294967295|o>>>11),o=t+(i^(e|~s))+r[4]+4149444226&4294967295,t=e+(o<<6&4294967295|o>>>26),o=s+(e^(t|~i))+r[11]+3174756917&4294967295,s=t+(o<<10&4294967295|o>>>22),o=i+(t^(s|~e))+r[2]+718787259&4294967295,i=s+(o<<15&4294967295|o>>>17),o=e+(s^(i|~t))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+t&4294967295,n.g[1]=n.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+i&4294967295,n.g[3]=n.g[3]+s&4294967295}$t.prototype.j=function(n,t){t===void 0&&(t=n.length);for(var e=t-this.blockSize,r=this.m,i=this.h,s=0;s<t;){if(i==0)for(;s<=e;)Ma(this,n,s),s+=this.blockSize;if(typeof n=="string"){for(;s<t;)if(r[i++]=n.charCodeAt(s++),i==this.blockSize){Ma(this,r),i=0;break}}else for(;s<t;)if(r[i++]=n[s++],i==this.blockSize){Ma(this,r),i=0;break}}this.h=i,this.i+=t};$t.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var t=1;t<n.length-8;++t)n[t]=0;var e=8*this.i;for(t=n.length-8;t<n.length;++t)n[t]=e&255,e/=256;for(this.j(n),n=Array(16),t=e=0;4>t;++t)for(var r=0;32>r;r+=8)n[e++]=this.g[t]>>>r&255;return n};function G(n,t){this.h=t;for(var e=[],r=!0,i=n.length-1;0<=i;i--){var s=n[i]|0;r&&s==t||(e[i]=s,r=!1)}this.g=e}var iw={};function vu(n){return-128<=n&&128>n?py(n,function(t){return new G([t|0],0>t?-1:0)}):new G([n|0],0>n?-1:0)}function re(n){if(isNaN(n)||!isFinite(n))return Wn;if(0>n)return vt(re(-n));for(var t=[],e=1,r=0;n>=e;r++)t[r]=n/e|0,e*=Xa;return new G(t,0)}function Sf(n,t){if(n.length==0)throw Error("number format error: empty string");if(t=t||10,2>t||36<t)throw Error("radix out of range: "+t);if(n.charAt(0)=="-")return vt(Sf(n.substring(1),t));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var e=re(Math.pow(t,8)),r=Wn,i=0;i<n.length;i+=8){var s=Math.min(8,n.length-i),o=parseInt(n.substring(i,i+s),t);8>s?(s=re(Math.pow(t,s)),r=r.R(s).add(re(o))):(r=r.R(e),r=r.add(re(o)))}return r}var Xa=4294967296,Wn=vu(0),Ja=vu(1),vd=vu(16777216);T=G.prototype;T.ea=function(){if(Bt(this))return-vt(this).ea();for(var n=0,t=1,e=0;e<this.g.length;e++){var r=this.D(e);n+=(0<=r?r:Xa+r)*t,t*=Xa}return n};T.toString=function(n){if(n=n||10,2>n||36<n)throw Error("radix out of range: "+n);if(ge(this))return"0";if(Bt(this))return"-"+vt(this).toString(n);for(var t=re(Math.pow(n,6)),e=this,r="";;){var i=Rs(e,t).g;e=Ss(e,i.R(t));var s=((0<e.g.length?e.g[0]:e.h)>>>0).toString(n);if(e=i,ge(e))return s+r;for(;6>s.length;)s="0"+s;r=s+r}};T.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h};function ge(n){if(n.h!=0)return!1;for(var t=0;t<n.g.length;t++)if(n.g[t]!=0)return!1;return!0}function Bt(n){return n.h==-1}T.X=function(n){return n=Ss(this,n),Bt(n)?-1:ge(n)?0:1};function vt(n){for(var t=n.g.length,e=[],r=0;r<t;r++)e[r]=~n.g[r];return new G(e,~n.h).add(Ja)}T.abs=function(){return Bt(this)?vt(this):this};T.add=function(n){for(var t=Math.max(this.g.length,n.g.length),e=[],r=0,i=0;i<=t;i++){var s=r+(this.D(i)&65535)+(n.D(i)&65535),o=(s>>>16)+(this.D(i)>>>16)+(n.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,e[i]=o<<16|s}return new G(e,e[e.length-1]&-2147483648?-1:0)};function Ss(n,t){return n.add(vt(t))}T.R=function(n){if(ge(this)||ge(n))return Wn;if(Bt(this))return Bt(n)?vt(this).R(vt(n)):vt(vt(this).R(n));if(Bt(n))return vt(this.R(vt(n)));if(0>this.X(vd)&&0>n.X(vd))return re(this.ea()*n.ea());for(var t=this.g.length+n.g.length,e=[],r=0;r<2*t;r++)e[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<n.g.length;i++){var s=this.D(r)>>>16,o=this.D(r)&65535,a=n.D(i)>>>16,u=n.D(i)&65535;e[2*r+2*i]+=o*u,vs(e,2*r+2*i),e[2*r+2*i+1]+=s*u,vs(e,2*r+2*i+1),e[2*r+2*i+1]+=o*a,vs(e,2*r+2*i+1),e[2*r+2*i+2]+=s*a,vs(e,2*r+2*i+2)}for(r=0;r<t;r++)e[r]=e[2*r+1]<<16|e[2*r];for(r=t;r<2*t;r++)e[r]=0;return new G(e,0)};function vs(n,t){for(;(n[t]&65535)!=n[t];)n[t+1]+=n[t]>>>16,n[t]&=65535,t++}function Ur(n,t){this.g=n,this.h=t}function Rs(n,t){if(ge(t))throw Error("division by zero");if(ge(n))return new Ur(Wn,Wn);if(Bt(n))return t=Rs(vt(n),t),new Ur(vt(t.g),vt(t.h));if(Bt(t))return t=Rs(n,vt(t)),new Ur(vt(t.g),t.h);if(30<n.g.length){if(Bt(n)||Bt(t))throw Error("slowDivide_ only works with positive integers.");for(var e=Ja,r=t;0>=r.X(n);)e=Id(e),r=Id(r);var i=Kn(e,1),s=Kn(r,1);for(r=Kn(r,2),e=Kn(e,2);!ge(r);){var o=s.add(r);0>=o.X(n)&&(i=i.add(e),s=o),r=Kn(r,1),e=Kn(e,1)}return t=Ss(n,i.R(t)),new Ur(i,t)}for(i=Wn;0<=n.X(t);){for(e=Math.max(1,Math.floor(n.ea()/t.ea())),r=Math.ceil(Math.log(e)/Math.LN2),r=48>=r?1:Math.pow(2,r-48),s=re(e),o=s.R(t);Bt(o)||0<o.X(n);)e-=r,s=re(e),o=s.R(t);ge(s)&&(s=Ja),i=i.add(s),n=Ss(n,o)}return new Ur(i,n)}T.gb=function(n){return Rs(this,n).h};T.and=function(n){for(var t=Math.max(this.g.length,n.g.length),e=[],r=0;r<t;r++)e[r]=this.D(r)&n.D(r);return new G(e,this.h&n.h)};T.or=function(n){for(var t=Math.max(this.g.length,n.g.length),e=[],r=0;r<t;r++)e[r]=this.D(r)|n.D(r);return new G(e,this.h|n.h)};T.xor=function(n){for(var t=Math.max(this.g.length,n.g.length),e=[],r=0;r<t;r++)e[r]=this.D(r)^n.D(r);return new G(e,this.h^n.h)};function Id(n){for(var t=n.g.length+1,e=[],r=0;r<t;r++)e[r]=n.D(r)<<1|n.D(r-1)>>>31;return new G(e,n.h)}function Kn(n,t){var e=t>>5;t%=32;for(var r=n.g.length-e,i=[],s=0;s<r;s++)i[s]=0<t?n.D(s+e)>>>t|n.D(s+e+1)<<32-t:n.D(s+e);return new G(i,n.h)}As.prototype.createWebChannel=As.prototype.g;Mt.prototype.send=Mt.prototype.u;Mt.prototype.open=Mt.prototype.m;Mt.prototype.close=Mt.prototype.close;Ns.NO_ERROR=0;Ns.TIMEOUT=8;Ns.HTTP_ERROR=6;Ud.COMPLETE="complete";jd.EventType=ni;ni.OPEN="a";ni.CLOSE="b";ni.ERROR="c";ni.MESSAGE="d";pt.prototype.listen=pt.prototype.O;tt.prototype.listenOnce=tt.prototype.P;tt.prototype.getLastError=tt.prototype.Sa;tt.prototype.getLastErrorCode=tt.prototype.Ia;tt.prototype.getStatus=tt.prototype.da;tt.prototype.getResponseJson=tt.prototype.Wa;tt.prototype.getResponseText=tt.prototype.ja;tt.prototype.send=tt.prototype.ha;tt.prototype.setWithCredentials=tt.prototype.Oa;$t.prototype.digest=$t.prototype.l;$t.prototype.reset=$t.prototype.reset;$t.prototype.update=$t.prototype.j;G.prototype.add=G.prototype.add;G.prototype.multiply=G.prototype.R;G.prototype.modulo=G.prototype.gb;G.prototype.compare=G.prototype.X;G.prototype.toNumber=G.prototype.ea;G.prototype.toString=G.prototype.toString;G.prototype.getBits=G.prototype.D;G.fromNumber=re;G.fromString=Sf;var Rf=Wt.createWebChannelTransport=function(){return new As},bf=Wt.getStatEventTarget=function(){return Vs()},js=Wt.ErrorCode=Ns,Pf=Wt.EventType=Ud,Cf=Wt.Event=ln,Iu=Wt.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},SE=Wt.FetchXmlHttpFactory=si,ui=Wt.WebChannel=jd,xf=Wt.XhrIo=tt,Df=Wt.Md5=$t,hn=Wt.Integer=G;var kf="@firebase/firestore";var ht=class{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}};ht.UNAUTHENTICATED=new ht(null),ht.GOOGLE_CREDENTIALS=new ht("google-credentials-uid"),ht.FIRST_PARTY=new ht("first-party-uid"),ht.MOCK_USER=new ht("mock-user");var Rr="10.7.0";var qe=new us("@firebase/firestore");function er(){return qe.logLevel}function Dm(n){qe.setLogLevel(n)}function y(n,...t){if(qe.logLevel<=te.DEBUG){let e=t.map(El);qe.debug(`Firestore (${Rr}): ${n}`,...e)}}function it(n,...t){if(qe.logLevel<=te.ERROR){let e=t.map(El);qe.error(`Firestore (${Rr}): ${n}`,...e)}}function jt(n,...t){if(qe.logLevel<=te.WARN){let e=t.map(El);qe.warn(`Firestore (${Rr}): ${n}`,...e)}}function El(n){if(typeof n=="string")return n;try{return function(e){return JSON.stringify(e)}(n)}catch{return n}}function S(n="Unexpected state"){let t=`FIRESTORE (${Rr}) INTERNAL ASSERTION FAILED: `+n;throw it(t),new Error(t)}function b(n,t){n||S()}function km(n,t){n||S()}function A(n,t){return n}var g={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},_=class extends Gh{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var dt=class{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}};var Zs=class{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}},Ru=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(ht.UNAUTHENTICATED))}shutdown(){}},bu=class{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}},Pu=class{constructor(t){this.t=t,this.currentUser=ht.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let r=this.i,i=u=>this.i!==r?(r=this.i,e(u)):Promise.resolve(),s=new dt;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new dt,t.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let u=s;t.enqueueRetryable(()=>p(this,null,function*(){yield u.promise,yield i(this.currentUser)}))},a=u=>{y("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(u=>a(u)),setTimeout(()=>{if(!this.auth){let u=this.t.getImmediate({optional:!0});u?a(u):(y("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new dt)}},0),o()}getToken(){let t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(r=>this.i!==t?(y("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(b(typeof r.accessToken=="string"),new Zs(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let t=this.auth&&this.auth.getUid();return b(t===null||typeof t=="string"),new ht(t)}},Cu=class{constructor(t,e,r){this.l=t,this.h=e,this.P=r,this.type="FirstParty",this.user=ht.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},xu=class{constructor(t,e,r){this.l=t,this.h=e,this.P=r}getToken(){return Promise.resolve(new Cu(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable(()=>e(ht.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Du=class{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},ku=class{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){let r=s=>{s.error!=null&&y("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,y("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?e(s.token):Promise.resolve()};this.o=s=>{t.enqueueRetryable(()=>r(s))};let i=s=>{y("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):y("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(b(typeof e.token=="string"),this.R=e.token,new Du(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function sw(n){let t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(n);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let r=0;r<n;r++)e[r]=Math.floor(256*Math.random());return e}var to=class{static newId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,r="";for(;r.length<20;){let i=sw(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<e&&(r+=t.charAt(i[s]%t.length))}return r}};function D(n,t){return n<t?-1:n>t?1:0}function lr(n,t,e){return n.length===t.length&&n.every((r,i)=>e(r,t[i]))}function Vm(n){return n+"\0"}var Z=class n{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new _(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new _(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new _(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new _(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return n.fromMillis(Date.now())}static fromDate(t){return n.fromMillis(t.getTime())}static fromMillis(t){let e=Math.floor(t/1e3),r=Math.floor(1e6*(t-1e3*e));return new n(e,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?D(this.nanoseconds,t.nanoseconds):D(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var P=class n{constructor(t){this.timestamp=t}static fromTimestamp(t){return new n(t)}static min(){return new n(new Z(0,0))}static max(){return new n(new Z(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var eo=class n{constructor(t,e,r){e===void 0?e=0:e>t.length&&S(),r===void 0?r=t.length-e:r>t.length-e&&S(),this.segments=t,this.offset=e,this.len=r}get length(){return this.len}isEqual(t){return n.comparator(this,t)===0}child(t){let e=this.segments.slice(this.offset,this.limit());return t instanceof n?t.forEach(r=>{e.push(r)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,r=this.limit();e<r;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){let r=Math.min(t.length,e.length);for(let i=0;i<r;i++){let s=t.get(i),o=e.get(i);if(s<o)return-1;if(s>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0}},U=class n extends eo{construct(t,e,r){return new n(t,e,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){let e=[];for(let r of t){if(r.indexOf("//")>=0)throw new _(g.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);e.push(...r.split("/").filter(i=>i.length>0))}return new n(e)}static emptyPath(){return new n([])}},ow=/^[_a-zA-Z][_a-zA-Z0-9]*$/,st=class n extends eo{construct(t,e,r){return new n(t,e,r)}static isValidIdentifier(t){return ow.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(t){let e=[],r="",i=0,s=()=>{if(r.length===0)throw new _(g.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(r),r=""},o=!1;for(;i<t.length;){let a=t[i];if(a==="\\"){if(i+1===t.length)throw new _(g.INVALID_ARGUMENT,"Path has trailing escape character: "+t);let u=t[i+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new _(g.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new _(g.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new n(e)}static emptyPath(){return new n([])}};var I=class n{constructor(t){this.path=t}static fromPath(t){return new n(U.fromString(t))}static fromName(t){return new n(U.fromString(t).popFirst(5))}static empty(){return new n(U.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&U.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return U.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new n(new U(t.slice()))}};var hr=class{constructor(t,e,r,i){this.indexId=t,this.collectionGroup=e,this.fields=r,this.indexState=i}};function Vu(n){return n.fields.find(t=>t.kind===2)}function fn(n){return n.fields.filter(t=>t.kind!==2)}hr.UNKNOWN_ID=-1;var ar=class{constructor(t,e){this.fieldPath=t,this.kind=e}};var vi=class n{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new n(0,zt.min())}};function Nm(n,t){let e=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=P.fromTimestamp(r===1e9?new Z(e+1,0):new Z(e,r));return new zt(i,I.empty(),t)}function Fm(n){return new zt(n.readTime,n.key,-1)}var zt=class n{constructor(t,e,r){this.readTime=t,this.documentKey=e,this.largestBatchId=r}static min(){return new n(P.min(),I.empty(),-1)}static max(){return new n(P.max(),I.empty(),-1)}};function Tl(n,t){let e=n.readTime.compareTo(t.readTime);return e!==0?e:(e=I.comparator(n.documentKey,t.documentKey),e!==0?e:D(n.largestBatchId,t.largestBatchId))}var Mm="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",no=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}};function Ye(n){return p(this,null,function*(){if(n.code!==g.FAILED_PRECONDITION||n.message!==Mm)throw n;y("LocalStore","Unexpectedly lost primary lease")})}var m=class n{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&S(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(t,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(e,s).next(r,i)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{let e=t();return e instanceof n?e:n.resolve(e)}catch(e){return n.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):n.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):n.reject(e)}static resolve(t){return new n((e,r)=>{e(t)})}static reject(t){return new n((e,r)=>{r(t)})}static waitFor(t){return new n((e,r)=>{let i=0,s=0,o=!1;t.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&e()},u=>r(u))}),o=!0,s===i&&e()})}static or(t){let e=n.resolve(!1);for(let r of t)e=e.next(i=>i?n.resolve(i):r());return e}static forEach(t,e){let r=[];return t.forEach((i,s)=>{r.push(e.call(this,i,s))}),this.waitFor(r)}static mapArray(t,e){return new n((r,i)=>{let s=t.length,o=new Array(s),a=0;for(let u=0;u<s;u++){let c=u;e(t[c]).next(l=>{o[c]=l,++a,a===s&&r(o)},l=>i(l))}})}static doWhile(t,e){return new n((r,i)=>{let s=()=>{t()===!0?e().next(()=>{s()},i):r()};s()})}};var ro=class n{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.V=new dt,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{e.error?this.V.reject(new wn(t,e.error)):this.V.resolve()},this.transaction.onerror=r=>{let i=Al(r.target.error);this.V.reject(new wn(t,i))}}static open(t,e,r,i){try{return new n(e,t.transaction(i,r))}catch(s){throw new wn(e,s)}}get m(){return this.V.promise}abort(t){t&&this.V.reject(t),this.aborted||(y("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let t=this.transaction;this.aborted||typeof t.commit!="function"||t.commit()}store(t){let e=this.transaction.objectStore(t);return new Fu(e)}},Be=class n{constructor(t,e,r){this.name=t,this.version=e,this.p=r,n.S(os())===12.2&&it("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return y("SimpleDb","Removing database:",t),mn(window.indexedDB.deleteDatabase(t)).toPromise()}static D(){if(!as())return!1;if(n.C())return!0;let t=os(),e=n.S(t),r=0<e&&e<10,i=n.v(t),s=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||r||s)}static C(){var t;return typeof process<"u"&&((t=process.env)===null||t===void 0?void 0:t.F)==="YES"}static M(t,e){return t.store(e)}static S(t){let e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static v(t){let e=t.match(/Android ([\d.]+)/i),r=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(r)}O(t){return p(this,null,function*(){return this.db||(y("SimpleDb","Opening database:",this.name),this.db=yield new Promise((e,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;e(o)},i.onblocked=()=>{r(new wn(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new _(g.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new _(g.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new wn(t,o))},i.onupgradeneeded=s=>{y("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.p.N(o,i.transaction,s.oldVersion,this.version).next(()=>{y("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.B&&(this.db.onversionchange=e=>this.B(e)),this.db})}L(t){this.B=t,this.db&&(this.db.onversionchange=e=>t(e))}runTransaction(t,e,r,i){return p(this,null,function*(){let s=e==="readonly",o=0;for(;;){++o;try{this.db=yield this.O(t);let a=ro.open(this.db,t,s?"readonly":"readwrite",r),u=i(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),m.reject(c))).toPromise();return u.catch(()=>{}),yield a.m,u}catch(a){let u=a,c=u.name!=="FirebaseError"&&o<3;if(y("SimpleDb","Transaction failed with error:",u.message,"Retrying:",c),this.close(),!c)return Promise.reject(u)}}})}close(){this.db&&this.db.close(),this.db=void 0}},Nu=class{constructor(t){this.k=t,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(t){this.k=t}done(){this.q=!0}U(t){this.K=t}delete(){return mn(this.k.delete())}},wn=class extends _{constructor(t,e){super(g.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}};function Xe(n){return n.name==="IndexedDbTransactionError"}var Fu=class{constructor(t){this.store=t}put(t,e){let r;return e!==void 0?(y("SimpleDb","PUT",this.store.name,t,e),r=this.store.put(e,t)):(y("SimpleDb","PUT",this.store.name,"<auto-key>",t),r=this.store.put(t)),mn(r)}add(t){return y("SimpleDb","ADD",this.store.name,t,t),mn(this.store.add(t))}get(t){return mn(this.store.get(t)).next(e=>(e===void 0&&(e=null),y("SimpleDb","GET",this.store.name,t,e),e))}delete(t){return y("SimpleDb","DELETE",this.store.name,t),mn(this.store.delete(t))}count(){return y("SimpleDb","COUNT",this.store.name),mn(this.store.count())}W(t,e){let r=this.options(t,e);if(r.index||typeof this.store.getAll!="function"){let i=this.cursor(r),s=[];return this.G(i,(o,a)=>{s.push(a)}).next(()=>s)}{let i=this.store.getAll(r.range);return new m((s,o)=>{i.onerror=a=>{o(a.target.error)},i.onsuccess=a=>{s(a.target.result)}})}}j(t,e){let r=this.store.getAll(t,e===null?void 0:e);return new m((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}H(t,e){y("SimpleDb","DELETE ALL",this.store.name);let r=this.options(t,e);r.J=!1;let i=this.cursor(r);return this.G(i,(s,o,a)=>a.delete())}Y(t,e){let r;e?r=t:(r={},e=t);let i=this.cursor(r);return this.G(i,e)}Z(t){let e=this.cursor({});return new m((r,i)=>{e.onerror=s=>{let o=Al(s.target.error);i(o)},e.onsuccess=s=>{let o=s.target.result;o?t(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}G(t,e){let r=[];return new m((i,s)=>{t.onerror=o=>{s(o.target.error)},t.onsuccess=o=>{let a=o.target.result;if(!a)return void i();let u=new Nu(a),c=e(a.primaryKey,a.value,u);if(c instanceof m){let l=c.catch(h=>(u.done(),m.reject(h)));r.push(l)}u.isDone?i():u.$===null?a.continue():a.continue(u.$)}}).next(()=>m.waitFor(r))}options(t,e){let r;return t!==void 0&&(typeof t=="string"?r=t:e=t),{index:r,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){let r=this.store.index(t.index);return t.J?r.openKeyCursor(t.range,e):r.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}};function mn(n){return new m((t,e)=>{n.onsuccess=r=>{let i=r.target.result;t(i)},n.onerror=r=>{let i=Al(r.target.error);e(i)}})}var Vf=!1;function Al(n){let t=Be.S(os());if(t>=12.2&&t<13){let e="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(e)>=0){let r=new _("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Vf||(Vf=!0,setTimeout(()=>{throw r},0)),r}}return n}var Mu=class{constructor(t,e){this.asyncQueue=t,this.X=e,this.task=null}start(){this.ee(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}ee(t){y("IndexBackiller",`Scheduled in ${t}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",t,()=>p(this,null,function*(){this.task=null;try{y("IndexBackiller",`Documents written: ${yield this.X.te()}`)}catch(e){Xe(e)?y("IndexBackiller","Ignoring IndexedDB error during index backfill: ",e):yield Ye(e)}yield this.ee(6e4)}))}},Ou=class{constructor(t,e){this.localStore=t,this.persistence=e}te(t=50){return p(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",e=>this.ne(e,t))})}ne(t,e){let r=new Set,i=e,s=!0;return m.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(t).next(o=>{if(o!==null&&!r.has(o))return y("IndexBackiller",`Processing collection: ${o}`),this.re(t,o,i).next(a=>{i-=a,r.add(o)});s=!1})).next(()=>e-i)}re(t,e,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(t,e).next(i=>this.localStore.localDocuments.getNextDocuments(t,e,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(t,o).next(()=>this.ie(i,s)).next(a=>(y("IndexBackiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(t,e,a))).next(()=>o.size)}))}ie(t,e){let r=t;return e.changes.forEach((i,s)=>{let o=Fm(s);Tl(o,r)>0&&(r=o)}),new zt(r.readTime,r.documentKey,Math.max(e.batchId,t.largestBatchId))}};var Ot=(()=>{class n{constructor(e,r){this.previousValue=e,r&&(r.sequenceNumberHandler=i=>this.se(i),this.oe=i=>r.writeSequenceNumber(i))}se(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.oe&&this.oe(e),e}}return n._e=-1,n})();function Gi(n){return n==null}function Ii(n){return n===0&&1/n==-1/0}function Om(n){return typeof n=="number"&&Number.isInteger(n)&&!Ii(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function Ct(n){let t="";for(let e=0;e<n.length;e++)t.length>0&&(t=Nf(t)),t=aw(n.get(e),t);return Nf(t)}function aw(n,t){let e=t,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":e+="";break;case"":e+="";break;default:e+=s}}return e}function Nf(n){return n+""}function ie(n){let t=n.length;if(b(t>=2),t===2)return b(n.charAt(0)===""&&n.charAt(1)===""),U.emptyPath();let e=t-2,r=[],i="";for(let s=0;s<t;){let o=n.indexOf("",s);switch((o<0||o>e)&&S(),n.charAt(o+1)){case"":let a=n.substring(s,o),u;i.length===0?u=a:(i+=a,u=i,i=""),r.push(u);break;case"":i+=n.substring(s,o),i+="\0";break;case"":i+=n.substring(s,o+1);break;default:S()}s=o+2}return new U(r)}var Ff=["userId","batchId"];function Ws(n,t){return[n,Ct(t)]}function Lm(n,t,e){return[n,Ct(t),e]}var uw={},cw=["prefixPath","collectionGroup","readTime","documentId"],lw=["prefixPath","collectionGroup","documentId"],hw=["collectionGroup","readTime","prefixPath","documentId"],dw=["canonicalId","targetId"],fw=["targetId","path"],mw=["path","targetId"],gw=["collectionId","parent"],pw=["indexId","uid"],_w=["uid","sequenceNumber"],yw=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],ww=["indexId","uid","orderedDocumentKey"],vw=["userId","collectionPath","documentId"],Iw=["userId","collectionPath","largestBatchId"],Ew=["userId","collectionGroup","largestBatchId"],qm=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Tw=[...qm,"documentOverlays"],Bm=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Um=Bm,Aw=[...Um,"indexConfiguration","indexState","indexEntries"];var Ei=class extends no{constructor(t,e){super(),this.ae=t,this.currentSequenceNumber=e}};function wt(n,t){let e=A(n);return Be.M(e.ae,t)}function Mf(n){let t=0;for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&t++;return t}function Dn(n,t){for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&t(e,n[e])}function jm(n){for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}var Y=class n{constructor(t,e){this.comparator=t,this.root=e||oe.EMPTY}insert(t,e){return new n(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,oe.BLACK,null,null))}remove(t){return new n(this.comparator,this.root.remove(t,this.comparator).copy(null,null,oe.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){let r=this.comparator(t,e.key);if(r===0)return e.value;r<0?e=e.left:r>0&&(e=e.right)}return null}indexOf(t){let e=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(t,r.key);if(i===0)return e+r.left.size;i<0?r=r.left:(e+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,r)=>(t(e,r),!1))}toString(){let t=[];return this.inorderTraversal((e,r)=>(t.push(`${e}:${r}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new or(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new or(this.root,t,this.comparator,!1)}getReverseIterator(){return new or(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new or(this.root,t,this.comparator,!0)}},or=class{constructor(t,e,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?r(t.key,e):1,e&&i&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(s===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}},oe=class n{constructor(t,e,r,i,s){this.key=t,this.value=e,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,r,i,s){return new n(t??this.key,e??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,r){let i=this,s=r(t,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(t,e,r),null):s===0?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let r,i=this;if(e(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,e),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),e(t,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,e))}return i.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw S();let t=this.left.check();if(t!==this.right.check())throw S();return t+(this.isRed()?0:1)}};oe.EMPTY=null,oe.RED=!0,oe.BLACK=!1;oe.EMPTY=new class{constructor(){this.size=0}get key(){throw S()}get value(){throw S()}get color(){throw S()}get left(){throw S()}get right(){throw S()}copy(t,e,r,i,s){return this}insert(t,e,r){return new oe(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var W=class n{constructor(t){this.comparator=t,this.data=new Y(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,r)=>(t(e),!1))}forEachInRange(t,e){let r=this.data.getIteratorFrom(t[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,t[1])>=0)return;e(i.key)}}forEachWhile(t,e){let r;for(r=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();r.hasNext();)if(!t(r.getNext().key))return}firstAfterOrEqual(t){let e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new io(this.data.getIterator())}getIteratorFrom(t){return new io(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(r=>{e=e.add(r)}),e}isEqual(t){if(!(t instanceof n)||this.size!==t.size)return!1;let e=this.data.getIterator(),r=t.data.getIterator();for(;e.hasNext();){let i=e.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let t=[];return this.forEach(e=>{t.push(e)}),t}toString(){let t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){let e=new n(this.comparator);return e.data=t,e}},io=class{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function Xn(n){return n.hasNext()?n.getNext():void 0}var Lt=class n{constructor(t){this.fields=t,t.sort(st.comparator)}static empty(){return new n([])}unionWith(t){let e=new W(st.comparator);for(let r of this.fields)e=e.add(r);for(let r of t)e=e.add(r);return new n(e.toArray())}covers(t){for(let e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return lr(this.fields,t.fields,(e,r)=>e.isEqual(r))}};var so=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function zm(){return typeof atob<"u"}var yt=class n{constructor(t){this.binaryString=t}static fromBase64String(t){let e=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new so("Invalid base64 string: "+s):s}}(t);return new n(e)}static fromUint8Array(t){let e=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(t);return new n(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){let r=new Uint8Array(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return D(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}};yt.EMPTY_BYTE_STRING=new yt("");var Sw=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ue(n){if(b(!!n),typeof n=="string"){let t=0,e=Sw.exec(n);if(b(!!e),e[1]){let i=e[1];i=(i+"000000000").substr(0,9),t=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:et(n.seconds),nanos:et(n.nanos)}}function et(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function je(n){return typeof n=="string"?yt.fromBase64String(n):yt.fromUint8Array(n)}function Yo(n){var t,e;return((e=(((t=n?.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||e===void 0?void 0:e.stringValue)==="server_timestamp"}function Sl(n){let t=n.mapValue.fields.__previous_value__;return Yo(t)?Sl(t):t}function Ti(n){let t=Ue(n.mapValue.fields.__local_write_time__.timestampValue);return new Z(t.seconds,t.nanos)}var Lu=class{constructor(t,e,r,i,s,o,a,u,c){this.databaseId=t,this.appId=e,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=u,this.useFetchStreams=c}},ze=class n{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(t){return t instanceof n&&t.projectId===this.projectId&&t.database===this.database}};var Oe={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Qs={nullValue:"NULL_VALUE"};function vn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Yo(n)?4:Gm(n)?9007199254740991:10:S()}function ce(n,t){if(n===t)return!0;let e=vn(n);if(e!==vn(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return Ti(n).isEqual(Ti(t));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=Ue(i.timestampValue),a=Ue(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,t);case 5:return n.stringValue===t.stringValue;case 6:return function(i,s){return je(i.bytesValue).isEqual(je(s.bytesValue))}(n,t);case 7:return n.referenceValue===t.referenceValue;case 8:return function(i,s){return et(i.geoPointValue.latitude)===et(s.geoPointValue.latitude)&&et(i.geoPointValue.longitude)===et(s.geoPointValue.longitude)}(n,t);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return et(i.integerValue)===et(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=et(i.doubleValue),a=et(s.doubleValue);return o===a?Ii(o)===Ii(a):isNaN(o)&&isNaN(a)}return!1}(n,t);case 9:return lr(n.arrayValue.values||[],t.arrayValue.values||[],ce);case 10:return function(i,s){let o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(Mf(o)!==Mf(a))return!1;for(let u in o)if(o.hasOwnProperty(u)&&(a[u]===void 0||!ce(o[u],a[u])))return!1;return!0}(n,t);default:return S()}}function Ai(n,t){return(n.values||[]).find(e=>ce(e,t))!==void 0}function Ge(n,t){if(n===t)return 0;let e=vn(n),r=vn(t);if(e!==r)return D(e,r);switch(e){case 0:case 9007199254740991:return 0;case 1:return D(n.booleanValue,t.booleanValue);case 2:return function(s,o){let a=et(s.integerValue||s.doubleValue),u=et(o.integerValue||o.doubleValue);return a<u?-1:a>u?1:a===u?0:isNaN(a)?isNaN(u)?0:-1:1}(n,t);case 3:return Of(n.timestampValue,t.timestampValue);case 4:return Of(Ti(n),Ti(t));case 5:return D(n.stringValue,t.stringValue);case 6:return function(s,o){let a=je(s),u=je(o);return a.compareTo(u)}(n.bytesValue,t.bytesValue);case 7:return function(s,o){let a=s.split("/"),u=o.split("/");for(let c=0;c<a.length&&c<u.length;c++){let l=D(a[c],u[c]);if(l!==0)return l}return D(a.length,u.length)}(n.referenceValue,t.referenceValue);case 8:return function(s,o){let a=D(et(s.latitude),et(o.latitude));return a!==0?a:D(et(s.longitude),et(o.longitude))}(n.geoPointValue,t.geoPointValue);case 9:return function(s,o){let a=s.values||[],u=o.values||[];for(let c=0;c<a.length&&c<u.length;++c){let l=Ge(a[c],u[c]);if(l)return l}return D(a.length,u.length)}(n.arrayValue,t.arrayValue);case 10:return function(s,o){if(s===Oe.mapValue&&o===Oe.mapValue)return 0;if(s===Oe.mapValue)return 1;if(o===Oe.mapValue)return-1;let a=s.fields||{},u=Object.keys(a),c=o.fields||{},l=Object.keys(c);u.sort(),l.sort();for(let h=0;h<u.length&&h<l.length;++h){let d=D(u[h],l[h]);if(d!==0)return d;let f=Ge(a[u[h]],c[l[h]]);if(f!==0)return f}return D(u.length,l.length)}(n.mapValue,t.mapValue);default:throw S()}}function Of(n,t){if(typeof n=="string"&&typeof t=="string"&&n.length===t.length)return D(n,t);let e=Ue(n),r=Ue(t),i=D(e.seconds,r.seconds);return i!==0?i:D(e.nanos,r.nanos)}function dr(n){return qu(n)}function qu(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(e){let r=Ue(e);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(e){return je(e).toBase64()}(n.bytesValue):"referenceValue"in n?function(e){return I.fromName(e).toString()}(n.referenceValue):"geoPointValue"in n?function(e){return`geo(${e.latitude},${e.longitude})`}(n.geoPointValue):"arrayValue"in n?function(e){let r="[",i=!0;for(let s of e.values||[])i?i=!1:r+=",",r+=qu(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(e){let r=Object.keys(e.fields||{}).sort(),i="{",s=!0;for(let o of r)s?s=!1:i+=",",i+=`${o}:${qu(e.fields[o])}`;return i+"}"}(n.mapValue):S()}function In(n,t){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${t.path.canonicalString()}`}}function Bu(n){return!!n&&"integerValue"in n}function Si(n){return!!n&&"arrayValue"in n}function Lf(n){return!!n&&"nullValue"in n}function qf(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Hs(n){return!!n&&"mapValue"in n}function gi(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let t={mapValue:{fields:{}}};return Dn(n.mapValue.fields,(e,r)=>t.mapValue.fields[e]=gi(r)),t}if(n.arrayValue){let t={arrayValue:{values:[]}};for(let e=0;e<(n.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=gi(n.arrayValue.values[e]);return t}return Object.assign({},n)}function Gm(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}function Rw(n){return"nullValue"in n?Qs:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?In(ze.empty(),I.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:S()}function bw(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?In(ze.empty(),I.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?Oe:S()}function Bf(n,t){let e=Ge(n.value,t.value);return e!==0?e:n.inclusive&&!t.inclusive?-1:!n.inclusive&&t.inclusive?1:0}function Uf(n,t){let e=Ge(n.value,t.value);return e!==0?e:n.inclusive&&!t.inclusive?1:!n.inclusive&&t.inclusive?-1:0}var Rt=class n{constructor(t){this.value=t}static empty(){return new n({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let r=0;r<t.length-1;++r)if(e=(e.mapValue.fields||{})[t.get(r)],!Hs(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=gi(e)}setAll(t){let e=st.emptyPath(),r={},i=[];t.forEach((o,a)=>{if(!e.isImmediateParentOf(a)){let u=this.getFieldsMap(e);this.applyChanges(u,r,i),r={},i=[],e=a.popLast()}o?r[a.lastSegment()]=gi(o):i.push(a.lastSegment())});let s=this.getFieldsMap(e);this.applyChanges(s,r,i)}delete(t){let e=this.field(t.popLast());Hs(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return ce(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let r=0;r<t.length;++r){let i=e.mapValue.fields[t.get(r)];Hs(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},e.mapValue.fields[t.get(r)]=i),e=i}return e.mapValue.fields}applyChanges(t,e,r){Dn(e,(i,s)=>t[i]=s);for(let i of r)delete t[i]}clone(){return new n(gi(this.value))}};function Km(n){let t=[];return Dn(n.fields,(e,r)=>{let i=new st([e]);if(Hs(r)){let s=Km(r.mapValue).fields;if(s.length===0)t.push(i);else for(let o of s)t.push(i.child(o))}else t.push(i)}),new Lt(t)}var ft=class n{constructor(t,e,r,i,s,o,a){this.key=t,this.documentType=e,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(t){return new n(t,0,P.min(),P.min(),P.min(),Rt.empty(),0)}static newFoundDocument(t,e,r,i){return new n(t,1,e,P.min(),r,i,0)}static newNoDocument(t,e){return new n(t,2,e,P.min(),P.min(),Rt.empty(),0)}static newUnknownDocument(t,e){return new n(t,3,e,P.min(),P.min(),Rt.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(P.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Rt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Rt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=P.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof n&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var le=class{constructor(t,e){this.position=t,this.inclusive=e}};function jf(n,t,e){let r=0;for(let i=0;i<n.position.length;i++){let s=t[i],o=n.position[i];if(s.field.isKeyField()?r=I.comparator(I.fromName(o.referenceValue),e.key):r=Ge(o,e.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function zf(n,t){if(n===null)return t===null;if(t===null||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let e=0;e<n.position.length;e++)if(!ce(n.position[e],t.position[e]))return!1;return!0}var En=class{constructor(t,e="asc"){this.field=t,this.dir=e}};function Pw(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}var oo=class{},O=class n extends oo{constructor(t,e,r){super(),this.field=t,this.op=e,this.value=r}static create(t,e,r){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,r):new zu(t,e,r):e==="array-contains"?new $u(t,r):e==="in"?new ao(t,r):e==="not-in"?new Wu(t,r):e==="array-contains-any"?new Qu(t,r):new n(t,e,r)}static createKeyFieldInFilter(t,e,r){return e==="in"?new Gu(t,r):new Ku(t,r)}matches(t){let e=t.data.field(this.field);return this.op==="!="?e!==null&&this.matchesComparison(Ge(e,this.value)):e!==null&&vn(this.value)===vn(e)&&this.matchesComparison(Ge(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return S()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},K=class n extends oo{constructor(t,e){super(),this.filters=t,this.op=e,this.ue=null}static create(t,e){return new n(t,e)}matches(t){return fr(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.ue!==null||(this.ue=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.ue}getFilters(){return Object.assign([],this.filters)}};function fr(n){return n.op==="and"}function Uu(n){return n.op==="or"}function Rl(n){return $m(n)&&fr(n)}function $m(n){for(let t of n.filters)if(t instanceof K)return!1;return!0}function ju(n){if(n instanceof O)return n.field.canonicalString()+n.op.toString()+dr(n.value);if(Rl(n))return n.filters.map(t=>ju(t)).join(",");{let t=n.filters.map(e=>ju(e)).join(",");return`${n.op}(${t})`}}function Wm(n,t){return n instanceof O?function(r,i){return i instanceof O&&r.op===i.op&&r.field.isEqual(i.field)&&ce(r.value,i.value)}(n,t):n instanceof K?function(r,i){return i instanceof K&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,a)=>s&&Wm(o,i.filters[a]),!0):!1}(n,t):void S()}function Qm(n,t){let e=n.filters.concat(t);return K.create(e,n.op)}function Hm(n){return n instanceof O?function(e){return`${e.field.canonicalString()} ${e.op} ${dr(e.value)}`}(n):n instanceof K?function(e){return e.op.toString()+" {"+e.getFilters().map(Hm).join(" ,")+"}"}(n):"Filter"}var zu=class extends O{constructor(t,e,r){super(t,e,r),this.key=I.fromName(r.referenceValue)}matches(t){let e=I.comparator(t.key,this.key);return this.matchesComparison(e)}},Gu=class extends O{constructor(t,e){super(t,"in",e),this.keys=Ym("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}},Ku=class extends O{constructor(t,e){super(t,"not-in",e),this.keys=Ym("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}};function Ym(n,t){var e;return(((e=t.arrayValue)===null||e===void 0?void 0:e.values)||[]).map(r=>I.fromName(r.referenceValue))}var $u=class extends O{constructor(t,e){super(t,"array-contains",e)}matches(t){let e=t.data.field(this.field);return Si(e)&&Ai(e.arrayValue,this.value)}},ao=class extends O{constructor(t,e){super(t,"in",e)}matches(t){let e=t.data.field(this.field);return e!==null&&Ai(this.value.arrayValue,e)}},Wu=class extends O{constructor(t,e){super(t,"not-in",e)}matches(t){if(Ai(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let e=t.data.field(this.field);return e!==null&&!Ai(this.value.arrayValue,e)}},Qu=class extends O{constructor(t,e){super(t,"array-contains-any",e)}matches(t){let e=t.data.field(this.field);return!(!Si(e)||!e.arrayValue.values)&&e.arrayValue.values.some(r=>Ai(this.value.arrayValue,r))}};var Hu=class{constructor(t,e=null,r=[],i=[],s=null,o=null,a=null){this.path=t,this.collectionGroup=e,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ce=null}};function Yu(n,t=null,e=[],r=[],i=null,s=null,o=null){return new Hu(n,t,e,r,i,s,o)}function Tn(n){let t=A(n);if(t.ce===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(r=>ju(r)).join(","),e+="|ob:",e+=t.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),Gi(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(r=>dr(r)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(r=>dr(r)).join(",")),t.ce=e}return t.ce}function Ki(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<n.orderBy.length;e++)if(!Pw(n.orderBy[e],t.orderBy[e]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let e=0;e<n.filters.length;e++)if(!Wm(n.filters[e],t.filters[e]))return!1;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!zf(n.startAt,t.startAt)&&zf(n.endAt,t.endAt)}function uo(n){return I.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function co(n,t){return n.filters.filter(e=>e instanceof O&&e.field.isEqual(t))}function Gf(n,t,e){let r=Qs,i=!0;for(let s of co(n,t)){let o=Qs,a=!0;switch(s.op){case"<":case"<=":o=Rw(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=Qs}Bf({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(e!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(t)){let o=e.position[s];Bf({value:r,inclusive:i},{value:o,inclusive:e.inclusive})<0&&(r=o,i=e.inclusive);break}}return{value:r,inclusive:i}}function Kf(n,t,e){let r=Oe,i=!0;for(let s of co(n,t)){let o=Oe,a=!0;switch(s.op){case">=":case">":o=bw(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=Oe}Uf({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(e!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(t)){let o=e.position[s];Uf({value:r,inclusive:i},{value:o,inclusive:e.inclusive})>0&&(r=o,i=e.inclusive);break}}return{value:r,inclusive:i}}var Qt=class{constructor(t,e=null,r=[],i=[],s=null,o="F",a=null,u=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=u,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}};function Xm(n,t,e,r,i,s,o,a){return new Qt(n,t,e,r,i,s,o,a)}function br(n){return new Qt(n)}function $f(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function bl(n){return n.collectionGroup!==null}function ur(n){let t=A(n);if(t.le===null){t.le=[];let e=new Set;for(let s of t.explicitOrderBy)t.le.push(s),e.add(s.field.canonicalString());let r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new W(st.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(t).forEach(s=>{e.has(s.canonicalString())||s.isKeyField()||t.le.push(new En(s,r))}),e.has(st.keyField().canonicalString())||t.le.push(new En(st.keyField(),r))}return t.le}function xt(n){let t=A(n);return t.he||(t.he=Cw(t,ur(n))),t.he}function Cw(n,t){if(n.limitType==="F")return Yu(n.path,n.collectionGroup,t,n.filters,n.limit,n.startAt,n.endAt);{t=t.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new En(i.field,s)});let e=n.endAt?new le(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new le(n.startAt.position,n.startAt.inclusive):null;return Yu(n.path,n.collectionGroup,t,n.filters,n.limit,e,r)}}function Xu(n,t){let e=n.filters.concat([t]);return new Qt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),e,n.limit,n.limitType,n.startAt,n.endAt)}function lo(n,t,e){return new Qt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,e,n.startAt,n.endAt)}function $i(n,t){return Ki(xt(n),xt(t))&&n.limitType===t.limitType}function Jm(n){return`${Tn(xt(n))}|lt:${n.limitType}`}function nr(n){return`Query(target=${function(e){let r=e.path.canonicalString();return e.collectionGroup!==null&&(r+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(r+=`, filters: [${e.filters.map(i=>Hm(i)).join(", ")}]`),Gi(e.limit)||(r+=", limit: "+e.limit),e.orderBy.length>0&&(r+=`, orderBy: [${e.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),e.startAt&&(r+=", startAt: ",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map(i=>dr(i)).join(",")),e.endAt&&(r+=", endAt: ",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map(i=>dr(i)).join(",")),`Target(${r})`}(xt(n))}; limitType=${n.limitType})`}function Wi(n,t){return t.isFoundDocument()&&function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):I.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,t)&&function(r,i){for(let s of ur(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,t)&&function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0}(n,t)&&function(r,i){return!(r.startAt&&!function(o,a,u){let c=jf(o,a,u);return o.inclusive?c<=0:c<0}(r.startAt,ur(r),i)||r.endAt&&!function(o,a,u){let c=jf(o,a,u);return o.inclusive?c>=0:c>0}(r.endAt,ur(r),i))}(n,t)}function Zm(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function tg(n){return(t,e)=>{let r=!1;for(let i of ur(n)){let s=xw(i,t,e);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function xw(n,t,e){let r=n.field.isKeyField()?I.comparator(t.key,e.key):function(s,o,a){let u=o.data.field(s),c=a.data.field(s);return u!==null&&c!==null?Ge(u,c):S()}(n.field,t,e);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return S()}}var he=class{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){let e=this.mapKeyFn(t),r=this.inner[e];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,t))return s}}has(t){return this.get(t)!==void 0}set(t,e){let r=this.mapKeyFn(t),i=this.inner[r];if(i===void 0)return this.inner[r]=[[t,e]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],t))return void(i[s]=[t,e]);i.push([t,e]),this.innerSize++}delete(t){let e=this.mapKeyFn(t),r=this.inner[e];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return r.length===1?delete this.inner[e]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(t){Dn(this.inner,(e,r)=>{for(let[i,s]of r)t(i,s)})}isEmpty(){return jm(this.inner)}size(){return this.innerSize}};var Dw=new Y(I.comparator);function Nt(){return Dw}var eg=new Y(I.comparator);function fi(...n){let t=eg;for(let e of n)t=t.insert(e.key,e);return t}function ng(n){let t=eg;return n.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function se(){return pi()}function rg(){return pi()}function pi(){return new he(n=>n.toString(),(n,t)=>n.isEqual(t))}var kw=new Y(I.comparator),Vw=new W(I.comparator);function k(...n){let t=Vw;for(let e of n)t=t.add(e);return t}var Nw=new W(D);function Pl(){return Nw}function ig(n,t){if(n.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ii(t)?"-0":t}}function sg(n){return{integerValue:""+n}}function og(n,t){return Om(t)?sg(t):ig(n,t)}var mr=class{constructor(){this._=void 0}};function Fw(n,t,e){return n instanceof Ke?function(i,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Yo(s)&&(s=Sl(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(e,t):n instanceof we?ug(n,t):n instanceof ve?cg(n,t):function(i,s){let o=ag(i,s),a=Wf(o)+Wf(i.Ie);return Bu(o)&&Bu(i.Ie)?sg(a):ig(i.serializer,a)}(n,t)}function Mw(n,t,e){return n instanceof we?ug(n,t):n instanceof ve?cg(n,t):e}function ag(n,t){return n instanceof $e?function(r){return Bu(r)||function(s){return!!s&&"doubleValue"in s}(r)}(t)?t:{integerValue:0}:null}var Ke=class extends mr{},we=class extends mr{constructor(t){super(),this.elements=t}};function ug(n,t){let e=lg(t);for(let r of n.elements)e.some(i=>ce(i,r))||e.push(r);return{arrayValue:{values:e}}}var ve=class extends mr{constructor(t){super(),this.elements=t}};function cg(n,t){let e=lg(t);for(let r of n.elements)e=e.filter(i=>!ce(i,r));return{arrayValue:{values:e}}}var $e=class extends mr{constructor(t,e){super(),this.serializer=t,this.Ie=e}};function Wf(n){return et(n.integerValue||n.doubleValue)}function lg(n){return Si(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var An=class{constructor(t,e){this.field=t,this.transform=e}};function Ow(n,t){return n.field.isEqual(t.field)&&function(r,i){return r instanceof we&&i instanceof we||r instanceof ve&&i instanceof ve?lr(r.elements,i.elements,ce):r instanceof $e&&i instanceof $e?ce(r.Ie,i.Ie):r instanceof Ke&&i instanceof Ke}(n.transform,t.transform)}var Ju=class{constructor(t,e){this.version=t,this.transformResults=e}},nt=class n{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new n}static exists(t){return new n(void 0,t)}static updateTime(t){return new n(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}};function Ys(n,t){return n.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(n.updateTime):n.exists===void 0||n.exists===t.isFoundDocument()}var gr=class{};function hg(n,t){if(!n.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return n.isNoDocument()?new Qe(n.key,nt.none()):new We(n.key,n.data,nt.none());{let e=n.data,r=Rt.empty(),i=new W(st.comparator);for(let s of t.fields)if(!i.has(s)){let o=e.field(s);o===null&&s.length>1&&(s=s.popLast(),o=e.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new Ht(n.key,r,new Lt(i.toArray()),nt.none())}}function Lw(n,t,e){n instanceof We?function(i,s,o){let a=i.value.clone(),u=Hf(i.fieldTransforms,s,o.transformResults);a.setAll(u),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,t,e):n instanceof Ht?function(i,s,o){if(!Ys(i.precondition,s))return void s.convertToUnknownDocument(o.version);let a=Hf(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(dg(i)),u.setAll(a),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,t,e):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,t,e)}function _i(n,t,e,r){return n instanceof We?function(s,o,a,u){if(!Ys(s.precondition,o))return a;let c=s.value.clone(),l=Yf(s.fieldTransforms,u,o);return c.setAll(l),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,t,e,r):n instanceof Ht?function(s,o,a,u){if(!Ys(s.precondition,o))return a;let c=Yf(s.fieldTransforms,u,o),l=o.data;return l.setAll(dg(s)),l.setAll(c),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(h=>h.field))}(n,t,e,r):function(s,o,a){return Ys(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,t,e)}function qw(n,t){let e=null;for(let r of n.fieldTransforms){let i=t.data.field(r.field),s=ag(r.transform,i||null);s!=null&&(e===null&&(e=Rt.empty()),e.set(r.field,s))}return e||null}function Qf(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&lr(r,i,(s,o)=>Ow(s,o))}(n.fieldTransforms,t.fieldTransforms)&&(n.type===0?n.value.isEqual(t.value):n.type!==1||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask))}var We=class extends gr{constructor(t,e,r,i=[]){super(),this.key=t,this.value=e,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},Ht=class extends gr{constructor(t,e,r,i,s=[]){super(),this.key=t,this.data=e,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function dg(n){let t=new Map;return n.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){let r=n.data.field(e);t.set(e,r)}}),t}function Hf(n,t,e){let r=new Map;b(n.length===e.length);for(let i=0;i<e.length;i++){let s=n[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,Mw(o,a,e[i]))}return r}function Yf(n,t,e){let r=new Map;for(let i of n){let s=i.transform,o=e.data.field(i.field);r.set(i.field,Fw(s,o,t))}return r}var Qe=class extends gr{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Ri=class extends gr{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var bi=class{constructor(t,e,r,i){this.batchId=t,this.localWriteTime=e,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(t,e){let r=e.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(t.key)&&Lw(s,t,r[i])}}applyToLocalView(t,e){for(let r of this.baseMutations)r.key.isEqual(t.key)&&(e=_i(r,t,e,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(t.key)&&(e=_i(r,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){let r=rg();return this.mutations.forEach(i=>{let s=t.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=e.has(i.key)?null:a;let u=hg(o,a);u!==null&&r.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(P.min())}),r}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),k())}isEqual(t){return this.batchId===t.batchId&&lr(this.mutations,t.mutations,(e,r)=>Qf(e,r))&&lr(this.baseMutations,t.baseMutations,(e,r)=>Qf(e,r))}},Zu=class n{constructor(t,e,r,i){this.batch=t,this.commitVersion=e,this.mutationResults=r,this.docVersions=i}static from(t,e,r){b(t.mutations.length===r.length);let i=function(){return kw}(),s=t.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(t,e,r,i)}};var Pi=class{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var tc=class{constructor(t,e){this.count=t,this.unchangedNames=e}};var ct,L;function fg(n){switch(n){default:return S();case g.CANCELLED:case g.UNKNOWN:case g.DEADLINE_EXCEEDED:case g.RESOURCE_EXHAUSTED:case g.INTERNAL:case g.UNAVAILABLE:case g.UNAUTHENTICATED:return!1;case g.INVALID_ARGUMENT:case g.NOT_FOUND:case g.ALREADY_EXISTS:case g.PERMISSION_DENIED:case g.FAILED_PRECONDITION:case g.ABORTED:case g.OUT_OF_RANGE:case g.UNIMPLEMENTED:case g.DATA_LOSS:return!0}}function mg(n){if(n===void 0)return it("GRPC error has no .code"),g.UNKNOWN;switch(n){case ct.OK:return g.OK;case ct.CANCELLED:return g.CANCELLED;case ct.UNKNOWN:return g.UNKNOWN;case ct.DEADLINE_EXCEEDED:return g.DEADLINE_EXCEEDED;case ct.RESOURCE_EXHAUSTED:return g.RESOURCE_EXHAUSTED;case ct.INTERNAL:return g.INTERNAL;case ct.UNAVAILABLE:return g.UNAVAILABLE;case ct.UNAUTHENTICATED:return g.UNAUTHENTICATED;case ct.INVALID_ARGUMENT:return g.INVALID_ARGUMENT;case ct.NOT_FOUND:return g.NOT_FOUND;case ct.ALREADY_EXISTS:return g.ALREADY_EXISTS;case ct.PERMISSION_DENIED:return g.PERMISSION_DENIED;case ct.FAILED_PRECONDITION:return g.FAILED_PRECONDITION;case ct.ABORTED:return g.ABORTED;case ct.OUT_OF_RANGE:return g.OUT_OF_RANGE;case ct.UNIMPLEMENTED:return g.UNIMPLEMENTED;case ct.DATA_LOSS:return g.DATA_LOSS;default:return S()}}(L=ct||(ct={}))[L.OK=0]="OK",L[L.CANCELLED=1]="CANCELLED",L[L.UNKNOWN=2]="UNKNOWN",L[L.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",L[L.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",L[L.NOT_FOUND=5]="NOT_FOUND",L[L.ALREADY_EXISTS=6]="ALREADY_EXISTS",L[L.PERMISSION_DENIED=7]="PERMISSION_DENIED",L[L.UNAUTHENTICATED=16]="UNAUTHENTICATED",L[L.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",L[L.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",L[L.ABORTED=10]="ABORTED",L[L.OUT_OF_RANGE=11]="OUT_OF_RANGE",L[L.UNIMPLEMENTED=12]="UNIMPLEMENTED",L[L.INTERNAL=13]="INTERNAL",L[L.UNAVAILABLE=14]="UNAVAILABLE",L[L.DATA_LOSS=15]="DATA_LOSS";var Xf=null;function gg(){return new TextEncoder}var Bw=new hn([4294967295,4294967295],0);function Jf(n){let t=gg().encode(n),e=new Df;return e.update(t),new Uint8Array(e.digest())}function Zf(n){let t=new DataView(n.buffer),e=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new hn([e,r],0),new hn([i,s],0)]}var ec=class n{constructor(t,e,r){if(this.bitmap=t,this.padding=e,this.hashCount=r,e<0||e>=8)throw new yn(`Invalid padding: ${e}`);if(r<0)throw new yn(`Invalid hash count: ${r}`);if(t.length>0&&this.hashCount===0)throw new yn(`Invalid hash count: ${r}`);if(t.length===0&&e!==0)throw new yn(`Invalid padding when bitmap length is 0: ${e}`);this.Te=8*t.length-e,this.Ee=hn.fromNumber(this.Te)}de(t,e,r){let i=t.add(e.multiply(hn.fromNumber(r)));return i.compare(Bw)===1&&(i=new hn([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Ee).toNumber()}Ae(t){return(this.bitmap[Math.floor(t/8)]&1<<t%8)!=0}mightContain(t){if(this.Te===0)return!1;let e=Jf(t),[r,i]=Zf(e);for(let s=0;s<this.hashCount;s++){let o=this.de(r,i,s);if(!this.Ae(o))return!1}return!0}static create(t,e,r){let i=t%8==0?0:8-t%8,s=new Uint8Array(Math.ceil(t/8)),o=new n(s,i,e);return r.forEach(a=>o.insert(a)),o}insert(t){if(this.Te===0)return;let e=Jf(t),[r,i]=Zf(e);for(let s=0;s<this.hashCount;s++){let o=this.de(r,i,s);this.Re(o)}}Re(t){let e=Math.floor(t/8),r=t%8;this.bitmap[e]|=1<<r}},yn=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Ci=class n{constructor(t,e,r,i,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e,r){let i=new Map;return i.set(t,xi.createSynthesizedTargetChangeForCurrentChange(t,e,r)),new n(P.min(),i,new Y(D),Nt(),k())}},xi=class n{constructor(t,e,r,i,s){this.resumeToken=t,this.current=e,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e,r){return new n(r,e,k(),k(),k())}};var cr=class{constructor(t,e,r,i){this.Ve=t,this.removedTargetIds=e,this.key=r,this.me=i}},ho=class{constructor(t,e){this.targetId=t,this.fe=e}},fo=class{constructor(t,e,r=yt.EMPTY_BYTE_STRING,i=null){this.state=t,this.targetIds=e,this.resumeToken=r,this.cause=i}},mo=class{constructor(){this.ge=0,this.pe=em(),this.ye=yt.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return this.ge!==0}get De(){return this.Se}Ce(t){t.approximateByteSize()>0&&(this.Se=!0,this.ye=t)}ve(){let t=k(),e=k(),r=k();return this.pe.forEach((i,s)=>{switch(s){case 0:t=t.add(i);break;case 2:e=e.add(i);break;case 1:r=r.add(i);break;default:S()}}),new xi(this.ye,this.we,t,e,r)}Fe(){this.Se=!1,this.pe=em()}Me(t,e){this.Se=!0,this.pe=this.pe.insert(t,e)}xe(t){this.Se=!0,this.pe=this.pe.remove(t)}Oe(){this.ge+=1}Ne(){this.ge-=1,b(this.ge>=0)}Be(){this.Se=!0,this.we=!0}},nc=class{constructor(t){this.Le=t,this.ke=new Map,this.qe=Nt(),this.Qe=tm(),this.Ke=new Y(D)}$e(t){for(let e of t.Ve)t.me&&t.me.isFoundDocument()?this.Ue(e,t.me):this.We(e,t.key,t.me);for(let e of t.removedTargetIds)this.We(e,t.key,t.me)}Ge(t){this.forEachTarget(t,e=>{let r=this.ze(e);switch(t.state){case 0:this.je(e)&&r.Ce(t.resumeToken);break;case 1:r.Ne(),r.be||r.Fe(),r.Ce(t.resumeToken);break;case 2:r.Ne(),r.be||this.removeTarget(e);break;case 3:this.je(e)&&(r.Be(),r.Ce(t.resumeToken));break;case 4:this.je(e)&&(this.He(e),r.Ce(t.resumeToken));break;default:S()}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ke.forEach((r,i)=>{this.je(i)&&e(i)})}Je(t){let e=t.targetId,r=t.fe.count,i=this.Ye(e);if(i){let s=i.target;if(uo(s))if(r===0){let o=new I(s.path);this.We(e,o,ft.newNoDocument(o,P.min()))}else b(r===1);else{let o=this.Ze(e);if(o!==r){let a=this.Xe(t),u=a?this.et(a,t,o):1;if(u!==0){this.He(e);let c=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(e,c)}Xf?.tt(function(l,h,d,f,E){var v,w,C,V,R,N;let F={localCacheCount:l,existenceFilterCount:h.count,databaseId:d.database,projectId:d.projectId},B=h.unchangedNames;return B&&(F.bloomFilter={applied:E===0,hashCount:(v=B?.hashCount)!==null&&v!==void 0?v:0,bitmapLength:(V=(C=(w=B?.bits)===null||w===void 0?void 0:w.bitmap)===null||C===void 0?void 0:C.length)!==null&&V!==void 0?V:0,padding:(N=(R=B?.bits)===null||R===void 0?void 0:R.padding)!==null&&N!==void 0?N:0,mightContain:at=>{var Jt;return(Jt=f?.mightContain(at))!==null&&Jt!==void 0&&Jt}}),F}(o,t.fe,this.Le.nt(),a,u))}}}}Xe(t){let e=t.fe.unchangedNames;if(!e||!e.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=e,o,a;try{o=je(r).toUint8Array()}catch(u){if(u instanceof so)return jt("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{a=new ec(o,i,s)}catch(u){return jt(u instanceof yn?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return a.Te===0?null:a}et(t,e,r){return e.fe.count===r-this.rt(t,e.targetId)?0:2}rt(t,e){let r=this.Le.getRemoteKeysForTarget(e),i=0;return r.forEach(s=>{let o=this.Le.nt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;t.mightContain(a)||(this.We(e,s,null),i++)}),i}it(t){let e=new Map;this.ke.forEach((s,o)=>{let a=this.Ye(o);if(a){if(s.current&&uo(a.target)){let u=new I(a.target.path);this.qe.get(u)!==null||this.st(o,u)||this.We(o,u,ft.newNoDocument(u,t))}s.De&&(e.set(o,s.ve()),s.Fe())}});let r=k();this.Qe.forEach((s,o)=>{let a=!0;o.forEachWhile(u=>{let c=this.Ye(u);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(s))}),this.qe.forEach((s,o)=>o.setReadTime(t));let i=new Ci(t,e,this.Ke,this.qe,r);return this.qe=Nt(),this.Qe=tm(),this.Ke=new Y(D),i}Ue(t,e){if(!this.je(t))return;let r=this.st(t,e.key)?2:0;this.ze(t).Me(e.key,r),this.qe=this.qe.insert(e.key,e),this.Qe=this.Qe.insert(e.key,this.ot(e.key).add(t))}We(t,e,r){if(!this.je(t))return;let i=this.ze(t);this.st(t,e)?i.Me(e,1):i.xe(e),this.Qe=this.Qe.insert(e,this.ot(e).delete(t)),r&&(this.qe=this.qe.insert(e,r))}removeTarget(t){this.ke.delete(t)}Ze(t){let e=this.ze(t).ve();return this.Le.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Oe(t){this.ze(t).Oe()}ze(t){let e=this.ke.get(t);return e||(e=new mo,this.ke.set(t,e)),e}ot(t){let e=this.Qe.get(t);return e||(e=new W(D),this.Qe=this.Qe.insert(t,e)),e}je(t){let e=this.Ye(t)!==null;return e||y("WatchChangeAggregator","Detected inactive target",t),e}Ye(t){let e=this.ke.get(t);return e&&e.be?null:this.Le._t(t)}He(t){this.ke.set(t,new mo),this.Le.getRemoteKeysForTarget(t).forEach(e=>{this.We(t,e,null)})}st(t,e){return this.Le.getRemoteKeysForTarget(t).has(e)}};function tm(){return new Y(I.comparator)}function em(){return new Y(I.comparator)}var Uw=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),jw=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),zw=(()=>({and:"AND",or:"OR"}))(),rc=class{constructor(t,e){this.databaseId=t,this.useProto3Json=e}};function ic(n,t){return n.useProto3Json||Gi(t)?t:{value:t}}function pr(n,t){return n.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function pg(n,t){return n.useProto3Json?t.toBase64():t.toUint8Array()}function Gw(n,t){return pr(n,t.toTimestamp())}function ot(n){return b(!!n),P.fromTimestamp(function(e){let r=Ue(e);return new Z(r.seconds,r.nanos)}(n))}function Cl(n,t){return function(r){return new U(["projects",r.projectId,"databases",r.database])}(n).child("documents").child(t).canonicalString()}function _g(n){let t=U.fromString(n);return b(Rg(t)),t}function Di(n,t){return Cl(n.databaseId,t.path)}function ae(n,t){let e=_g(t);if(e.get(1)!==n.databaseId.projectId)throw new _(g.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+n.databaseId.projectId);if(e.get(3)!==n.databaseId.database)throw new _(g.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+n.databaseId.database);return new I(wg(e))}function sc(n,t){return Cl(n.databaseId,t)}function yg(n){let t=_g(n);return t.length===4?U.emptyPath():wg(t)}function ki(n){return new U(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function wg(n){return b(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function nm(n,t,e){return{name:Di(n,t),fields:e.value.mapValue.fields}}function vg(n,t,e){let r=ae(n,t.name),i=ot(t.updateTime),s=t.createTime?ot(t.createTime):P.min(),o=new Rt({mapValue:{fields:t.fields}}),a=ft.newFoundDocument(r,i,s,o);return e&&a.setHasCommittedMutations(),e?a.setHasCommittedMutations():a}function Kw(n,t){return"found"in t?function(r,i){b(!!i.found),i.found.name,i.found.updateTime;let s=ae(r,i.found.name),o=ot(i.found.updateTime),a=i.found.createTime?ot(i.found.createTime):P.min(),u=new Rt({mapValue:{fields:i.found.fields}});return ft.newFoundDocument(s,o,a,u)}(n,t):"missing"in t?function(r,i){b(!!i.missing),b(!!i.readTime);let s=ae(r,i.missing),o=ot(i.readTime);return ft.newNoDocument(s,o)}(n,t):S()}function $w(n,t){let e;if("targetChange"in t){t.targetChange;let r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:S()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(c,l){return c.useProto3Json?(b(l===void 0||typeof l=="string"),yt.fromBase64String(l||"")):(b(l===void 0||l instanceof Uint8Array),yt.fromUint8Array(l||new Uint8Array))}(n,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(c){let l=c.code===void 0?g.UNKNOWN:mg(c.code);return new _(l,c.message||"")}(o);e=new fo(r,i,s,a||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let i=ae(n,r.document.name),s=ot(r.document.updateTime),o=r.document.createTime?ot(r.document.createTime):P.min(),a=new Rt({mapValue:{fields:r.document.fields}}),u=ft.newFoundDocument(i,s,o,a),c=r.targetIds||[],l=r.removedTargetIds||[];e=new cr(c,l,u.key,u)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let i=ae(n,r.document),s=r.readTime?ot(r.readTime):P.min(),o=ft.newNoDocument(i,s),a=r.removedTargetIds||[];e=new cr([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let i=ae(n,r.document),s=r.removedTargetIds||[];e=new cr([],s,i,null)}else{if(!("filter"in t))return S();{t.filter;let r=t.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new tc(i,s),a=r.targetId;e=new ho(a,o)}}return e}function Vi(n,t){let e;if(t instanceof We)e={update:nm(n,t.key,t.value)};else if(t instanceof Qe)e={delete:Di(n,t.key)};else if(t instanceof Ht)e={update:nm(n,t.key,t.data),updateMask:Jw(t.fieldMask)};else{if(!(t instanceof Ri))return S();e={verify:Di(n,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(r=>function(s,o){let a=o.transform;if(a instanceof Ke)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof we)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof ve)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof $e)return{fieldPath:o.field.canonicalString(),increment:a.Ie};throw S()}(0,r))),t.precondition.isNone||(e.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:Gw(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:S()}(n,t.precondition)),e}function oc(n,t){let e=t.currentDocument?function(s){return s.updateTime!==void 0?nt.updateTime(ot(s.updateTime)):s.exists!==void 0?nt.exists(s.exists):nt.none()}(t.currentDocument):nt.none(),r=t.updateTransforms?t.updateTransforms.map(i=>function(o,a){let u=null;if("setToServerValue"in a)b(a.setToServerValue==="REQUEST_TIME"),u=new Ke;else if("appendMissingElements"in a){let l=a.appendMissingElements.values||[];u=new we(l)}else if("removeAllFromArray"in a){let l=a.removeAllFromArray.values||[];u=new ve(l)}else"increment"in a?u=new $e(o,a.increment):S();let c=st.fromServerFormat(a.fieldPath);return new An(c,u)}(n,i)):[];if(t.update){t.update.name;let i=ae(n,t.update.name),s=new Rt({mapValue:{fields:t.update.fields}});if(t.updateMask){let o=function(u){let c=u.fieldPaths||[];return new Lt(c.map(l=>st.fromServerFormat(l)))}(t.updateMask);return new Ht(i,s,o,e,r)}return new We(i,s,e,r)}if(t.delete){let i=ae(n,t.delete);return new Qe(i,e)}if(t.verify){let i=ae(n,t.verify);return new Ri(i,e)}return S()}function Ww(n,t){return n&&n.length>0?(b(t!==void 0),n.map(e=>function(i,s){let o=i.updateTime?ot(i.updateTime):ot(s);return o.isEqual(P.min())&&(o=ot(s)),new Ju(o,i.transformResults||[])}(e,t))):[]}function Ig(n,t){return{documents:[sc(n,t.path)]}}function Eg(n,t){let e={structuredQuery:{}},r=t.path;t.collectionGroup!==null?(e.parent=sc(n,r),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(e.parent=sc(n,r.popLast()),e.structuredQuery.from=[{collectionId:r.lastSegment()}]);let i=function(u){if(u.length!==0)return Sg(K.create(u,"and"))}(t.filters);i&&(e.structuredQuery.where=i);let s=function(u){if(u.length!==0)return u.map(c=>function(h){return{field:rr(h.field),direction:Hw(h.dir)}}(c))}(t.orderBy);s&&(e.structuredQuery.orderBy=s);let o=ic(n,t.limit);return o!==null&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(t.startAt)),t.endAt&&(e.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(t.endAt)),e}function Tg(n){let t=yg(n.parent),e=n.structuredQuery,r=e.from?e.from.length:0,i=null;if(r>0){b(r===1);let l=e.from[0];l.allDescendants?i=l.collectionId:t=t.child(l.collectionId)}let s=[];e.where&&(s=function(h){let d=Ag(h);return d instanceof K&&Rl(d)?d.getFilters():[d]}(e.where));let o=[];e.orderBy&&(o=function(h){return h.map(d=>function(E){return new En(ir(E.field),function(w){switch(w){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(E.direction))}(d))}(e.orderBy));let a=null;e.limit&&(a=function(h){let d;return d=typeof h=="object"?h.value:h,Gi(d)?null:d}(e.limit));let u=null;e.startAt&&(u=function(h){let d=!!h.before,f=h.values||[];return new le(f,d)}(e.startAt));let c=null;return e.endAt&&(c=function(h){let d=!h.before,f=h.values||[];return new le(f,d)}(e.endAt)),Xm(t,i,o,s,a,"F",u,c)}function Qw(n,t){let e=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return S()}}(t.purpose);return e==null?null:{"goog-listen-tags":e}}function Ag(n){return n.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":let r=ir(e.unaryFilter.field);return O.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=ir(e.unaryFilter.field);return O.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=ir(e.unaryFilter.field);return O.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=ir(e.unaryFilter.field);return O.create(o,"!=",{nullValue:"NULL_VALUE"});default:return S()}}(n):n.fieldFilter!==void 0?function(e){return O.create(ir(e.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return S()}}(e.fieldFilter.op),e.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(e){return K.create(e.compositeFilter.filters.map(r=>Ag(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return S()}}(e.compositeFilter.op))}(n):S()}function Hw(n){return Uw[n]}function Yw(n){return jw[n]}function Xw(n){return zw[n]}function rr(n){return{fieldPath:n.canonicalString()}}function ir(n){return st.fromServerFormat(n.fieldPath)}function Sg(n){return n instanceof O?function(e){if(e.op==="=="){if(qf(e.value))return{unaryFilter:{field:rr(e.field),op:"IS_NAN"}};if(Lf(e.value))return{unaryFilter:{field:rr(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(qf(e.value))return{unaryFilter:{field:rr(e.field),op:"IS_NOT_NAN"}};if(Lf(e.value))return{unaryFilter:{field:rr(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:rr(e.field),op:Yw(e.op),value:e.value}}}(n):n instanceof K?function(e){let r=e.getFilters().map(i=>Sg(i));return r.length===1?r[0]:{compositeFilter:{op:Xw(e.op),filters:r}}}(n):S()}function Jw(n){let t=[];return n.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function Rg(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var _r=class n{constructor(t,e,r,i,s=P.min(),o=P.min(),a=yt.EMPTY_BYTE_STRING,u=null){this.target=t,this.targetId=e,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=u}withSequenceNumber(t){return new n(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}};var go=class{constructor(t){this.ut=t}};function Zw(n,t){let e;if(t.document)e=vg(n.ut,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let r=I.fromSegments(t.noDocument.path),i=Rn(t.noDocument.readTime);e=ft.newNoDocument(r,i),t.hasCommittedMutations&&e.setHasCommittedMutations()}else{if(!t.unknownDocument)return S();{let r=I.fromSegments(t.unknownDocument.path),i=Rn(t.unknownDocument.version);e=ft.newUnknownDocument(r,i)}}return t.readTime&&e.setReadTime(function(i){let s=new Z(i[0],i[1]);return P.fromTimestamp(s)}(t.readTime)),e}function rm(n,t){let e=t.key,r={prefixPath:e.getCollectionPath().popLast().toArray(),collectionGroup:e.collectionGroup,documentId:e.path.lastSegment(),readTime:po(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=function(s,o){return{name:Di(s,o.key),fields:o.data.value.mapValue.fields,updateTime:pr(s,o.version.toTimestamp()),createTime:pr(s,o.createTime.toTimestamp())}}(n.ut,t);else if(t.isNoDocument())r.noDocument={path:e.path.toArray(),readTime:Sn(t.version)};else{if(!t.isUnknownDocument())return S();r.unknownDocument={path:e.path.toArray(),version:Sn(t.version)}}return r}function po(n){let t=n.toTimestamp();return[t.seconds,t.nanoseconds]}function Sn(n){let t=n.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function Rn(n){let t=new Z(n.seconds,n.nanoseconds);return P.fromTimestamp(t)}function gn(n,t){let e=(t.baseMutations||[]).map(s=>oc(n.ut,s));for(let s=0;s<t.mutations.length-1;++s){let o=t.mutations[s];if(s+1<t.mutations.length&&t.mutations[s+1].transform!==void 0){let a=t.mutations[s+1];o.updateTransforms=a.transform.fieldTransforms,t.mutations.splice(s+1,1),++s}}let r=t.mutations.map(s=>oc(n.ut,s)),i=Z.fromMillis(t.localWriteTimeMs);return new bi(t.batchId,i,e,r)}function mi(n){let t=Rn(n.readTime),e=n.lastLimboFreeSnapshotVersion!==void 0?Rn(n.lastLimboFreeSnapshotVersion):P.min(),r;return r=function(s){return s.documents!==void 0}(n.query)?function(s){return b(s.documents.length===1),xt(br(yg(s.documents[0])))}(n.query):function(s){return xt(Tg(s))}(n.query),new _r(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,t,e,yt.fromBase64String(n.resumeToken))}function bg(n,t){let e=Sn(t.snapshotVersion),r=Sn(t.lastLimboFreeSnapshotVersion),i;i=uo(t.target)?Ig(n.ut,t.target):Eg(n.ut,t.target);let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:Tn(t.target),readTime:e,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function xl(n){let t=Tg({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?lo(t,t.limit,"L"):t}function Eu(n,t){return new Pi(t.largestBatchId,oc(n.ut,t.overlayMutation))}function im(n,t){let e=t.path.lastSegment();return[n,Ct(t.path.popLast()),e]}function sm(n,t,e,r){return{indexId:n,uid:t.uid||"",sequenceNumber:e,readTime:Sn(r.readTime),documentKey:Ct(r.documentKey.path),largestBatchId:r.largestBatchId}}var ac=class{getBundleMetadata(t,e){return om(t).get(e).next(r=>{if(r)return function(s){return{id:s.bundleId,createTime:Rn(s.createTime),version:s.version}}(r)})}saveBundleMetadata(t,e){return om(t).put(function(i){return{bundleId:i.id,createTime:Sn(ot(i.createTime)),version:i.version}}(e))}getNamedQuery(t,e){return am(t).get(e).next(r=>{if(r)return function(s){return{name:s.name,query:xl(s.bundledQuery),readTime:Rn(s.readTime)}}(r)})}saveNamedQuery(t,e){return am(t).put(function(i){return{name:i.name,readTime:Sn(ot(i.readTime)),bundledQuery:i.bundledQuery}}(e))}};function om(n){return wt(n,"bundles")}function am(n){return wt(n,"namedQueries")}var _o=class n{constructor(t,e){this.serializer=t,this.userId=e}static ct(t,e){let r=e.uid||"";return new n(t,r)}getOverlay(t,e){return ci(t).get(im(this.userId,e)).next(r=>r?Eu(this.serializer,r):null)}getOverlays(t,e){let r=se();return m.forEach(e,i=>this.getOverlay(t,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(t,e,r){let i=[];return r.forEach((s,o)=>{let a=new Pi(e,o);i.push(this.lt(t,a))}),m.waitFor(i)}removeOverlaysForBatchId(t,e,r){let i=new Set;e.forEach(o=>i.add(Ct(o.getCollectionPath())));let s=[];return i.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(ci(t).H("collectionPathOverlayIndex",a))}),m.waitFor(s)}getOverlaysForCollection(t,e,r){let i=se(),s=Ct(e),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return ci(t).W("collectionPathOverlayIndex",o).next(a=>{for(let u of a){let c=Eu(this.serializer,u);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(t,e,r,i){let s=se(),o,a=IDBKeyRange.bound([this.userId,e,r],[this.userId,e,Number.POSITIVE_INFINITY],!0);return ci(t).Y({index:"collectionGroupOverlayIndex",range:a},(u,c,l)=>{let h=Eu(this.serializer,c);s.size()<i||h.largestBatchId===o?(s.set(h.getKey(),h),o=h.largestBatchId):l.done()}).next(()=>s)}lt(t,e){return ci(t).put(function(i,s,o){let[a,u,c]=im(s,o.mutation.key);return{userId:s,collectionPath:u,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Vi(i.ut,o.mutation)}}(this.serializer,this.userId,e))}};function ci(n){return wt(n,"documentOverlays")}var _e=class{constructor(){}ht(t,e){this.Pt(t,e),e.It()}Pt(t,e){if("nullValue"in t)this.Tt(e,5);else if("booleanValue"in t)this.Tt(e,10),e.Et(t.booleanValue?1:0);else if("integerValue"in t)this.Tt(e,15),e.Et(et(t.integerValue));else if("doubleValue"in t){let r=et(t.doubleValue);isNaN(r)?this.Tt(e,13):(this.Tt(e,15),Ii(r)?e.Et(0):e.Et(r))}else if("timestampValue"in t){let r=t.timestampValue;this.Tt(e,20),typeof r=="string"?e.dt(r):(e.dt(`${r.seconds||""}`),e.Et(r.nanos||0))}else if("stringValue"in t)this.At(t.stringValue,e),this.Rt(e);else if("bytesValue"in t)this.Tt(e,30),e.Vt(je(t.bytesValue)),this.Rt(e);else if("referenceValue"in t)this.ft(t.referenceValue,e);else if("geoPointValue"in t){let r=t.geoPointValue;this.Tt(e,45),e.Et(r.latitude||0),e.Et(r.longitude||0)}else"mapValue"in t?Gm(t)?this.Tt(e,Number.MAX_SAFE_INTEGER):(this.gt(t.mapValue,e),this.Rt(e)):"arrayValue"in t?(this.yt(t.arrayValue,e),this.Rt(e)):S()}At(t,e){this.Tt(e,25),this.wt(t,e)}wt(t,e){e.dt(t)}gt(t,e){let r=t.fields||{};this.Tt(e,55);for(let i of Object.keys(r))this.At(i,e),this.Pt(r[i],e)}yt(t,e){let r=t.values||[];this.Tt(e,50);for(let i of r)this.Pt(i,e)}ft(t,e){this.Tt(e,37),I.fromName(t).path.forEach(r=>{this.Tt(e,60),this.wt(r,e)})}Tt(t,e){t.Et(e)}Rt(t){t.Et(2)}};_e.St=new _e;function tv(n){if(n===0)return 8;let t=0;return!(n>>4)&&(t+=4,n<<=4),!(n>>6)&&(t+=2,n<<=2),!(n>>7)&&(t+=1),t}function um(n){let t=64-function(r){let i=0;for(let s=0;s<8;++s){let o=tv(255&r[s]);if(i+=o,o!==8)break}return i}(n);return Math.ceil(t/8)}var uc=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}bt(t){let e=t[Symbol.iterator](),r=e.next();for(;!r.done;)this.Dt(r.value),r=e.next();this.Ct()}vt(t){let e=t[Symbol.iterator](),r=e.next();for(;!r.done;)this.Ft(r.value),r=e.next();this.Mt()}xt(t){for(let e of t){let r=e.charCodeAt(0);if(r<128)this.Dt(r);else if(r<2048)this.Dt(960|r>>>6),this.Dt(128|63&r);else if(e<"\uD800"||"\uDBFF"<e)this.Dt(480|r>>>12),this.Dt(128|63&r>>>6),this.Dt(128|63&r);else{let i=e.codePointAt(0);this.Dt(240|i>>>18),this.Dt(128|63&i>>>12),this.Dt(128|63&i>>>6),this.Dt(128|63&i)}}this.Ct()}Ot(t){for(let e of t){let r=e.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(e<"\uD800"||"\uDBFF"<e)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{let i=e.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Nt(t){let e=this.Bt(t),r=um(e);this.Lt(1+r),this.buffer[this.position++]=255&r;for(let i=e.length-r;i<e.length;++i)this.buffer[this.position++]=255&e[i]}kt(t){let e=this.Bt(t),r=um(e);this.Lt(1+r),this.buffer[this.position++]=~(255&r);for(let i=e.length-r;i<e.length;++i)this.buffer[this.position++]=~(255&e[i])}qt(){this.Qt(255),this.Qt(255)}Kt(){this.$t(255),this.$t(255)}reset(){this.position=0}seed(t){this.Lt(t.length),this.buffer.set(t,this.position),this.position+=t.length}Ut(){return this.buffer.slice(0,this.position)}Bt(t){let e=function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(t),r=(128&e[0])!=0;e[0]^=r?255:128;for(let i=1;i<e.length;++i)e[i]^=r?255:0;return e}Dt(t){let e=255&t;e===0?(this.Qt(0),this.Qt(255)):e===255?(this.Qt(255),this.Qt(0)):this.Qt(e)}Ft(t){let e=255&t;e===0?(this.$t(0),this.$t(255)):e===255?(this.$t(255),this.$t(0)):this.$t(t)}Ct(){this.Qt(0),this.Qt(1)}Mt(){this.$t(0),this.$t(1)}Qt(t){this.Lt(1),this.buffer[this.position++]=t}$t(t){this.Lt(1),this.buffer[this.position++]=~t}Lt(t){let e=t+this.position;if(e<=this.buffer.length)return;let r=2*this.buffer.length;r<e&&(r=e);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},cc=class{constructor(t){this.Wt=t}Vt(t){this.Wt.bt(t)}dt(t){this.Wt.xt(t)}Et(t){this.Wt.Nt(t)}It(){this.Wt.qt()}},lc=class{constructor(t){this.Wt=t}Vt(t){this.Wt.vt(t)}dt(t){this.Wt.Ot(t)}Et(t){this.Wt.kt(t)}It(){this.Wt.Kt()}},pn=class{constructor(){this.Wt=new uc,this.Gt=new cc(this.Wt),this.zt=new lc(this.Wt)}seed(t){this.Wt.seed(t)}jt(t){return t===0?this.Gt:this.zt}Ut(){return this.Wt.Ut()}reset(){this.Wt.reset()}};var _n=class n{constructor(t,e,r,i){this.indexId=t,this.documentKey=e,this.arrayValue=r,this.directionalValue=i}Ht(){let t=this.directionalValue.length,e=t===0||this.directionalValue[t-1]===255?t+1:t,r=new Uint8Array(e);return r.set(this.directionalValue,0),e!==t?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};function Ve(n,t){let e=n.indexId-t.indexId;return e!==0?e:(e=cm(n.arrayValue,t.arrayValue),e!==0?e:(e=cm(n.directionalValue,t.directionalValue),e!==0?e:I.comparator(n.documentKey,t.documentKey)))}function cm(n,t){for(let e=0;e<n.length&&e<t.length;++e){let r=n[e]-t[e];if(r!==0)return r}return n.length-t.length}var yo=class{constructor(t){this.Jt=new W((e,r)=>st.comparator(e.field,r.field)),this.collectionId=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment(),this.Yt=t.orderBy,this.Zt=[];for(let e of t.filters){let r=e;r.isInequality()?this.Jt=this.Jt.add(r):this.Zt.push(r)}}get Xt(){return this.Jt.size>1}en(t){if(b(t.collectionGroup===this.collectionId),this.Xt)return!1;let e=Vu(t);if(e!==void 0&&!this.tn(e))return!1;let r=fn(t),i=new Set,s=0,o=0;for(;s<r.length&&this.tn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Jt.size>0){let a=this.Jt.getIterator().getNext();if(!i.has(a.field.canonicalString())){let u=r[s];if(!this.nn(a,u)||!this.rn(this.Yt[o++],u))return!1}++s}for(;s<r.length;++s){let a=r[s];if(o>=this.Yt.length||!this.rn(this.Yt[o++],a))return!1}return!0}sn(){if(this.Xt)return null;let t=new W(st.comparator),e=[];for(let r of this.Zt)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")e.push(new ar(r.field,2));else{if(t.has(r.field))continue;t=t.add(r.field),e.push(new ar(r.field,0))}for(let r of this.Yt)r.field.isKeyField()||t.has(r.field)||(t=t.add(r.field),e.push(new ar(r.field,r.dir==="asc"?0:1)));return new hr(hr.UNKNOWN_ID,this.collectionId,e,vi.empty())}tn(t){for(let e of this.Zt)if(this.nn(e,t))return!0;return!1}nn(t,e){if(t===void 0||!t.field.isEqual(e.fieldPath))return!1;let r=t.op==="array-contains"||t.op==="array-contains-any";return e.kind===2===r}rn(t,e){return!!t.field.isEqual(e.fieldPath)&&(e.kind===0&&t.dir==="asc"||e.kind===1&&t.dir==="desc")}};function Pg(n){var t,e;if(b(n instanceof O||n instanceof K),n instanceof O){if(n instanceof ao){let i=((e=(t=n.value.arrayValue)===null||t===void 0?void 0:t.values)===null||e===void 0?void 0:e.map(s=>O.create(n.field,"==",s)))||[];return K.create(i,"or")}return n}let r=n.filters.map(i=>Pg(i));return K.create(r,n.op)}function ev(n){if(n.getFilters().length===0)return[];let t=fc(Pg(n));return b(Cg(t)),hc(t)||dc(t)?[t]:t.getFilters()}function hc(n){return n instanceof O}function dc(n){return n instanceof K&&Rl(n)}function Cg(n){return hc(n)||dc(n)||function(e){if(e instanceof K&&Uu(e)){for(let r of e.getFilters())if(!hc(r)&&!dc(r))return!1;return!0}return!1}(n)}function fc(n){if(b(n instanceof O||n instanceof K),n instanceof O)return n;if(n.filters.length===1)return fc(n.filters[0]);let t=n.filters.map(r=>fc(r)),e=K.create(t,n.op);return e=wo(e),Cg(e)?e:(b(e instanceof K),b(fr(e)),b(e.filters.length>1),e.filters.reduce((r,i)=>Dl(r,i)))}function Dl(n,t){let e;return b(n instanceof O||n instanceof K),b(t instanceof O||t instanceof K),e=n instanceof O?t instanceof O?function(i,s){return K.create([i,s],"and")}(n,t):lm(n,t):t instanceof O?lm(t,n):function(i,s){if(b(i.filters.length>0&&s.filters.length>0),fr(i)&&fr(s))return Qm(i,s.getFilters());let o=Uu(i)?i:s,a=Uu(i)?s:i,u=o.filters.map(c=>Dl(c,a));return K.create(u,"or")}(n,t),wo(e)}function lm(n,t){if(fr(t))return Qm(t,n.getFilters());{let e=t.filters.map(r=>Dl(n,r));return K.create(e,"or")}}function wo(n){if(b(n instanceof O||n instanceof K),n instanceof O)return n;let t=n.getFilters();if(t.length===1)return wo(t[0]);if($m(n))return n;let e=t.map(i=>wo(i)),r=[];return e.forEach(i=>{i instanceof O?r.push(i):i instanceof K&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:K.create(r,n.op)}var mc=class{constructor(){this.on=new Ni}addToCollectionParentIndex(t,e){return this.on.add(e),m.resolve()}getCollectionParents(t,e){return m.resolve(this.on.getEntries(e))}addFieldIndex(t,e){return m.resolve()}deleteFieldIndex(t,e){return m.resolve()}deleteAllFieldIndexes(t){return m.resolve()}createTargetIndexes(t,e){return m.resolve()}getDocumentsMatchingTarget(t,e){return m.resolve(null)}getIndexType(t,e){return m.resolve(0)}getFieldIndexes(t,e){return m.resolve([])}getNextCollectionGroupToUpdate(t){return m.resolve(null)}getMinOffset(t,e){return m.resolve(zt.min())}getMinOffsetFromCollectionGroup(t,e){return m.resolve(zt.min())}updateCollectionGroup(t,e,r){return m.resolve()}updateIndexEntries(t,e){return m.resolve()}},Ni=class{constructor(){this.index={}}add(t){let e=t.lastSegment(),r=t.popLast(),i=this.index[e]||new W(U.comparator),s=!i.has(r);return this.index[e]=i.add(r),s}has(t){let e=t.lastSegment(),r=t.popLast(),i=this.index[e];return i&&i.has(r)}getEntries(t){return(this.index[t]||new W(U.comparator)).toArray()}};var zs=new Uint8Array(0),gc=class{constructor(t,e){this.user=t,this.databaseId=e,this._n=new Ni,this.an=new he(r=>Tn(r),(r,i)=>Ki(r,i)),this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this._n.has(e)){let r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(()=>{this._n.add(e)});let s={collectionId:r,parent:Ct(i)};return hm(t).put(s)}return m.resolve()}getCollectionParents(t,e){let r=[],i=IDBKeyRange.bound([e,""],[Vm(e),""],!1,!0);return hm(t).W(i).next(s=>{for(let o of s){if(o.collectionId!==e)break;r.push(ie(o.parent))}return r})}addFieldIndex(t,e){let r=li(t),i=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])}}(e);delete i.indexId;let s=r.add(i);if(e.indexState){let o=Zn(t);return s.next(a=>{o.put(sm(a,this.user,e.indexState.sequenceNumber,e.indexState.offset))})}return s.next()}deleteFieldIndex(t,e){let r=li(t),i=Zn(t),s=Jn(t);return r.delete(e.indexId).next(()=>i.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))}deleteAllFieldIndexes(t){let e=li(t),r=Jn(t),i=Zn(t);return e.H().next(()=>r.H()).next(()=>i.H())}createTargetIndexes(t,e){return m.forEach(this.un(e),r=>this.getIndexType(t,r).next(i=>{if(i===0||i===1){let s=new yo(r).sn();if(s!=null)return this.addFieldIndex(t,s)}}))}getDocumentsMatchingTarget(t,e){let r=Jn(t),i=!0,s=new Map;return m.forEach(this.un(e),o=>this.cn(t,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=k(),a=[];return m.forEach(s,(u,c)=>{y("IndexedDbIndexManager",`Using index ${function(R){return`id=${R.indexId}|cg=${R.collectionGroup}|f=${R.fields.map(N=>`${N.fieldPath}:${N.kind}`).join(",")}`}(u)} to execute ${Tn(e)}`);let l=function(R,N){let F=Vu(N);if(F===void 0)return null;for(let B of co(R,F.fieldPath))switch(B.op){case"array-contains-any":return B.value.arrayValue.values||[];case"array-contains":return[B.value]}return null}(c,u),h=function(R,N){let F=new Map;for(let B of fn(N))for(let at of co(R,B.fieldPath))switch(at.op){case"==":case"in":F.set(B.fieldPath.canonicalString(),at.value);break;case"not-in":case"!=":return F.set(B.fieldPath.canonicalString(),at.value),Array.from(F.values())}return null}(c,u),d=function(R,N){let F=[],B=!0;for(let at of fn(N)){let Jt=at.kind===0?Gf(R,at.fieldPath,R.startAt):Kf(R,at.fieldPath,R.startAt);F.push(Jt.value),B&&(B=Jt.inclusive)}return new le(F,B)}(c,u),f=function(R,N){let F=[],B=!0;for(let at of fn(N)){let Jt=at.kind===0?Kf(R,at.fieldPath,R.endAt):Gf(R,at.fieldPath,R.endAt);F.push(Jt.value),B&&(B=Jt.inclusive)}return new le(F,B)}(c,u),E=this.ln(u,c,d),v=this.ln(u,c,f),w=this.hn(u,c,h),C=this.Pn(u.indexId,l,E,d.inclusive,v,f.inclusive,w);return m.forEach(C,V=>r.j(V,e.limit).next(R=>{R.forEach(N=>{let F=I.fromSegments(N.documentKey);o.has(F)||(o=o.add(F),a.push(F))})}))}).next(()=>a)}return m.resolve(null)})}un(t){let e=this.an.get(t);return e||(t.filters.length===0?e=[t]:e=ev(K.create(t.filters,"and")).map(r=>Yu(t.path,t.collectionGroup,t.orderBy,r.getFilters(),t.limit,t.startAt,t.endAt)),this.an.set(t,e),e)}Pn(t,e,r,i,s,o,a){let u=(e!=null?e.length:1)*Math.max(r.length,s.length),c=u/(e!=null?e.length:1),l=[];for(let h=0;h<u;++h){let d=e?this.In(e[h/c]):zs,f=this.Tn(t,d,r[h%c],i),E=this.En(t,d,s[h%c],o),v=a.map(w=>this.Tn(t,d,w,!0));l.push(...this.createRange(f,E,v))}return l}Tn(t,e,r,i){let s=new _n(t,I.empty(),e,r);return i?s:s.Ht()}En(t,e,r,i){let s=new _n(t,I.empty(),e,r);return i?s.Ht():s}cn(t,e){let r=new yo(e),i=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment();return this.getFieldIndexes(t,i).next(s=>{let o=null;for(let a of s)r.en(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(t,e){let r=2,i=this.un(e);return m.forEach(i,s=>this.cn(t,s).next(o=>{o?r!==0&&o.fields.length<function(u){let c=new W(st.comparator),l=!1;for(let h of u.filters)for(let d of h.getFlattenedFilters())d.field.isKeyField()||(d.op==="array-contains"||d.op==="array-contains-any"?l=!0:c=c.add(d.field));for(let h of u.orderBy)h.field.isKeyField()||(c=c.add(h.field));return c.size+(l?1:0)}(s)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(e)&&i.length>1&&r===2?1:r)}dn(t,e){let r=new pn;for(let i of fn(t)){let s=e.data.field(i.fieldPath);if(s==null)return null;let o=r.jt(i.kind);_e.St.ht(s,o)}return r.Ut()}In(t){let e=new pn;return _e.St.ht(t,e.jt(0)),e.Ut()}An(t,e){let r=new pn;return _e.St.ht(In(this.databaseId,e),r.jt(function(s){let o=fn(s);return o.length===0?0:o[o.length-1].kind}(t))),r.Ut()}hn(t,e,r){if(r===null)return[];let i=[];i.push(new pn);let s=0;for(let o of fn(t)){let a=r[s++];for(let u of i)if(this.Rn(e,o.fieldPath)&&Si(a))i=this.Vn(i,o,a);else{let c=u.jt(o.kind);_e.St.ht(a,c)}}return this.mn(i)}ln(t,e,r){return this.hn(t,e,r.position)}mn(t){let e=[];for(let r=0;r<t.length;++r)e[r]=t[r].Ut();return e}Vn(t,e,r){let i=[...t],s=[];for(let o of r.arrayValue.values||[])for(let a of i){let u=new pn;u.seed(a.Ut()),_e.St.ht(o,u.jt(e.kind)),s.push(u)}return s}Rn(t,e){return!!t.filters.find(r=>r instanceof O&&r.field.isEqual(e)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(t,e){let r=li(t),i=Zn(t);return(e?r.W("collectionGroupIndex",IDBKeyRange.bound(e,e)):r.W()).next(s=>{let o=[];return m.forEach(s,a=>i.get([a.indexId,this.uid]).next(u=>{o.push(function(l,h){let d=h?new vi(h.sequenceNumber,new zt(Rn(h.readTime),new I(ie(h.documentKey)),h.largestBatchId)):vi.empty(),f=l.fields.map(([E,v])=>new ar(st.fromServerFormat(E),v));return new hr(l.indexId,l.collectionGroup,f,d)}(a,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next(e=>e.length===0?null:(e.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:D(r.collectionGroup,i.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(t,e,r){let i=li(t),s=Zn(t);return this.fn(t).next(o=>i.W("collectionGroupIndex",IDBKeyRange.bound(e,e)).next(a=>m.forEach(a,u=>s.put(sm(u.indexId,this.user,o,r)))))}updateIndexEntries(t,e){let r=new Map;return m.forEach(e,(i,s)=>{let o=r.get(i.collectionGroup);return(o?m.resolve(o):this.getFieldIndexes(t,i.collectionGroup)).next(a=>(r.set(i.collectionGroup,a),m.forEach(a,u=>this.gn(t,i,u).next(c=>{let l=this.pn(s,u);return c.isEqual(l)?m.resolve():this.yn(t,s,u,c,l)}))))})}wn(t,e,r,i){return Jn(t).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.An(r,e.key),documentKey:e.key.path.toArray()})}Sn(t,e,r,i){return Jn(t).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.An(r,e.key),e.key.path.toArray()])}gn(t,e,r){let i=Jn(t),s=new W(Ve);return i.Y({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.An(r,e)])},(o,a)=>{s=s.add(new _n(r.indexId,e,a.arrayValue,a.directionalValue))}).next(()=>s)}pn(t,e){let r=new W(Ve),i=this.dn(e,t);if(i==null)return r;let s=Vu(e);if(s!=null){let o=t.data.field(s.fieldPath);if(Si(o))for(let a of o.arrayValue.values||[])r=r.add(new _n(e.indexId,t.key,this.In(a),i))}else r=r.add(new _n(e.indexId,t.key,zs,i));return r}yn(t,e,r,i,s){y("IndexedDbIndexManager","Updating index entries for document '%s'",e.key);let o=[];return function(u,c,l,h,d){let f=u.getIterator(),E=c.getIterator(),v=Xn(f),w=Xn(E);for(;v||w;){let C=!1,V=!1;if(v&&w){let R=l(v,w);R<0?V=!0:R>0&&(C=!0)}else v!=null?V=!0:C=!0;C?(h(w),w=Xn(E)):V?(d(v),v=Xn(f)):(v=Xn(f),w=Xn(E))}}(i,s,Ve,a=>{o.push(this.wn(t,e,r,a))},a=>{o.push(this.Sn(t,e,r,a))}),m.waitFor(o)}fn(t){let e=1;return Zn(t).Y({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),e=i.sequenceNumber+1}).next(()=>e)}createRange(t,e,r){r=r.sort((o,a)=>Ve(o,a)).filter((o,a,u)=>!a||Ve(o,u[a-1])!==0);let i=[];i.push(t);for(let o of r){let a=Ve(o,t),u=Ve(o,e);if(a===0)i[0]=t.Ht();else if(a>0&&u<0)i.push(o),i.push(o.Ht());else if(u>0)break}i.push(e);let s=[];for(let o=0;o<i.length;o+=2){if(this.bn(i[o],i[o+1]))return[];let a=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,zs,[]],u=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,zs,[]];s.push(IDBKeyRange.bound(a,u))}return s}bn(t,e){return Ve(t,e)>0}getMinOffsetFromCollectionGroup(t,e){return this.getFieldIndexes(t,e).next(dm)}getMinOffset(t,e){return m.mapArray(this.un(e),r=>this.cn(t,r).next(i=>i||S())).next(dm)}};function hm(n){return wt(n,"collectionParents")}function Jn(n){return wt(n,"indexEntries")}function li(n){return wt(n,"indexConfiguration")}function Zn(n){return wt(n,"indexState")}function dm(n){b(n.length!==0);let t=n[0].indexState.offset,e=t.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;Tl(i,t)<0&&(t=i),e<i.largestBatchId&&(e=i.largestBatchId)}return new zt(t.readTime,t.documentKey,e)}var fm={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Ut=class n{constructor(t,e,r){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=r}static withCacheSize(t){return new n(t,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function xg(n,t,e){let r=n.store("mutations"),i=n.store("documentMutations"),s=[],o=IDBKeyRange.only(e.batchId),a=0,u=r.Y({range:o},(l,h,d)=>(a++,d.delete()));s.push(u.next(()=>{b(a===1)}));let c=[];for(let l of e.mutations){let h=Lm(t,l.key.path,e.batchId);s.push(i.delete(h)),c.push(l.key)}return m.waitFor(s).next(()=>c)}function vo(n){if(!n)return 0;let t;if(n.document)t=n.document;else if(n.unknownDocument)t=n.unknownDocument;else{if(!n.noDocument)throw S();t=n.noDocument}return JSON.stringify(t).length}Ut.DEFAULT_COLLECTION_PERCENTILE=10,Ut.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ut.DEFAULT=new Ut(41943040,Ut.DEFAULT_COLLECTION_PERCENTILE,Ut.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ut.DISABLED=new Ut(-1,0,0);var Io=class n{constructor(t,e,r,i){this.userId=t,this.serializer=e,this.indexManager=r,this.referenceDelegate=i,this.Dn={}}static ct(t,e,r,i){b(t.uid!=="");let s=t.isAuthenticated()?t.uid:"";return new n(s,e,r,i)}checkEmpty(t){let e=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ne(t).Y({index:"userMutationsIndex",range:r},(i,s,o)=>{e=!1,o.done()}).next(()=>e)}addMutationBatch(t,e,r,i){let s=sr(t),o=Ne(t);return o.add({}).next(a=>{b(typeof a=="number");let u=new bi(a,e,r,i),c=function(f,E,v){let w=v.baseMutations.map(V=>Vi(f.ut,V)),C=v.mutations.map(V=>Vi(f.ut,V));return{userId:E,batchId:v.batchId,localWriteTimeMs:v.localWriteTime.toMillis(),baseMutations:w,mutations:C}}(this.serializer,this.userId,u),l=[],h=new W((d,f)=>D(d.canonicalString(),f.canonicalString()));for(let d of i){let f=Lm(this.userId,d.key.path,a);h=h.add(d.key.path.popLast()),l.push(o.put(c)),l.push(s.put(f,uw))}return h.forEach(d=>{l.push(this.indexManager.addToCollectionParentIndex(t,d))}),t.addOnCommittedListener(()=>{this.Dn[a]=u.keys()}),m.waitFor(l).next(()=>u)})}lookupMutationBatch(t,e){return Ne(t).get(e).next(r=>r?(b(r.userId===this.userId),gn(this.serializer,r)):null)}Cn(t,e){return this.Dn[e]?m.resolve(this.Dn[e]):this.lookupMutationBatch(t,e).next(r=>{if(r){let i=r.keys();return this.Dn[e]=i,i}return null})}getNextMutationBatchAfterBatchId(t,e){let r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return Ne(t).Y({index:"userMutationsIndex",range:i},(o,a,u)=>{a.userId===this.userId&&(b(a.batchId>=r),s=gn(this.serializer,a)),u.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(t){let e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return Ne(t).Y({index:"userMutationsIndex",range:e,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(t){let e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Ne(t).W("userMutationsIndex",e).next(r=>r.map(i=>gn(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(t,e){let r=Ws(this.userId,e.path),i=IDBKeyRange.lowerBound(r),s=[];return sr(t).Y({range:i},(o,a,u)=>{let[c,l,h]=o,d=ie(l);if(c===this.userId&&e.path.isEqual(d))return Ne(t).get(h).next(f=>{if(!f)throw S();b(f.userId===this.userId),s.push(gn(this.serializer,f))});u.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let r=new W(D),i=[];return e.forEach(s=>{let o=Ws(this.userId,s.path),a=IDBKeyRange.lowerBound(o),u=sr(t).Y({range:a},(c,l,h)=>{let[d,f,E]=c,v=ie(f);d===this.userId&&s.path.isEqual(v)?r=r.add(E):h.done()});i.push(u)}),m.waitFor(i).next(()=>this.vn(t,r))}getAllMutationBatchesAffectingQuery(t,e){let r=e.path,i=r.length+1,s=Ws(this.userId,r),o=IDBKeyRange.lowerBound(s),a=new W(D);return sr(t).Y({range:o},(u,c,l)=>{let[h,d,f]=u,E=ie(d);h===this.userId&&r.isPrefixOf(E)?E.length===i&&(a=a.add(f)):l.done()}).next(()=>this.vn(t,a))}vn(t,e){let r=[],i=[];return e.forEach(s=>{i.push(Ne(t).get(s).next(o=>{if(o===null)throw S();b(o.userId===this.userId),r.push(gn(this.serializer,o))}))}),m.waitFor(i).next(()=>r)}removeMutationBatch(t,e){return xg(t.ae,this.userId,e).next(r=>(t.addOnCommittedListener(()=>{this.Fn(e.batchId)}),m.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(t,i))))}Fn(t){delete this.Dn[t]}performConsistencyCheck(t){return this.checkEmpty(t).next(e=>{if(!e)return m.resolve();let r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),i=[];return sr(t).Y({range:r},(s,o,a)=>{if(s[0]===this.userId){let u=ie(s[1]);i.push(u)}else a.done()}).next(()=>{b(i.length===0)})})}containsKey(t,e){return Dg(t,this.userId,e)}Mn(t){return kg(t).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function Dg(n,t,e){let r=Ws(t,e.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return sr(n).Y({range:s,J:!0},(a,u,c)=>{let[l,h,d]=a;l===t&&h===i&&(o=!0),c.done()}).next(()=>o)}function Ne(n){return wt(n,"mutations")}function sr(n){return wt(n,"documentMutations")}function kg(n){return wt(n,"mutationQueues")}var yr=class n{constructor(t){this.xn=t}next(){return this.xn+=2,this.xn}static On(){return new n(0)}static Nn(){return new n(-1)}};var pc=class{constructor(t,e){this.referenceDelegate=t,this.serializer=e}allocateTargetId(t){return this.Bn(t).next(e=>{let r=new yr(e.highestTargetId);return e.highestTargetId=r.next(),this.Ln(t,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(t){return this.Bn(t).next(e=>P.fromTimestamp(new Z(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(t){return this.Bn(t).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,e,r){return this.Bn(t).next(i=>(i.highestListenSequenceNumber=e,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),this.Ln(t,i)))}addTargetData(t,e){return this.kn(t,e).next(()=>this.Bn(t).next(r=>(r.targetCount+=1,this.qn(e,r),this.Ln(t,r))))}updateTargetData(t,e){return this.kn(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>tr(t).delete(e.targetId)).next(()=>this.Bn(t)).next(r=>(b(r.targetCount>0),r.targetCount-=1,this.Ln(t,r)))}removeTargets(t,e,r){let i=0,s=[];return tr(t).Y((o,a)=>{let u=mi(a);u.sequenceNumber<=e&&r.get(u.targetId)===null&&(i++,s.push(this.removeTargetData(t,u)))}).next(()=>m.waitFor(s)).next(()=>i)}forEachTarget(t,e){return tr(t).Y((r,i)=>{let s=mi(i);e(s)})}Bn(t){return mm(t).get("targetGlobalKey").next(e=>(b(e!==null),e))}Ln(t,e){return mm(t).put("targetGlobalKey",e)}kn(t,e){return tr(t).put(bg(this.serializer,e))}qn(t,e){let r=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,r=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,r=!0),r}getTargetCount(t){return this.Bn(t).next(e=>e.targetCount)}getTargetData(t,e){let r=Tn(e),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return tr(t).Y({range:i,index:"queryTargetsIndex"},(o,a,u)=>{let c=mi(a);Ki(e,c.target)&&(s=c,u.done())}).next(()=>s)}addMatchingKeys(t,e,r){let i=[],s=Fe(t);return e.forEach(o=>{let a=Ct(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(t,r,o))}),m.waitFor(i)}removeMatchingKeys(t,e,r){let i=Fe(t);return m.forEach(e,s=>{let o=Ct(s.path);return m.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(t,r,s)])})}removeMatchingKeysForTargetId(t,e){let r=Fe(t),i=IDBKeyRange.bound([e],[e+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(t,e){let r=IDBKeyRange.bound([e],[e+1],!1,!0),i=Fe(t),s=k();return i.Y({range:r,J:!0},(o,a,u)=>{let c=ie(o[1]),l=new I(c);s=s.add(l)}).next(()=>s)}containsKey(t,e){let r=Ct(e.path),i=IDBKeyRange.bound([r],[Vm(r)],!1,!0),s=0;return Fe(t).Y({index:"documentTargetsIndex",J:!0,range:i},([o,a],u,c)=>{o!==0&&(s++,c.done())}).next(()=>s>0)}_t(t,e){return tr(t).get(e).next(r=>r?mi(r):null)}};function tr(n){return wt(n,"targets")}function mm(n){return wt(n,"targetGlobal")}function Fe(n){return wt(n,"targetDocuments")}function gm([n,t],[e,r]){let i=D(n,e);return i===0?D(t,r):i}var _c=class{constructor(t){this.Qn=t,this.buffer=new W(gm),this.Kn=0}$n(){return++this.Kn}Un(t){let e=[t,this.$n()];if(this.buffer.size<this.Qn)this.buffer=this.buffer.add(e);else{let r=this.buffer.last();gm(e,r)<0&&(this.buffer=this.buffer.delete(r).add(e))}}get maxValue(){return this.buffer.last()[0]}},yc=class{constructor(t,e,r){this.garbageCollector=t,this.asyncQueue=e,this.localStore=r,this.Wn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Gn(6e4)}stop(){this.Wn&&(this.Wn.cancel(),this.Wn=null)}get started(){return this.Wn!==null}Gn(t){y("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.Wn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,()=>p(this,null,function*(){this.Wn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(e){Xe(e)?y("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):yield Ye(e)}yield this.Gn(3e5)}))}},wc=class{constructor(t,e){this.zn=t,this.params=e}calculateTargetCount(t,e){return this.zn.jn(t).next(r=>Math.floor(e/100*r))}nthSequenceNumber(t,e){if(e===0)return m.resolve(Ot._e);let r=new _c(e);return this.zn.forEachTarget(t,i=>r.Un(i.sequenceNumber)).next(()=>this.zn.Hn(t,i=>r.Un(i))).next(()=>r.maxValue)}removeTargets(t,e,r){return this.zn.removeTargets(t,e,r)}removeOrphanedDocuments(t,e){return this.zn.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(y("LruGarbageCollector","Garbage collection skipped; disabled"),m.resolve(fm)):this.getCacheSize(t).next(r=>r<this.params.cacheSizeCollectionThreshold?(y("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),fm):this.Jn(t,e))}getCacheSize(t){return this.zn.getCacheSize(t)}Jn(t,e){let r,i,s,o,a,u,c,l=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(y("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),i=this.params.maximumSequenceNumbersToCollect):i=h,o=Date.now(),this.nthSequenceNumber(t,i))).next(h=>(r=h,a=Date.now(),this.removeTargets(t,r,e))).next(h=>(s=h,u=Date.now(),this.removeOrphanedDocuments(t,r))).next(h=>(c=Date.now(),er()<=te.DEBUG&&y("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-l}ms
	Determined least recently used ${i} in `+(a-o)+`ms
	Removed ${s} targets in `+(u-a)+`ms
	Removed ${h} documents in `+(c-u)+`ms
Total Duration: ${c-l}ms`),m.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:h})))}};function nv(n,t){return new wc(n,t)}var vc=class{constructor(t,e){this.db=t,this.garbageCollector=nv(this,e)}jn(t){let e=this.Yn(t);return this.db.getTargetCache().getTargetCount(t).next(r=>e.next(i=>r+i))}Yn(t){let e=0;return this.Hn(t,r=>{e++}).next(()=>e)}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}Hn(t,e){return this.Zn(t,(r,i)=>e(i))}addReference(t,e,r){return Gs(t,r)}removeReference(t,e,r){return Gs(t,r)}removeTargets(t,e,r){return this.db.getTargetCache().removeTargets(t,e,r)}markPotentiallyOrphaned(t,e){return Gs(t,e)}Xn(t,e){return function(i,s){let o=!1;return kg(i).Z(a=>Dg(i,a,s).next(u=>(u&&(o=!0),m.resolve(!u)))).next(()=>o)}(t,e)}removeOrphanedDocuments(t,e){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.Zn(t,(o,a)=>{if(a<=e){let u=this.Xn(t,o).next(c=>{if(!c)return s++,r.getEntry(t,o).next(()=>(r.removeEntry(o,P.min()),Fe(t).delete(function(h){return[0,Ct(h.path)]}(o))))});i.push(u)}}).next(()=>m.waitFor(i)).next(()=>r.apply(t)).next(()=>s)}removeTarget(t,e){let r=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,r)}updateLimboDocument(t,e){return Gs(t,e)}Zn(t,e){let r=Fe(t),i,s=Ot._e;return r.Y({index:"documentTargetsIndex"},([o,a],{path:u,sequenceNumber:c})=>{o===0?(s!==Ot._e&&e(new I(ie(i)),s),s=c,i=u):s=Ot._e}).next(()=>{s!==Ot._e&&e(new I(ie(i)),s)})}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}};function Gs(n,t){return Fe(n).put(function(r,i){return{targetId:0,path:Ct(r.path),sequenceNumber:i}}(t,n.currentSequenceNumber))}var Eo=class{constructor(){this.changes=new he(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,ft.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();let r=this.changes.get(e);return r!==void 0?m.resolve(r):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}};var Ic=class{constructor(t){this.serializer=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,r){return dn(t).put(r)}removeEntry(t,e,r){return dn(t).delete(function(s,o){let a=s.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],po(o),a[a.length-1]]}(e,r))}updateMetadata(t,e){return this.getMetadata(t).next(r=>(r.byteSize+=e,this.er(t,r)))}getEntry(t,e){let r=ft.newInvalidDocument(e);return dn(t).Y({index:"documentKeyIndex",range:IDBKeyRange.only(hi(e))},(i,s)=>{r=this.tr(e,s)}).next(()=>r)}nr(t,e){let r={size:0,document:ft.newInvalidDocument(e)};return dn(t).Y({index:"documentKeyIndex",range:IDBKeyRange.only(hi(e))},(i,s)=>{r={document:this.tr(e,s),size:vo(s)}}).next(()=>r)}getEntries(t,e){let r=Nt();return this.rr(t,e,(i,s)=>{let o=this.tr(i,s);r=r.insert(i,o)}).next(()=>r)}ir(t,e){let r=Nt(),i=new Y(I.comparator);return this.rr(t,e,(s,o)=>{let a=this.tr(s,o);r=r.insert(s,a),i=i.insert(s,vo(o))}).next(()=>({documents:r,sr:i}))}rr(t,e,r){if(e.isEmpty())return m.resolve();let i=new W(ym);e.forEach(u=>i=i.add(u));let s=IDBKeyRange.bound(hi(i.first()),hi(i.last())),o=i.getIterator(),a=o.getNext();return dn(t).Y({index:"documentKeyIndex",range:s},(u,c,l)=>{let h=I.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&ym(a,h)<0;)r(a,null),a=o.getNext();a&&a.isEqual(h)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?l.U(hi(a)):l.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(t,e,r,i,s){let o=e.path,a=[o.popLast().toArray(),o.lastSegment(),po(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return dn(t).W(IDBKeyRange.bound(a,u,!0)).next(c=>{s?.incrementDocumentReadCount(c.length);let l=Nt();for(let h of c){let d=this.tr(I.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);d.isFoundDocument()&&(Wi(e,d)||i.has(d.key))&&(l=l.insert(d.key,d))}return l})}getAllFromCollectionGroup(t,e,r,i){let s=Nt(),o=_m(e,r),a=_m(e,zt.max());return dn(t).Y({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(u,c,l)=>{let h=this.tr(I.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(h.key,h),s.size===i&&l.done()}).next(()=>s)}newChangeBuffer(t){return new Ec(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next(e=>e.byteSize)}getMetadata(t){return pm(t).get("remoteDocumentGlobalKey").next(e=>(b(!!e),e))}er(t,e){return pm(t).put("remoteDocumentGlobalKey",e)}tr(t,e){if(e){let r=Zw(this.serializer,e);if(!(r.isNoDocument()&&r.version.isEqual(P.min())))return r}return ft.newInvalidDocument(t)}};function Vg(n){return new Ic(n)}var Ec=class extends Eo{constructor(t,e){super(),this._r=t,this.trackRemovals=e,this.ar=new he(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(t){let e=[],r=0,i=new W((s,o)=>D(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.ar.get(s);if(e.push(this._r.removeEntry(t,s,a.readTime)),o.isValidDocument()){let u=rm(this._r.serializer,o);i=i.add(s.path.popLast());let c=vo(u);r+=c-a.size,e.push(this._r.addEntry(t,s,u))}else if(r-=a.size,this.trackRemovals){let u=rm(this._r.serializer,o.convertToNoDocument(P.min()));e.push(this._r.addEntry(t,s,u))}}),i.forEach(s=>{e.push(this._r.indexManager.addToCollectionParentIndex(t,s))}),e.push(this._r.updateMetadata(t,r)),m.waitFor(e)}getFromCache(t,e){return this._r.nr(t,e).next(r=>(this.ar.set(e,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(t,e){return this._r.ir(t,e).next(({documents:r,sr:i})=>(i.forEach((s,o)=>{this.ar.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function pm(n){return wt(n,"remoteDocumentGlobal")}function dn(n){return wt(n,"remoteDocumentsV14")}function hi(n){let t=n.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function _m(n,t){let e=t.documentKey.path.toArray();return[n,po(t.readTime),e.slice(0,e.length-2),e.length>0?e[e.length-1]:""]}function ym(n,t){let e=n.path.toArray(),r=t.path.toArray(),i=0;for(let s=0;s<e.length-2&&s<r.length-2;++s)if(i=D(e[s],r[s]),i)return i;return i=D(e.length,r.length),i||(i=D(e[e.length-2],r[r.length-2]),i||D(e[e.length-1],r[r.length-1]))}var Tc=class{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}};var To=class{constructor(t,e,r,i){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=r,this.indexManager=i}getDocument(t,e){let r=null;return this.documentOverlayCache.getOverlay(t,e).next(i=>(r=i,this.remoteDocumentCache.getEntry(t,e))).next(i=>(r!==null&&_i(r.mutation,i,Lt.empty(),Z.now()),i))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(r=>this.getLocalViewOfDocuments(t,r,k()).next(()=>r))}getLocalViewOfDocuments(t,e,r=k()){let i=se();return this.populateOverlays(t,i,e).next(()=>this.computeViews(t,e,i,r).next(s=>{let o=fi();return s.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(t,e){let r=se();return this.populateOverlays(t,r,e).next(()=>this.computeViews(t,e,r,k()))}populateOverlays(t,e,r){let i=[];return r.forEach(s=>{e.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(t,i).next(s=>{s.forEach((o,a)=>{e.set(o,a)})})}computeViews(t,e,r,i){let s=Nt(),o=pi(),a=function(){return pi()}();return e.forEach((u,c)=>{let l=r.get(c.key);i.has(c.key)&&(l===void 0||l.mutation instanceof Ht)?s=s.insert(c.key,c):l!==void 0?(o.set(c.key,l.mutation.getFieldMask()),_i(l.mutation,c,l.mutation.getFieldMask(),Z.now())):o.set(c.key,Lt.empty())}),this.recalculateAndSaveOverlays(t,s).next(u=>(u.forEach((c,l)=>o.set(c,l)),e.forEach((c,l)=>{var h;return a.set(c,new Tc(l,(h=o.get(c))!==null&&h!==void 0?h:null))}),a))}recalculateAndSaveOverlays(t,e){let r=pi(),i=new Y((o,a)=>o-a),s=k();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(o=>{for(let a of o)a.keys().forEach(u=>{let c=e.get(u);if(c===null)return;let l=r.get(u)||Lt.empty();l=a.applyToLocalView(c,l),r.set(u,l);let h=(i.get(a.batchId)||k()).add(u);i=i.insert(a.batchId,h)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let u=a.getNext(),c=u.key,l=u.value,h=rg();l.forEach(d=>{if(!s.has(d)){let f=hg(e.get(d),r.get(d));f!==null&&h.set(d,f),s=s.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(t,c,h))}return m.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(r=>this.recalculateAndSaveOverlays(t,r))}getDocumentsMatchingQuery(t,e,r,i){return function(o){return I.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):bl(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,r,i):this.getDocumentsMatchingCollectionQuery(t,e,r,i)}getNextDocuments(t,e,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,r.largestBatchId,i-s.size):m.resolve(se()),a=-1,u=s;return o.next(c=>m.forEach(c,(l,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),s.get(l)?m.resolve():this.remoteDocumentCache.getEntry(t,l).next(d=>{u=u.insert(l,d)}))).next(()=>this.populateOverlays(t,c,s)).next(()=>this.computeViews(t,u,c,k())).next(l=>({batchId:a,changes:ng(l)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new I(e)).next(r=>{let i=fi();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(t,e,r,i){let s=e.collectionGroup,o=fi();return this.indexManager.getCollectionParents(t,s).next(a=>m.forEach(a,u=>{let c=function(h,d){return new Qt(d,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(e,u.child(s));return this.getDocumentsMatchingCollectionQuery(t,c,r,i).next(l=>{l.forEach((h,d)=>{o=o.insert(h,d)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(t,e,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,r,s,i))).next(o=>{s.forEach((u,c)=>{let l=c.getKey();o.get(l)===null&&(o=o.insert(l,ft.newInvalidDocument(l)))});let a=fi();return o.forEach((u,c)=>{let l=s.get(u);l!==void 0&&_i(l.mutation,c,Lt.empty(),Z.now()),Wi(e,c)&&(a=a.insert(u,c))}),a})}};var Ac=class{constructor(t){this.serializer=t,this.ur=new Map,this.cr=new Map}getBundleMetadata(t,e){return m.resolve(this.ur.get(e))}saveBundleMetadata(t,e){return this.ur.set(e.id,function(i){return{id:i.id,version:i.version,createTime:ot(i.createTime)}}(e)),m.resolve()}getNamedQuery(t,e){return m.resolve(this.cr.get(e))}saveNamedQuery(t,e){return this.cr.set(e.name,function(i){return{name:i.name,query:xl(i.bundledQuery),readTime:ot(i.readTime)}}(e)),m.resolve()}};var Sc=class{constructor(){this.overlays=new Y(I.comparator),this.lr=new Map}getOverlay(t,e){return m.resolve(this.overlays.get(e))}getOverlays(t,e){let r=se();return m.forEach(e,i=>this.getOverlay(t,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(t,e,r){return r.forEach((i,s)=>{this.lt(t,e,s)}),m.resolve()}removeOverlaysForBatchId(t,e,r){let i=this.lr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.lr.delete(r)),m.resolve()}getOverlaysForCollection(t,e,r){let i=se(),s=e.length+1,o=new I(e.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let u=a.getNext().value,c=u.getKey();if(!e.isPrefixOf(c.path))break;c.path.length===s&&u.largestBatchId>r&&i.set(u.getKey(),u)}return m.resolve(i)}getOverlaysForCollectionGroup(t,e,r,i){let s=new Y((c,l)=>c-l),o=this.overlays.getIterator();for(;o.hasNext();){let c=o.getNext().value;if(c.getKey().getCollectionGroup()===e&&c.largestBatchId>r){let l=s.get(c.largestBatchId);l===null&&(l=se(),s=s.insert(c.largestBatchId,l)),l.set(c.getKey(),c)}}let a=se(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((c,l)=>a.set(c,l)),!(a.size()>=i)););return m.resolve(a)}lt(t,e,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.lr.get(i.largestBatchId).delete(r.key);this.lr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Pi(e,r));let s=this.lr.get(e);s===void 0&&(s=k(),this.lr.set(e,s)),this.lr.set(e,s.add(r.key))}};var Fi=class{constructor(){this.hr=new W(lt.Pr),this.Ir=new W(lt.Tr)}isEmpty(){return this.hr.isEmpty()}addReference(t,e){let r=new lt(t,e);this.hr=this.hr.add(r),this.Ir=this.Ir.add(r)}Er(t,e){t.forEach(r=>this.addReference(r,e))}removeReference(t,e){this.dr(new lt(t,e))}Ar(t,e){t.forEach(r=>this.removeReference(r,e))}Rr(t){let e=new I(new U([])),r=new lt(e,t),i=new lt(e,t+1),s=[];return this.Ir.forEachInRange([r,i],o=>{this.dr(o),s.push(o.key)}),s}Vr(){this.hr.forEach(t=>this.dr(t))}dr(t){this.hr=this.hr.delete(t),this.Ir=this.Ir.delete(t)}mr(t){let e=new I(new U([])),r=new lt(e,t),i=new lt(e,t+1),s=k();return this.Ir.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(t){let e=new lt(t,0),r=this.hr.firstAfterOrEqual(e);return r!==null&&t.isEqual(r.key)}},lt=class{constructor(t,e){this.key=t,this.gr=e}static Pr(t,e){return I.comparator(t.key,e.key)||D(t.gr,e.gr)}static Tr(t,e){return D(t.gr,e.gr)||I.comparator(t.key,e.key)}};var Rc=class{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.pr=1,this.yr=new W(lt.Pr)}checkEmpty(t){return m.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,r,i){let s=this.pr;this.pr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new bi(s,e,r,i);this.mutationQueue.push(o);for(let a of i)this.yr=this.yr.add(new lt(a.key,s)),this.indexManager.addToCollectionParentIndex(t,a.key.path.popLast());return m.resolve(o)}lookupMutationBatch(t,e){return m.resolve(this.wr(e))}getNextMutationBatchAfterBatchId(t,e){let r=e+1,i=this.Sr(r),s=i<0?0:i;return m.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return m.resolve(this.mutationQueue.length===0?-1:this.pr-1)}getAllMutationBatches(t){return m.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){let r=new lt(e,0),i=new lt(e,Number.POSITIVE_INFINITY),s=[];return this.yr.forEachInRange([r,i],o=>{let a=this.wr(o.gr);s.push(a)}),m.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let r=new W(D);return e.forEach(i=>{let s=new lt(i,0),o=new lt(i,Number.POSITIVE_INFINITY);this.yr.forEachInRange([s,o],a=>{r=r.add(a.gr)})}),m.resolve(this.br(r))}getAllMutationBatchesAffectingQuery(t,e){let r=e.path,i=r.length+1,s=r;I.isDocumentKey(s)||(s=s.child(""));let o=new lt(new I(s),0),a=new W(D);return this.yr.forEachWhile(u=>{let c=u.key.path;return!!r.isPrefixOf(c)&&(c.length===i&&(a=a.add(u.gr)),!0)},o),m.resolve(this.br(a))}br(t){let e=[];return t.forEach(r=>{let i=this.wr(r);i!==null&&e.push(i)}),e}removeMutationBatch(t,e){b(this.Dr(e.batchId,"removed")===0),this.mutationQueue.shift();let r=this.yr;return m.forEach(e.mutations,i=>{let s=new lt(i.key,e.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(()=>{this.yr=r})}Fn(t){}containsKey(t,e){let r=new lt(e,0),i=this.yr.firstAfterOrEqual(r);return m.resolve(e.isEqual(i&&i.key))}performConsistencyCheck(t){return this.mutationQueue.length,m.resolve()}Dr(t,e){return this.Sr(t)}Sr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}wr(t){let e=this.Sr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}};var bc=class{constructor(t){this.Cr=t,this.docs=function(){return new Y(I.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){let r=e.key,i=this.docs.get(r),s=i?i.size:0,o=this.Cr(e);return this.docs=this.docs.insert(r,{document:e.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())}removeEntry(t){let e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){let r=this.docs.get(e);return m.resolve(r?r.document.mutableCopy():ft.newInvalidDocument(e))}getEntries(t,e){let r=Nt();return e.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():ft.newInvalidDocument(i))}),m.resolve(r)}getDocumentsMatchingQuery(t,e,r,i){let s=Nt(),o=e.path,a=new I(o.child("")),u=this.docs.getIteratorFrom(a);for(;u.hasNext();){let{key:c,value:{document:l}}=u.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||Tl(Fm(l),r)<=0||(i.has(l.key)||Wi(e,l))&&(s=s.insert(l.key,l.mutableCopy()))}return m.resolve(s)}getAllFromCollectionGroup(t,e,r,i){S()}vr(t,e){return m.forEach(this.docs,r=>e(r))}newChangeBuffer(t){return new Pc(this)}getSize(t){return m.resolve(this.size)}},Pc=class extends Eo{constructor(t){super(),this._r=t}applyChanges(t){let e=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?e.push(this._r.addEntry(t,i)):this._r.removeEntry(r)}),m.waitFor(e)}getFromCache(t,e){return this._r.getEntry(t,e)}getAllFromCache(t,e){return this._r.getEntries(t,e)}};var Cc=class{constructor(t){this.persistence=t,this.Fr=new he(e=>Tn(e),Ki),this.lastRemoteSnapshotVersion=P.min(),this.highestTargetId=0,this.Mr=0,this.Or=new Fi,this.targetCount=0,this.Nr=yr.On()}forEachTarget(t,e){return this.Fr.forEach((r,i)=>e(i)),m.resolve()}getLastRemoteSnapshotVersion(t){return m.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return m.resolve(this.Mr)}allocateTargetId(t){return this.highestTargetId=this.Nr.next(),m.resolve(this.highestTargetId)}setTargetsMetadata(t,e,r){return r&&(this.lastRemoteSnapshotVersion=r),e>this.Mr&&(this.Mr=e),m.resolve()}kn(t){this.Fr.set(t.target,t);let e=t.targetId;e>this.highestTargetId&&(this.Nr=new yr(e),this.highestTargetId=e),t.sequenceNumber>this.Mr&&(this.Mr=t.sequenceNumber)}addTargetData(t,e){return this.kn(e),this.targetCount+=1,m.resolve()}updateTargetData(t,e){return this.kn(e),m.resolve()}removeTargetData(t,e){return this.Fr.delete(e.target),this.Or.Rr(e.targetId),this.targetCount-=1,m.resolve()}removeTargets(t,e,r){let i=0,s=[];return this.Fr.forEach((o,a)=>{a.sequenceNumber<=e&&r.get(a.targetId)===null&&(this.Fr.delete(o),s.push(this.removeMatchingKeysForTargetId(t,a.targetId)),i++)}),m.waitFor(s).next(()=>i)}getTargetCount(t){return m.resolve(this.targetCount)}getTargetData(t,e){let r=this.Fr.get(e)||null;return m.resolve(r)}addMatchingKeys(t,e,r){return this.Or.Er(e,r),m.resolve()}removeMatchingKeys(t,e,r){this.Or.Ar(e,r);let i=this.persistence.referenceDelegate,s=[];return i&&e.forEach(o=>{s.push(i.markPotentiallyOrphaned(t,o))}),m.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.Or.Rr(e),m.resolve()}getMatchingKeysForTargetId(t,e){let r=this.Or.mr(e);return m.resolve(r)}containsKey(t,e){return m.resolve(this.Or.containsKey(e))}};var Ao=class{constructor(t,e){this.Br={},this.overlays={},this.Lr=new Ot(0),this.kr=!1,this.kr=!0,this.referenceDelegate=t(this),this.qr=new Cc(this),this.indexManager=new mc,this.remoteDocumentCache=function(i){return new bc(i)}(r=>this.referenceDelegate.Qr(r)),this.serializer=new go(e),this.Kr=new Ac(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.kr=!1,Promise.resolve()}get started(){return this.kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Sc,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let r=this.Br[t.toKey()];return r||(r=new Rc(e,this.referenceDelegate),this.Br[t.toKey()]=r),r}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Kr}runTransaction(t,e,r){y("MemoryPersistence","Starting transaction:",t);let i=new xc(this.Lr.next());return this.referenceDelegate.$r(),r(i).next(s=>this.referenceDelegate.Ur(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Wr(t,e){return m.or(Object.values(this.Br).map(r=>()=>r.containsKey(t,e)))}},xc=class extends no{constructor(t){super(),this.currentSequenceNumber=t}},So=class n{constructor(t){this.persistence=t,this.Gr=new Fi,this.zr=null}static jr(t){return new n(t)}get Hr(){if(this.zr)return this.zr;throw S()}addReference(t,e,r){return this.Gr.addReference(r,e),this.Hr.delete(r.toString()),m.resolve()}removeReference(t,e,r){return this.Gr.removeReference(r,e),this.Hr.add(r.toString()),m.resolve()}markPotentiallyOrphaned(t,e){return this.Hr.add(e.toString()),m.resolve()}removeTarget(t,e){this.Gr.Rr(e.targetId).forEach(i=>this.Hr.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(i=>{i.forEach(s=>this.Hr.add(s.toString()))}).next(()=>r.removeTargetData(t,e))}$r(){this.zr=new Set}Ur(t){let e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return m.forEach(this.Hr,r=>{let i=I.fromPath(r);return this.Jr(t,i).next(s=>{s||e.removeEntry(i,P.min())})}).next(()=>(this.zr=null,e.apply(t)))}updateLimboDocument(t,e){return this.Jr(t,e).next(r=>{r?this.Hr.delete(e.toString()):this.Hr.add(e.toString())})}Qr(t){return 0}Jr(t,e){return m.or([()=>m.resolve(this.Gr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Wr(t,e)])}};var Dc=class{constructor(t){this.serializer=t}N(t,e,r,i){let s=new ro("createOrUpgrade",e);r<1&&i>=1&&(function(u){u.createObjectStore("owner")}(t),function(u){u.createObjectStore("mutationQueues",{keyPath:"userId"}),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Ff,{unique:!0}),u.createObjectStore("documentMutations")}(t),wm(t),function(u){u.createObjectStore("remoteDocuments")}(t));let o=m.resolve();return r<3&&i>=3&&(r!==0&&(function(u){u.deleteObjectStore("targetDocuments"),u.deleteObjectStore("targets"),u.deleteObjectStore("targetGlobal")}(t),wm(t)),o=o.next(()=>function(u){let c=u.store("targetGlobal"),l={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:P.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",l)}(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>function(u,c){return c.store("mutations").W().next(l=>{u.deleteObjectStore("mutations"),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Ff,{unique:!0});let h=c.store("mutations"),d=l.map(f=>h.put(f));return m.waitFor(d)})}(t,s))),o=o.next(()=>{(function(u){u.createObjectStore("clientMetadata",{keyPath:"clientId"})})(t)})),r<5&&i>=5&&(o=o.next(()=>this.Zr(s))),r<6&&i>=6&&(o=o.next(()=>(function(u){u.createObjectStore("remoteDocumentGlobal")}(t),this.Xr(s)))),r<7&&i>=7&&(o=o.next(()=>this.ei(s))),r<8&&i>=8&&(o=o.next(()=>this.ti(t,s))),r<9&&i>=9&&(o=o.next(()=>{(function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")})(t)})),r<10&&i>=10&&(o=o.next(()=>this.ni(s))),r<11&&i>=11&&(o=o.next(()=>{(function(u){u.createObjectStore("bundles",{keyPath:"bundleId"})})(t),function(u){u.createObjectStore("namedQueries",{keyPath:"name"})}(t)})),r<12&&i>=12&&(o=o.next(()=>{(function(u){let c=u.createObjectStore("documentOverlays",{keyPath:vw});c.createIndex("collectionPathOverlayIndex",Iw,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",Ew,{unique:!1})})(t)})),r<13&&i>=13&&(o=o.next(()=>function(u){let c=u.createObjectStore("remoteDocumentsV14",{keyPath:cw});c.createIndex("documentKeyIndex",lw),c.createIndex("collectionGroupIndex",hw)}(t)).next(()=>this.ri(t,s)).next(()=>t.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(o=o.next(()=>this.ii(t,s))),r<15&&i>=15&&(o=o.next(()=>function(u){u.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),u.createObjectStore("indexState",{keyPath:pw}).createIndex("sequenceNumberIndex",_w,{unique:!1}),u.createObjectStore("indexEntries",{keyPath:yw}).createIndex("documentKeyIndex",ww,{unique:!1})}(t))),o}Xr(t){let e=0;return t.store("remoteDocuments").Y((r,i)=>{e+=vo(i)}).next(()=>{let r={byteSize:e};return t.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Zr(t){let e=t.store("mutationQueues"),r=t.store("mutations");return e.W().next(i=>m.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.W("userMutationsIndex",o).next(a=>m.forEach(a,u=>{b(u.userId===s.userId);let c=gn(this.serializer,u);return xg(t,s.userId,c).next(()=>{})}))}))}ei(t){let e=t.store("targetDocuments"),r=t.store("remoteDocuments");return t.store("targetGlobal").get("targetGlobalKey").next(i=>{let s=[];return r.Y((o,a)=>{let u=new U(o),c=function(h){return[0,Ct(h)]}(u);s.push(e.get(c).next(l=>l?m.resolve():(h=>e.put({targetId:0,path:Ct(h),sequenceNumber:i.highestListenSequenceNumber}))(u)))}).next(()=>m.waitFor(s))})}ti(t,e){t.createObjectStore("collectionParents",{keyPath:gw});let r=e.store("collectionParents"),i=new Ni,s=o=>{if(i.add(o)){let a=o.lastSegment(),u=o.popLast();return r.put({collectionId:a,parent:Ct(u)})}};return e.store("remoteDocuments").Y({J:!0},(o,a)=>{let u=new U(o);return s(u.popLast())}).next(()=>e.store("documentMutations").Y({J:!0},([o,a,u],c)=>{let l=ie(a);return s(l.popLast())}))}ni(t){let e=t.store("targets");return e.Y((r,i)=>{let s=mi(i),o=bg(this.serializer,s);return e.put(o)})}ri(t,e){let r=e.store("remoteDocuments"),i=[];return r.Y((s,o)=>{let a=e.store("remoteDocumentsV14"),u=function(h){return h.document?new I(U.fromString(h.document.name).popFirst(5)):h.noDocument?I.fromSegments(h.noDocument.path):h.unknownDocument?I.fromSegments(h.unknownDocument.path):S()}(o).path.toArray(),c={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(c))}).next(()=>m.waitFor(i))}ii(t,e){let r=e.store("mutations"),i=Vg(this.serializer),s=new Ao(So.jr,this.serializer.ut);return r.W().next(o=>{let a=new Map;return o.forEach(u=>{var c;let l=(c=a.get(u.userId))!==null&&c!==void 0?c:k();gn(this.serializer,u).keys().forEach(h=>l=l.add(h)),a.set(u.userId,l)}),m.forEach(a,(u,c)=>{let l=new ht(c),h=_o.ct(this.serializer,l),d=s.getIndexManager(l),f=Io.ct(l,this.serializer,d,s.referenceDelegate);return new To(i,f,h,d).recalculateAndSaveOverlaysForDocumentKeys(new Ei(e,Ot._e),u).next()})})}};function wm(n){n.createObjectStore("targetDocuments",{keyPath:fw}).createIndex("documentTargetsIndex",mw,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",dw,{unique:!0}),n.createObjectStore("targetGlobal")}var Tu="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",kc=class n{constructor(t,e,r,i,s,o,a,u,c,l,h=15){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=r,this.si=s,this.window=o,this.document=a,this.oi=c,this._i=l,this.ai=h,this.Lr=null,this.kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ui=null,this.inForeground=!1,this.ci=null,this.li=null,this.hi=Number.NEGATIVE_INFINITY,this.Pi=d=>Promise.resolve(),!n.D())throw new _(g.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new vc(this,i),this.Ii=e+"main",this.serializer=new go(u),this.Ti=new Be(this.Ii,this.ai,new Dc(this.serializer)),this.qr=new pc(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Vg(this.serializer),this.Kr=new ac,this.window&&this.window.localStorage?this.Ei=this.window.localStorage:(this.Ei=null,l===!1&&it("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.di().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new _(g.FAILED_PRECONDITION,Tu);return this.Ai(),this.Ri(),this.Vi(),this.runTransaction("getHighestListenSequenceNumber","readonly",t=>this.qr.getHighestSequenceNumber(t))}).then(t=>{this.Lr=new Ot(t,this.oi)}).then(()=>{this.kr=!0}).catch(t=>(this.Ti&&this.Ti.close(),Promise.reject(t)))}mi(t){return this.Pi=e=>p(this,null,function*(){if(this.started)return t(e)}),t(this.isPrimary)}setDatabaseDeletedListener(t){this.Ti.L(e=>p(this,null,function*(){e.newVersion===null&&(yield t())}))}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.si.enqueueAndForget(()=>p(this,null,function*(){this.started&&(yield this.di())})))}di(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>Ks(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(t).next(e=>{e||(this.isPrimary=!1,this.si.enqueueRetryable(()=>this.Pi(!1)))})}).next(()=>this.gi(t)).next(e=>this.isPrimary&&!e?this.pi(t).next(()=>!1):!!e&&this.yi(t).next(()=>!0))).catch(t=>{if(Xe(t))return y("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return y("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(t=>{this.isPrimary!==t&&this.si.enqueueRetryable(()=>this.Pi(t)),this.isPrimary=t})}fi(t){return di(t).get("owner").next(e=>m.resolve(this.wi(e)))}Si(t){return Ks(t).delete(this.clientId)}bi(){return p(this,null,function*(){if(this.isPrimary&&!this.Di(this.hi,18e5)){this.hi=Date.now();let t=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let r=wt(e,"clientMetadata");return r.W().next(i=>{let s=this.Ci(i,18e5),o=i.filter(a=>s.indexOf(a)===-1);return m.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Ei)for(let e of t)this.Ei.removeItem(this.vi(e.clientId))}})}Vi(){this.li=this.si.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.di().then(()=>this.bi()).then(()=>this.Vi()))}wi(t){return!!t&&t.ownerId===this.clientId}gi(t){return this._i?m.resolve(!0):di(t).get("owner").next(e=>{if(e!==null&&this.Di(e.leaseTimestampMs,5e3)&&!this.Fi(e.ownerId)){if(this.wi(e)&&this.networkEnabled)return!0;if(!this.wi(e)){if(!e.allowTabSynchronization)throw new _(g.FAILED_PRECONDITION,Tu);return!1}}return!(!this.networkEnabled||!this.inForeground)||Ks(t).W().next(r=>this.Ci(r,5e3).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,a=this.networkEnabled===i.networkEnabled;if(s||o&&a)return!0}return!1})===void 0)}).next(e=>(this.isPrimary!==e&&y("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}shutdown(){return p(this,null,function*(){this.kr=!1,this.Mi(),this.li&&(this.li.cancel(),this.li=null),this.xi(),this.Oi(),yield this.Ti.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{let e=new Ei(t,Ot._e);return this.pi(e).next(()=>this.Si(e))}),this.Ti.close(),this.Ni()})}Ci(t,e){return t.filter(r=>this.Di(r.updateTimeMs,e)&&!this.Fi(r.clientId))}Bi(){return this.runTransaction("getActiveClients","readonly",t=>Ks(t).W().next(e=>this.Ci(e,18e5).map(r=>r.clientId)))}get started(){return this.kr}getMutationQueue(t,e){return Io.ct(t,this.serializer,e,this.referenceDelegate)}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(t){return new gc(t,this.serializer.ut.databaseId)}getDocumentOverlayCache(t){return _o.ct(this.serializer,t)}getBundleCache(){return this.Kr}runTransaction(t,e,r){y("IndexedDbPersistence","Starting transaction:",t);let i=e==="readonly"?"readonly":"readwrite",s=function(u){return u===15?Aw:u===14?Um:u===13?Bm:u===12?Tw:u===11?qm:void S()}(this.ai),o;return this.Ti.runTransaction(t,i,s,a=>(o=new Ei(a,this.Lr?this.Lr.next():Ot._e),e==="readwrite-primary"?this.fi(o).next(u=>!!u||this.gi(o)).next(u=>{if(!u)throw it(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.si.enqueueRetryable(()=>this.Pi(!1)),new _(g.FAILED_PRECONDITION,Mm);return r(o)}).next(u=>this.yi(o).next(()=>u)):this.Li(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Li(t){return di(t).get("owner").next(e=>{if(e!==null&&this.Di(e.leaseTimestampMs,5e3)&&!this.Fi(e.ownerId)&&!this.wi(e)&&!(this._i||this.allowTabSynchronization&&e.allowTabSynchronization))throw new _(g.FAILED_PRECONDITION,Tu)})}yi(t){let e={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return di(t).put("owner",e)}static D(){return Be.D()}pi(t){let e=di(t);return e.get("owner").next(r=>this.wi(r)?(y("IndexedDbPersistence","Releasing primary lease."),e.delete("owner")):m.resolve())}Di(t,e){let r=Date.now();return!(t<r-e)&&(!(t>r)||(it(`Detected an update time that is in the future: ${t} > ${r}`),!1))}Ai(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.ci=()=>{this.si.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.di()))},this.document.addEventListener("visibilitychange",this.ci),this.inForeground=this.document.visibilityState==="visible")}xi(){this.ci&&(this.document.removeEventListener("visibilitychange",this.ci),this.ci=null)}Ri(){var t;typeof((t=this.window)===null||t===void 0?void 0:t.addEventListener)=="function"&&(this.ui=()=>{this.Mi();let e=/(?:Version|Mobile)\/1[456]/;zh()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.si.enterRestrictedMode(!0),this.si.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ui))}Oi(){this.ui&&(this.window.removeEventListener("pagehide",this.ui),this.ui=null)}Fi(t){var e;try{let r=((e=this.Ei)===null||e===void 0?void 0:e.getItem(this.vi(t)))!==null;return y("IndexedDbPersistence",`Client '${t}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return it("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Mi(){if(this.Ei)try{this.Ei.setItem(this.vi(this.clientId),String(Date.now()))}catch(t){it("Failed to set zombie client id.",t)}}Ni(){if(this.Ei)try{this.Ei.removeItem(this.vi(this.clientId))}catch{}}vi(t){return`firestore_zombie_${this.persistenceKey}_${t}`}};function di(n){return wt(n,"owner")}function Ks(n){return wt(n,"clientMetadata")}function kl(n,t){let e=n.projectId;return n.isDefaultDatabase||(e+="."+n.database),"firestore/"+t+"/"+e+"/"}var Vc=class n{constructor(t,e,r,i){this.targetId=t,this.fromCache=e,this.ki=r,this.qi=i}static Qi(t,e){let r=k(),i=k();for(let s of e.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(t,e.fromCache,r,i)}};var Nc=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}};var Ro=class{constructor(){this.Ki=!1,this.$i=!1,this.Ui=100,this.Wi=8}initialize(t,e){this.Gi=t,this.indexManager=e,this.Ki=!0}getDocumentsMatchingQuery(t,e,r,i){let s={result:null};return this.zi(t,e).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.ji(t,e,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new Nc;return this.Hi(t,e,o).next(a=>{if(s.result=a,this.$i)return this.Ji(t,e,o,a.size)})}).next(()=>s.result)}Ji(t,e,r,i){return r.documentReadCount<this.Ui?(er()<=te.DEBUG&&y("QueryEngine","SDK will not create cache indexes for query:",nr(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Ui,"documents"),m.resolve()):(er()<=te.DEBUG&&y("QueryEngine","Query:",nr(e),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Wi*i?(er()<=te.DEBUG&&y("QueryEngine","The SDK decides to create cache indexes for query:",nr(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,xt(e))):m.resolve())}zi(t,e){if($f(e))return m.resolve(null);let r=xt(e);return this.indexManager.getIndexType(t,r).next(i=>i===0?null:(e.limit!==null&&i===1&&(e=lo(e,null,"F"),r=xt(e)),this.indexManager.getDocumentsMatchingTarget(t,r).next(s=>{let o=k(...s);return this.Gi.getDocuments(t,o).next(a=>this.indexManager.getMinOffset(t,r).next(u=>{let c=this.Yi(e,a);return this.Zi(e,c,o,u.readTime)?this.zi(t,lo(e,null,"F")):this.Xi(t,c,e,u)}))})))}ji(t,e,r,i){return $f(e)||i.isEqual(P.min())?m.resolve(null):this.Gi.getDocuments(t,r).next(s=>{let o=this.Yi(e,s);return this.Zi(e,o,r,i)?m.resolve(null):(er()<=te.DEBUG&&y("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),nr(e)),this.Xi(t,o,e,Nm(i,-1)).next(a=>a))})}Yi(t,e){let r=new W(tg(t));return e.forEach((i,s)=>{Wi(t,s)&&(r=r.add(s))}),r}Zi(t,e,r,i){if(t.limit===null)return!1;if(r.size!==e.size)return!0;let s=t.limitType==="F"?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Hi(t,e,r){return er()<=te.DEBUG&&y("QueryEngine","Using full collection scan to execute query:",nr(e)),this.Gi.getDocumentsMatchingQuery(t,e,zt.min(),r)}Xi(t,e,r,i){return this.Gi.getDocumentsMatchingQuery(t,r,i).next(s=>(e.forEach(o=>{s=s.insert(o.key,o)}),s))}};var Fc=class{constructor(t,e,r,i){this.persistence=t,this.es=e,this.serializer=i,this.ts=new Y(D),this.ns=new he(s=>Tn(s),Ki),this.rs=new Map,this.ss=t.getRemoteDocumentCache(),this.qr=t.getTargetCache(),this.Kr=t.getBundleCache(),this.os(r)}os(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new To(this.ss,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ss.setIndexManager(this.indexManager),this.es.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.ts))}};function Ng(n,t,e,r){return new Fc(n,t,e,r)}function Fg(n,t){return p(this,null,function*(){let e=A(n);return yield e.persistence.runTransaction("Handle user change","readonly",r=>{let i;return e.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,e.os(t),e.mutationQueue.getAllMutationBatches(r))).next(s=>{let o=[],a=[],u=k();for(let c of i){o.push(c.batchId);for(let l of c.mutations)u=u.add(l.key)}for(let c of s){a.push(c.batchId);for(let l of c.mutations)u=u.add(l.key)}return e.localDocuments.getDocuments(r,u).next(c=>({_s:c,removedBatchIds:o,addedBatchIds:a}))})})})}function rv(n,t){let e=A(n);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=t.batch.keys(),s=e.ss.newChangeBuffer({trackRemovals:!0});return function(a,u,c,l){let h=c.batch,d=h.keys(),f=m.resolve();return d.forEach(E=>{f=f.next(()=>l.getEntry(u,E)).next(v=>{let w=c.docVersions.get(E);b(w!==null),v.version.compareTo(w)<0&&(h.applyToRemoteDocument(v,c),v.isValidDocument()&&(v.setReadTime(c.commitVersion),l.addEntry(v)))})}),f.next(()=>a.mutationQueue.removeMutationBatch(u,h))}(e,r,t,s).next(()=>s.apply(r)).next(()=>e.mutationQueue.performConsistencyCheck(r)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(r,i,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let u=k();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(u=u.add(a.batch.mutations[c].key));return u}(t))).next(()=>e.localDocuments.getDocuments(r,i))})}function Mg(n){let t=A(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.qr.getLastRemoteSnapshotVersion(e))}function iv(n,t){let e=A(n),r=t.snapshotVersion,i=e.ts;return e.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=e.ss.newChangeBuffer({trackRemovals:!0});i=e.ts;let a=[];t.targetChanges.forEach((l,h)=>{let d=i.get(h);if(!d)return;a.push(e.qr.removeMatchingKeys(s,l.removedDocuments,h).next(()=>e.qr.addMatchingKeys(s,l.addedDocuments,h)));let f=d.withSequenceNumber(s.currentSequenceNumber);t.targetMismatches.get(h)!==null?f=f.withResumeToken(yt.EMPTY_BYTE_STRING,P.min()).withLastLimboFreeSnapshotVersion(P.min()):l.resumeToken.approximateByteSize()>0&&(f=f.withResumeToken(l.resumeToken,r)),i=i.insert(h,f),function(v,w,C){return v.resumeToken.approximateByteSize()===0||w.snapshotVersion.toMicroseconds()-v.snapshotVersion.toMicroseconds()>=3e8?!0:C.addedDocuments.size+C.modifiedDocuments.size+C.removedDocuments.size>0}(d,f,l)&&a.push(e.qr.updateTargetData(s,f))});let u=Nt(),c=k();if(t.documentUpdates.forEach(l=>{t.resolvedLimboDocuments.has(l)&&a.push(e.persistence.referenceDelegate.updateLimboDocument(s,l))}),a.push(Og(s,o,t.documentUpdates).next(l=>{u=l.us,c=l.cs})),!r.isEqual(P.min())){let l=e.qr.getLastRemoteSnapshotVersion(s).next(h=>e.qr.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(l)}return m.waitFor(a).next(()=>o.apply(s)).next(()=>e.localDocuments.getLocalViewOfDocuments(s,u,c)).next(()=>u)}).then(s=>(e.ts=i,s))}function Og(n,t,e){let r=k(),i=k();return e.forEach(s=>r=r.add(s)),t.getEntries(n,r).next(s=>{let o=Nt();return e.forEach((a,u)=>{let c=s.get(a);u.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),u.isNoDocument()&&u.version.isEqual(P.min())?(t.removeEntry(a,u.readTime),o=o.insert(a,u)):!c.isValidDocument()||u.version.compareTo(c.version)>0||u.version.compareTo(c.version)===0&&c.hasPendingWrites?(t.addEntry(u),o=o.insert(a,u)):y("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",u.version)}),{us:o,cs:i}})}function sv(n,t){let e=A(n);return e.persistence.runTransaction("Get next mutation batch","readonly",r=>(t===void 0&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t)))}function wr(n,t){let e=A(n);return e.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return e.qr.getTargetData(r,t).next(s=>s?(i=s,m.resolve(i)):e.qr.allocateTargetId(r).next(o=>(i=new _r(t,o,"TargetPurposeListen",r.currentSequenceNumber),e.qr.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=e.ts.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(e.ts=e.ts.insert(r.targetId,r),e.ns.set(t,r.targetId)),r})}function vr(n,t,e){return p(this,null,function*(){let r=A(n),i=r.ts.get(t),s=e?"readwrite":"readwrite-primary";try{e||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!Xe(o))throw o;y("LocalStore",`Failed to update sequence numbers for target ${t}: ${o}`)}r.ts=r.ts.remove(t),r.ns.delete(i.target)})}function bo(n,t,e){let r=A(n),i=P.min(),s=k();return r.persistence.runTransaction("Execute query","readwrite",o=>function(u,c,l){let h=A(u),d=h.ns.get(l);return d!==void 0?m.resolve(h.ts.get(d)):h.qr.getTargetData(c,l)}(r,o,xt(t)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.qr.getMatchingKeysForTargetId(o,a.targetId).next(u=>{s=u})}).next(()=>r.es.getDocumentsMatchingQuery(o,t,e?i:P.min(),e?s:k())).next(a=>(Bg(r,Zm(t),a),{documents:a,ls:s})))}function Lg(n,t){let e=A(n),r=A(e.qr),i=e.ts.get(t);return i?Promise.resolve(i.target):e.persistence.runTransaction("Get target data","readonly",s=>r._t(s,t).next(o=>o?o.target:null))}function qg(n,t){let e=A(n),r=e.rs.get(t)||P.min();return e.persistence.runTransaction("Get new document changes","readonly",i=>e.ss.getAllFromCollectionGroup(i,t,Nm(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(Bg(e,t,i),i))}function Bg(n,t,e){let r=n.rs.get(t)||P.min();e.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.rs.set(t,r)}function ov(n,t,e,r){return p(this,null,function*(){let i=A(n),s=k(),o=Nt();for(let c of e){let l=t.hs(c.metadata.name);c.document&&(s=s.add(l));let h=t.Ps(c);h.setReadTime(t.Is(c.metadata.readTime)),o=o.insert(l,h)}let a=i.ss.newChangeBuffer({trackRemovals:!0}),u=yield wr(i,function(l){return xt(br(U.fromString(`__bundle__/docs/${l}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",c=>Og(c,a,o).next(l=>(a.apply(c),l)).next(l=>i.qr.removeMatchingKeysForTargetId(c,u.targetId).next(()=>i.qr.addMatchingKeys(c,s,u.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(c,l.us,l.cs)).next(()=>l.us)))})}function av(r,i){return p(this,arguments,function*(n,t,e=k()){let s=yield wr(n,xt(xl(t.bundledQuery))),o=A(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let u=ot(t.readTime);if(s.snapshotVersion.compareTo(u)>=0)return o.Kr.saveNamedQuery(a,t);let c=s.withResumeToken(yt.EMPTY_BYTE_STRING,u);return o.ts=o.ts.insert(c.targetId,c),o.qr.updateTargetData(a,c).next(()=>o.qr.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.qr.addMatchingKeys(a,e,s.targetId)).next(()=>o.Kr.saveNamedQuery(a,t))})})}function vm(n,t){return`firestore_clients_${n}_${t}`}function Im(n,t,e){let r=`firestore_mutations_${n}_${e}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function Au(n,t){return`firestore_targets_${n}_${t}`}var Po=class n{constructor(t,e,r,i){this.user=t,this.batchId=e,this.state=r,this.error=i}static Ts(t,e,r){let i=JSON.parse(r),s,o=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string",o&&(s=new _(i.error.code,i.error.message))),o?new n(t,e,i.state,s):(it("SharedClientState",`Failed to parse mutation state for ID '${e}': ${r}`),null)}Es(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},yi=class n{constructor(t,e,r){this.targetId=t,this.state=e,this.error=r}static Ts(t,e){let r=JSON.parse(e),i,s=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return s&&r.error&&(s=typeof r.error.message=="string"&&typeof r.error.code=="string",s&&(i=new _(r.error.code,r.error.message))),s?new n(t,r.state,i):(it("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}Es(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},Co=class n{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static Ts(t,e){let r=JSON.parse(e),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=Pl();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=Om(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(t,s):(it("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}},Mc=class n{constructor(t,e){this.clientId=t,this.onlineState=e}static Ts(t){let e=JSON.parse(t);return typeof e=="object"&&["Unknown","Online","Offline"].indexOf(e.onlineState)!==-1&&typeof e.clientId=="string"?new n(e.clientId,e.onlineState):(it("SharedClientState",`Failed to parse online state: ${t}`),null)}},Mi=class{constructor(){this.activeTargetIds=Pl()}ds(t){this.activeTargetIds=this.activeTargetIds.add(t)}As(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Es(){let t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}},wi=class{constructor(t,e,r,i,s){this.window=t,this.si=e,this.persistenceKey=r,this.Rs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Vs=this.fs.bind(this),this.gs=new Y(D),this.started=!1,this.ps=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ys=vm(this.persistenceKey,this.Rs),this.ws=function(u){return`firestore_sequence_number_${u}`}(this.persistenceKey),this.gs=this.gs.insert(this.Rs,new Mi),this.Ss=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.bs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ds=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.Cs=function(u){return`firestore_online_state_${u}`}(this.persistenceKey),this.vs=function(u){return`firestore_bundle_loaded_v2_${u}`}(this.persistenceKey),this.window.addEventListener("storage",this.Vs)}static D(t){return!(!t||!t.localStorage)}start(){return p(this,null,function*(){let t=yield this.syncEngine.Bi();for(let r of t){if(r===this.Rs)continue;let i=this.getItem(vm(this.persistenceKey,r));if(i){let s=Co.Ts(r,i);s&&(this.gs=this.gs.insert(s.clientId,s))}}this.Fs();let e=this.storage.getItem(this.Cs);if(e){let r=this.Ms(e);r&&this.xs(r)}for(let r of this.ps)this.fs(r);this.ps=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(t){this.setItem(this.ws,JSON.stringify(t))}getAllActiveQueryTargets(){return this.Os(this.gs)}isActiveQueryTarget(t){let e=!1;return this.gs.forEach((r,i)=>{i.activeTargetIds.has(t)&&(e=!0)}),e}addPendingMutation(t){this.Ns(t,"pending")}updateMutationState(t,e,r){this.Ns(t,e,r),this.Bs(t)}addLocalQueryTarget(t){let e="not-current";if(this.isActiveQueryTarget(t)){let r=this.storage.getItem(Au(this.persistenceKey,t));if(r){let i=yi.Ts(t,r);i&&(e=i.state)}}return this.Ls.ds(t),this.Fs(),e}removeLocalQueryTarget(t){this.Ls.As(t),this.Fs()}isLocalQueryTarget(t){return this.Ls.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(Au(this.persistenceKey,t))}updateQueryState(t,e,r){this.ks(t,e,r)}handleUserChange(t,e,r){e.forEach(i=>{this.Bs(i)}),this.currentUser=t,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(t){this.qs(t)}notifyBundleLoaded(t){this.Qs(t)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Vs),this.removeItem(this.ys),this.started=!1)}getItem(t){let e=this.storage.getItem(t);return y("SharedClientState","READ",t,e),e}setItem(t,e){y("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){y("SharedClientState","REMOVE",t),this.storage.removeItem(t)}fs(t){let e=t;if(e.storageArea===this.storage){if(y("SharedClientState","EVENT",e.key,e.newValue),e.key===this.ys)return void it("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.si.enqueueRetryable(()=>p(this,null,function*(){if(this.started){if(e.key!==null){if(this.Ss.test(e.key)){if(e.newValue==null){let r=this.Ks(e.key);return this.$s(r,null)}{let r=this.Us(e.key,e.newValue);if(r)return this.$s(r.clientId,r)}}else if(this.bs.test(e.key)){if(e.newValue!==null){let r=this.Ws(e.key,e.newValue);if(r)return this.Gs(r)}}else if(this.Ds.test(e.key)){if(e.newValue!==null){let r=this.zs(e.key,e.newValue);if(r)return this.js(r)}}else if(e.key===this.Cs){if(e.newValue!==null){let r=this.Ms(e.newValue);if(r)return this.xs(r)}}else if(e.key===this.ws){let r=function(s){let o=Ot._e;if(s!=null)try{let a=JSON.parse(s);b(typeof a=="number"),o=a}catch(a){it("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(e.newValue);r!==Ot._e&&this.sequenceNumberHandler(r)}else if(e.key===this.vs){let r=this.Hs(e.newValue);yield Promise.all(r.map(i=>this.syncEngine.Js(i)))}}}else this.ps.push(e)}))}}get Ls(){return this.gs.get(this.Rs)}Fs(){this.setItem(this.ys,this.Ls.Es())}Ns(t,e,r){let i=new Po(this.currentUser,t,e,r),s=Im(this.persistenceKey,this.currentUser,t);this.setItem(s,i.Es())}Bs(t){let e=Im(this.persistenceKey,this.currentUser,t);this.removeItem(e)}qs(t){let e={clientId:this.Rs,onlineState:t};this.storage.setItem(this.Cs,JSON.stringify(e))}ks(t,e,r){let i=Au(this.persistenceKey,t),s=new yi(t,e,r);this.setItem(i,s.Es())}Qs(t){let e=JSON.stringify(Array.from(t));this.setItem(this.vs,e)}Ks(t){let e=this.Ss.exec(t);return e?e[1]:null}Us(t,e){let r=this.Ks(t);return Co.Ts(r,e)}Ws(t,e){let r=this.bs.exec(t),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return Po.Ts(new ht(s),i,e)}zs(t,e){let r=this.Ds.exec(t),i=Number(r[1]);return yi.Ts(i,e)}Ms(t){return Mc.Ts(t)}Hs(t){return JSON.parse(t)}Gs(t){return p(this,null,function*(){if(t.user.uid===this.currentUser.uid)return this.syncEngine.Ys(t.batchId,t.state,t.error);y("SharedClientState",`Ignoring mutation for non-active user ${t.user.uid}`)})}js(t){return this.syncEngine.Zs(t.targetId,t.state,t.error)}$s(t,e){let r=e?this.gs.insert(t,e):this.gs.remove(t),i=this.Os(this.gs),s=this.Os(r),o=[],a=[];return s.forEach(u=>{i.has(u)||o.push(u)}),i.forEach(u=>{s.has(u)||a.push(u)}),this.syncEngine.Xs(o,a).then(()=>{this.gs=r})}xs(t){this.gs.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}Os(t){let e=Pl();return t.forEach((r,i)=>{e=e.unionWith(i.activeTargetIds)}),e}},xo=class{constructor(){this.eo=new Mi,this.no={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,r){}addLocalQueryTarget(t){return this.eo.ds(t),this.no[t]||"not-current"}updateQueryState(t,e,r){this.no[t]=e}removeLocalQueryTarget(t){this.eo.As(t)}isLocalQueryTarget(t){return this.eo.activeTargetIds.has(t)}clearQueryState(t){delete this.no[t]}getAllActiveQueryTargets(){return this.eo.activeTargetIds}isActiveQueryTarget(t){return this.eo.activeTargetIds.has(t)}start(){return this.eo=new Mi,Promise.resolve()}handleUserChange(t,e,r){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}};var Oc=class{ro(t){}shutdown(){}};var Do=class{constructor(){this.io=()=>this.so(),this.oo=()=>this._o(),this.ao=[],this.uo()}ro(t){this.ao.push(t)}shutdown(){window.removeEventListener("online",this.io),window.removeEventListener("offline",this.oo)}uo(){window.addEventListener("online",this.io),window.addEventListener("offline",this.oo)}so(){y("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let t of this.ao)t(0)}_o(){y("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let t of this.ao)t(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var $s=null;function Su(){return $s===null?$s=function(){return 268435456+Math.round(2147483648*Math.random())}():$s++,"0x"+$s.toString(16)}var uv={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var Lc=class{constructor(t){this.co=t.co,this.lo=t.lo}ho(t){this.Po=t}Io(t){this.To=t}onMessage(t){this.Eo=t}close(){this.lo()}send(t){this.co(t)}Ao(){this.Po()}Ro(t){this.To(t)}Vo(t){this.Eo(t)}};var St="WebChannelConnection",qc=class extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let r=e.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.mo=r+"://"+e.host,this.fo=`projects/${i}/databases/${s}`,this.po=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get yo(){return!1}wo(e,r,i,s,o){let a=Su(),u=this.So(e,r);y("RestConnection",`Sending RPC '${e}' ${a}:`,u,i);let c={"google-cloud-resource-prefix":this.fo,"x-goog-request-params":this.po};return this.bo(c,s,o),this.Do(e,u,c,i).then(l=>(y("RestConnection",`Received RPC '${e}' ${a}: `,l),l),l=>{throw jt("RestConnection",`RPC '${e}' ${a} failed with error: `,l,"url: ",u,"request:",i),l})}Co(e,r,i,s,o,a){return this.wo(e,r,i,s,o)}bo(e,r,i){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Rr}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>e[o]=s),i&&i.headers.forEach((s,o)=>e[o]=s)}So(e,r){let i=uv[e];return`${this.mo}/v1/${r}:${i}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Do(t,e,r,i){let s=Su();return new Promise((o,a)=>{let u=new xf;u.setWithCredentials(!0),u.listenOnce(Pf.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case js.NO_ERROR:let l=u.getResponseJson();y(St,`XHR for RPC '${t}' ${s} received:`,JSON.stringify(l)),o(l);break;case js.TIMEOUT:y(St,`RPC '${t}' ${s} timed out`),a(new _(g.DEADLINE_EXCEEDED,"Request time out"));break;case js.HTTP_ERROR:let h=u.getStatus();if(y(St,`RPC '${t}' ${s} failed with status:`,h,"response text:",u.getResponseText()),h>0){let d=u.getResponseJson();Array.isArray(d)&&(d=d[0]);let f=d?.error;if(f&&f.status&&f.message){let E=function(w){let C=w.toLowerCase().replace(/_/g,"-");return Object.values(g).indexOf(C)>=0?C:g.UNKNOWN}(f.status);a(new _(E,f.message))}else a(new _(g.UNKNOWN,"Server responded with status "+u.getStatus()))}else a(new _(g.UNAVAILABLE,"Connection failed."));break;default:S()}}finally{y(St,`RPC '${t}' ${s} completed.`)}});let c=JSON.stringify(i);y(St,`RPC '${t}' ${s} sending request:`,i),u.send(e,"POST",c,r,15)})}vo(t,e,r){let i=Su(),s=[this.mo,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=Rf(),a=bf(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(u.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(u.useFetchStreams=!0),this.bo(u.initMessageHeaders,e,r),u.encodeInitMessageHeaders=!0;let l=s.join("");y(St,`Creating RPC '${t}' stream ${i}: ${l}`,u);let h=o.createWebChannel(l,u),d=!1,f=!1,E=new Lc({co:w=>{f?y(St,`Not sending because RPC '${t}' stream ${i} is closed:`,w):(d||(y(St,`Opening RPC '${t}' stream ${i} transport.`),h.open(),d=!0),y(St,`RPC '${t}' stream ${i} sending:`,w),h.send(w))},lo:()=>h.close()}),v=(w,C,V)=>{w.listen(C,R=>{try{V(R)}catch(N){setTimeout(()=>{throw N},0)}})};return v(h,ui.EventType.OPEN,()=>{f||y(St,`RPC '${t}' stream ${i} transport opened.`)}),v(h,ui.EventType.CLOSE,()=>{f||(f=!0,y(St,`RPC '${t}' stream ${i} transport closed`),E.Ro())}),v(h,ui.EventType.ERROR,w=>{f||(f=!0,jt(St,`RPC '${t}' stream ${i} transport errored:`,w),E.Ro(new _(g.UNAVAILABLE,"The operation could not be completed")))}),v(h,ui.EventType.MESSAGE,w=>{var C;if(!f){let V=w.data[0];b(!!V);let R=V,N=R.error||((C=R[0])===null||C===void 0?void 0:C.error);if(N){y(St,`RPC '${t}' stream ${i} received error:`,N);let F=N.status,B=function(o_){let yh=ct[o_];if(yh!==void 0)return mg(yh)}(F),at=N.message;B===void 0&&(B=g.INTERNAL,at="Unknown error status: "+F+" with message "+N.message),f=!0,E.Ro(new _(B,at)),h.close()}else y(St,`RPC '${t}' stream ${i} received:`,V),E.Vo(V)}}),v(a,Cf.STAT_EVENT,w=>{w.stat===Iu.PROXY?y(St,`RPC '${t}' stream ${i} detected buffering proxy`):w.stat===Iu.NOPROXY&&y(St,`RPC '${t}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{E.Ao()},0),E}};function Ug(){return typeof window<"u"?window:null}function Xs(){return typeof document<"u"?document:null}function Qi(n){return new rc(n,!0)}var Oi=class{constructor(t,e,r=1e3,i=1.5,s=6e4){this.si=t,this.timerId=e,this.Fo=r,this.Mo=i,this.xo=s,this.Oo=0,this.No=null,this.Bo=Date.now(),this.reset()}reset(){this.Oo=0}Lo(){this.Oo=this.xo}ko(t){this.cancel();let e=Math.floor(this.Oo+this.qo()),r=Math.max(0,Date.now()-this.Bo),i=Math.max(0,e-r);i>0&&y("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Oo} ms, delay with jitter: ${e} ms, last attempt: ${r} ms ago)`),this.No=this.si.enqueueAfterDelay(this.timerId,i,()=>(this.Bo=Date.now(),t())),this.Oo*=this.Mo,this.Oo<this.Fo&&(this.Oo=this.Fo),this.Oo>this.xo&&(this.Oo=this.xo)}Qo(){this.No!==null&&(this.No.skipDelay(),this.No=null)}cancel(){this.No!==null&&(this.No.cancel(),this.No=null)}qo(){return(Math.random()-.5)*this.Oo}};var ko=class{constructor(t,e,r,i,s,o,a,u){this.si=t,this.Ko=r,this.$o=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.Uo=0,this.Wo=null,this.Go=null,this.stream=null,this.zo=new Oi(t,e)}jo(){return this.state===1||this.state===5||this.Ho()}Ho(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Jo()}stop(){return p(this,null,function*(){this.jo()&&(yield this.close(0))})}Yo(){this.state=0,this.zo.reset()}Zo(){this.Ho()&&this.Wo===null&&(this.Wo=this.si.enqueueAfterDelay(this.Ko,6e4,()=>this.Xo()))}e_(t){this.t_(),this.stream.send(t)}Xo(){return p(this,null,function*(){if(this.Ho())return this.close(0)})}t_(){this.Wo&&(this.Wo.cancel(),this.Wo=null)}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}close(t,e){return p(this,null,function*(){this.t_(),this.n_(),this.zo.cancel(),this.Uo++,t!==4?this.zo.reset():e&&e.code===g.RESOURCE_EXHAUSTED?(it(e.toString()),it("Using maximum backoff delay to prevent overloading the backend."),this.zo.Lo()):e&&e.code===g.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.r_(),this.stream.close(),this.stream=null),this.state=t,yield this.listener.Io(e)})}r_(){}auth(){this.state=1;let t=this.i_(this.Uo),e=this.Uo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Uo===e&&this.s_(r,i)},r=>{t(()=>{let i=new _(g.UNKNOWN,"Fetching auth token failed: "+r.message);return this.o_(i)})})}s_(t,e){let r=this.i_(this.Uo);this.stream=this.__(t,e),this.stream.ho(()=>{r(()=>(this.state=2,this.Go=this.si.enqueueAfterDelay(this.$o,1e4,()=>(this.Ho()&&(this.state=3),Promise.resolve())),this.listener.ho()))}),this.stream.Io(i=>{r(()=>this.o_(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Jo(){this.state=5,this.zo.ko(()=>p(this,null,function*(){this.state=0,this.start()}))}o_(t){return y("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}i_(t){return e=>{this.si.enqueueAndForget(()=>this.Uo===t?e():(y("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Bc=class extends ko{constructor(t,e,r,i,s,o){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,r,i,o),this.serializer=s}__(t,e){return this.connection.vo("Listen",t,e)}onMessage(t){this.zo.reset();let e=$w(this.serializer,t),r=function(s){if(!("targetChange"in s))return P.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?P.min():o.readTime?ot(o.readTime):P.min()}(t);return this.listener.a_(e,r)}u_(t){let e={};e.database=ki(this.serializer),e.addTarget=function(s,o){let a,u=o.target;if(a=uo(u)?{documents:Ig(s,u)}:{query:Eg(s,u)},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=pg(s,o.resumeToken);let c=ic(s,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(P.min())>0){a.readTime=pr(s,o.snapshotVersion.toTimestamp());let c=ic(s,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,t);let r=Qw(this.serializer,t);r&&(e.labels=r),this.e_(e)}c_(t){let e={};e.database=ki(this.serializer),e.removeTarget=t,this.e_(e)}},Uc=class extends ko{constructor(t,e,r,i,s,o){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,r,i,o),this.serializer=s,this.l_=!1}get h_(){return this.l_}start(){this.l_=!1,this.lastStreamToken=void 0,super.start()}r_(){this.l_&&this.P_([])}__(t,e){return this.connection.vo("Write",t,e)}onMessage(t){if(b(!!t.streamToken),this.lastStreamToken=t.streamToken,this.l_){this.zo.reset();let e=Ww(t.writeResults,t.commitTime),r=ot(t.commitTime);return this.listener.I_(r,e)}return b(!t.writeResults||t.writeResults.length===0),this.l_=!0,this.listener.T_()}E_(){let t={};t.database=ki(this.serializer),this.e_(t)}P_(t){let e={streamToken:this.lastStreamToken,writes:t.map(r=>Vi(this.serializer,r))};this.e_(e)}};var jc=class extends class{}{constructor(t,e,r,i){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=r,this.serializer=i,this.d_=!1}A_(){if(this.d_)throw new _(g.FAILED_PRECONDITION,"The client has already been terminated.")}wo(t,e,r){return this.A_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.wo(t,e,r,i,s)).catch(i=>{throw i.name==="FirebaseError"?(i.code===g.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new _(g.UNKNOWN,i.toString())})}Co(t,e,r,i){return this.A_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Co(t,e,r,s,o,i)).catch(s=>{throw s.name==="FirebaseError"?(s.code===g.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new _(g.UNKNOWN,s.toString())})}terminate(){this.d_=!0}};var zc=class{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.V_=0,this.m_=null,this.f_=!0}g_(){this.V_===0&&(this.p_("Unknown"),this.m_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.m_=null,this.y_("Backend didn't respond within 10 seconds."),this.p_("Offline"),Promise.resolve())))}w_(t){this.state==="Online"?this.p_("Unknown"):(this.V_++,this.V_>=1&&(this.S_(),this.y_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.p_("Offline")))}set(t){this.S_(),this.V_=0,t==="Online"&&(this.f_=!1),this.p_(t)}p_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}y_(t){let e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.f_?(it(e),this.f_=!1):y("OnlineStateTracker",e)}S_(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}};var Gc=class{constructor(t,e,r,i,s){this.localStore=t,this.datastore=e,this.asyncQueue=r,this.remoteSyncer={},this.b_=[],this.D_=new Map,this.C_=new Set,this.v_=[],this.F_=s,this.F_.ro(o=>{r.enqueueAndForget(()=>p(this,null,function*(){Je(this)&&(y("RemoteStore","Restarting streams for network reachability change."),yield function(u){return p(this,null,function*(){let c=A(u);c.C_.add(4),yield Pr(c),c.M_.set("Unknown"),c.C_.delete(4),yield Hi(c)})}(this))}))}),this.M_=new zc(r,i)}};function Hi(n){return p(this,null,function*(){if(Je(n))for(let t of n.v_)yield t(!0)})}function Pr(n){return p(this,null,function*(){for(let t of n.v_)yield t(!1)})}function Xo(n,t){let e=A(n);e.D_.has(t.targetId)||(e.D_.set(t.targetId,t),Fl(e)?Nl(e):xr(e).Ho()&&Vl(e,t))}function Li(n,t){let e=A(n),r=xr(e);e.D_.delete(t),r.Ho()&&jg(e,t),e.D_.size===0&&(r.Ho()?r.Zo():Je(e)&&e.M_.set("Unknown"))}function Vl(n,t){if(n.x_.Oe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(P.min())>0){let e=n.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}xr(n).u_(t)}function jg(n,t){n.x_.Oe(t),xr(n).c_(t)}function Nl(n){n.x_=new nc({getRemoteKeysForTarget:t=>n.remoteSyncer.getRemoteKeysForTarget(t),_t:t=>n.D_.get(t)||null,nt:()=>n.datastore.serializer.databaseId}),xr(n).start(),n.M_.g_()}function Fl(n){return Je(n)&&!xr(n).jo()&&n.D_.size>0}function Je(n){return A(n).C_.size===0}function zg(n){n.x_=void 0}function cv(n){return p(this,null,function*(){n.D_.forEach((t,e)=>{Vl(n,t)})})}function lv(n,t){return p(this,null,function*(){zg(n),Fl(n)?(n.M_.w_(t),Nl(n)):n.M_.set("Unknown")})}function hv(n,t,e){return p(this,null,function*(){if(n.M_.set("Online"),t instanceof fo&&t.state===2&&t.cause)try{yield function(i,s){return p(this,null,function*(){let o=s.cause;for(let a of s.targetIds)i.D_.has(a)&&(yield i.remoteSyncer.rejectListen(a,o),i.D_.delete(a),i.x_.removeTarget(a))})}(n,t)}catch(r){y("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),r),yield Vo(n,r)}else if(t instanceof cr?n.x_.$e(t):t instanceof ho?n.x_.Je(t):n.x_.Ge(t),!e.isEqual(P.min()))try{let r=yield Mg(n.localStore);e.compareTo(r)>=0&&(yield function(s,o){let a=s.x_.it(o);return a.targetChanges.forEach((u,c)=>{if(u.resumeToken.approximateByteSize()>0){let l=s.D_.get(c);l&&s.D_.set(c,l.withResumeToken(u.resumeToken,o))}}),a.targetMismatches.forEach((u,c)=>{let l=s.D_.get(u);if(!l)return;s.D_.set(u,l.withResumeToken(yt.EMPTY_BYTE_STRING,l.snapshotVersion)),jg(s,u);let h=new _r(l.target,u,c,l.sequenceNumber);Vl(s,h)}),s.remoteSyncer.applyRemoteEvent(a)}(n,e))}catch(r){y("RemoteStore","Failed to raise snapshot:",r),yield Vo(n,r)}})}function Vo(n,t,e){return p(this,null,function*(){if(!Xe(t))throw t;n.C_.add(1),yield Pr(n),n.M_.set("Offline"),e||(e=()=>Mg(n.localStore)),n.asyncQueue.enqueueRetryable(()=>p(this,null,function*(){y("RemoteStore","Retrying IndexedDB access"),yield e(),n.C_.delete(1),yield Hi(n)}))})}function Gg(n,t){return t().catch(e=>Vo(n,e,t))}function Cr(n){return p(this,null,function*(){let t=A(n),e=He(t),r=t.b_.length>0?t.b_[t.b_.length-1].batchId:-1;for(;dv(t);)try{let i=yield sv(t.localStore,r);if(i===null){t.b_.length===0&&e.Zo();break}r=i.batchId,fv(t,i)}catch(i){yield Vo(t,i)}Kg(t)&&$g(t)})}function dv(n){return Je(n)&&n.b_.length<10}function fv(n,t){n.b_.push(t);let e=He(n);e.Ho()&&e.h_&&e.P_(t.mutations)}function Kg(n){return Je(n)&&!He(n).jo()&&n.b_.length>0}function $g(n){He(n).start()}function mv(n){return p(this,null,function*(){He(n).E_()})}function gv(n){return p(this,null,function*(){let t=He(n);for(let e of n.b_)t.P_(e.mutations)})}function pv(n,t,e){return p(this,null,function*(){let r=n.b_.shift(),i=Zu.from(r,t,e);yield Gg(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Cr(n)})}function _v(n,t){return p(this,null,function*(){t&&He(n).h_&&(yield function(r,i){return p(this,null,function*(){if(function(o){return fg(o)&&o!==g.ABORTED}(i.code)){let s=r.b_.shift();He(r).Yo(),yield Gg(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield Cr(r)}})}(n,t)),Kg(n)&&$g(n)})}function Em(n,t){return p(this,null,function*(){let e=A(n);e.asyncQueue.verifyOperationInProgress(),y("RemoteStore","RemoteStore received new credentials");let r=Je(e);e.C_.add(3),yield Pr(e),r&&e.M_.set("Unknown"),yield e.remoteSyncer.handleCredentialChange(t),e.C_.delete(3),yield Hi(e)})}function Kc(n,t){return p(this,null,function*(){let e=A(n);t?(e.C_.delete(2),yield Hi(e)):t||(e.C_.add(2),yield Pr(e),e.M_.set("Unknown"))})}function xr(n){return n.O_||(n.O_=function(e,r,i){let s=A(e);return s.A_(),new Bc(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{ho:cv.bind(null,n),Io:lv.bind(null,n),a_:hv.bind(null,n)}),n.v_.push(t=>p(this,null,function*(){t?(n.O_.Yo(),Fl(n)?Nl(n):n.M_.set("Unknown")):(yield n.O_.stop(),zg(n))}))),n.O_}function He(n){return n.N_||(n.N_=function(e,r,i){let s=A(e);return s.A_(),new Uc(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{ho:mv.bind(null,n),Io:_v.bind(null,n),T_:gv.bind(null,n),I_:pv.bind(null,n)}),n.v_.push(t=>p(this,null,function*(){t?(n.N_.Yo(),yield Cr(n)):(yield n.N_.stop(),n.b_.length>0&&(y("RemoteStore",`Stopping write stream with ${n.b_.length} pending writes`),n.b_=[]))}))),n.N_}var $c=class n{constructor(t,e,r,i,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new dt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,r,i,s){let o=Date.now()+r,a=new n(t,e,o,i,s);return a.start(r),a}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new _(g.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Dr(n,t){if(it("AsyncQueue",`${t}: ${n}`),Xe(n))return new _(g.UNAVAILABLE,`${t}: ${n}`);throw n}var No=class n{constructor(t){this.comparator=t?(e,r)=>t(e,r)||I.comparator(e.key,r.key):(e,r)=>I.comparator(e.key,r.key),this.keyedMap=fi(),this.sortedSet=new Y(this.comparator)}static emptySet(t){return new n(t.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){let e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,r)=>(t(e),!1))}add(t){let e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){let e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof n)||this.size!==t.size)return!1;let e=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();for(;e.hasNext();){let i=e.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let t=[];return this.forEach(e=>{t.push(e.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){let r=new n;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=e,r}};var Fo=class{constructor(){this.B_=new Y(I.comparator)}track(t){let e=t.doc.key,r=this.B_.get(e);r?t.type!==0&&r.type===3?this.B_=this.B_.insert(e,t):t.type===3&&r.type!==1?this.B_=this.B_.insert(e,{type:r.type,doc:t.doc}):t.type===2&&r.type===2?this.B_=this.B_.insert(e,{type:2,doc:t.doc}):t.type===2&&r.type===0?this.B_=this.B_.insert(e,{type:0,doc:t.doc}):t.type===1&&r.type===0?this.B_=this.B_.remove(e):t.type===1&&r.type===2?this.B_=this.B_.insert(e,{type:1,doc:r.doc}):t.type===0&&r.type===1?this.B_=this.B_.insert(e,{type:2,doc:t.doc}):S():this.B_=this.B_.insert(e,t)}L_(){let t=[];return this.B_.inorderTraversal((e,r)=>{t.push(r)}),t}},Ir=class n{constructor(t,e,r,i,s,o,a,u,c){this.query=t,this.docs=e,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u,this.hasCachedResults=c}static fromInitialDocuments(t,e,r,i,s){let o=[];return e.forEach(a=>{o.push({type:0,doc:a})}),new n(t,e,No.emptySet(e),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&$i(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;let e=this.docChanges,r=t.docChanges;if(e.length!==r.length)return!1;for(let i=0;i<e.length;i++)if(e[i].type!==r[i].type||!e[i].doc.isEqual(r[i].doc))return!1;return!0}};var Wc=class{constructor(){this.k_=void 0,this.listeners=[]}},Qc=class{constructor(){this.queries=new he(t=>Jm(t),$i),this.onlineState="Unknown",this.q_=new Set}};function Ml(n,t){return p(this,null,function*(){let e=A(n),r=t.query,i=!1,s=e.queries.get(r);if(s||(i=!0,s=new Wc),i)try{s.k_=yield e.onListen(r)}catch(o){let a=Dr(o,`Initialization of query '${nr(t.query)}' failed`);return void t.onError(a)}e.queries.set(r,s),s.listeners.push(t),t.Q_(e.onlineState),s.k_&&t.K_(s.k_)&&Ll(e)})}function Ol(n,t){return p(this,null,function*(){let e=A(n),r=t.query,i=!1,s=e.queries.get(r);if(s){let o=s.listeners.indexOf(t);o>=0&&(s.listeners.splice(o,1),i=s.listeners.length===0)}if(i)return e.queries.delete(r),e.onUnlisten(r)})}function yv(n,t){let e=A(n),r=!1;for(let i of t){let s=i.query,o=e.queries.get(s);if(o){for(let a of o.listeners)a.K_(i)&&(r=!0);o.k_=i}}r&&Ll(e)}function wv(n,t,e){let r=A(n),i=r.queries.get(t);if(i)for(let s of i.listeners)s.onError(e);r.queries.delete(t)}function Ll(n){n.q_.forEach(t=>{t.next()})}var qi=class{constructor(t,e,r){this.query=t,this.U_=e,this.W_=!1,this.G_=null,this.onlineState="Unknown",this.options=r||{}}K_(t){if(!this.options.includeMetadataChanges){let r=[];for(let i of t.docChanges)i.type!==3&&r.push(i);t=new Ir(t.query,t.docs,t.oldDocs,r,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.W_?this.z_(t)&&(this.U_.next(t),e=!0):this.j_(t,this.onlineState)&&(this.H_(t),e=!0),this.G_=t,e}onError(t){this.U_.error(t)}Q_(t){this.onlineState=t;let e=!1;return this.G_&&!this.W_&&this.j_(this.G_,t)&&(this.H_(this.G_),e=!0),e}j_(t,e){if(!t.fromCache)return!0;let r=e!=="Offline";return(!this.options.J_||!r)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}z_(t){if(t.docChanges.length>0)return!0;let e=this.G_&&this.G_.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}H_(t){t=Ir.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.W_=!0,this.U_.next(t)}};var Hc=class{constructor(t,e){this.Y_=t,this.byteLength=e}Z_(){return"metadata"in this.Y_}};var Mo=class{constructor(t){this.serializer=t}hs(t){return ae(this.serializer,t)}Ps(t){return t.metadata.exists?vg(this.serializer,t.document,!1):ft.newNoDocument(this.hs(t.metadata.name),this.Is(t.metadata.readTime))}Is(t){return ot(t)}},Yc=class{constructor(t,e,r){this.X_=t,this.localStore=e,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Wg(t)}ea(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;if(t.Y_.namedQuery)this.queries.push(t.Y_.namedQuery);else if(t.Y_.documentMetadata){this.documents.push({metadata:t.Y_.documentMetadata}),t.Y_.documentMetadata.exists||++e;let r=U.fromString(t.Y_.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else t.Y_.document&&(this.documents[this.documents.length-1].document=t.Y_.document,++e);return e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null}ta(t){let e=new Map,r=new Mo(this.serializer);for(let i of t)if(i.metadata.queries){let s=r.hs(i.metadata.name);for(let o of i.metadata.queries){let a=(e.get(o)||k()).add(s);e.set(o,a)}}return e}complete(){return p(this,null,function*(){let t=yield ov(this.localStore,new Mo(this.serializer),this.documents,this.X_.id),e=this.ta(this.documents);for(let r of this.queries)yield av(this.localStore,r,e.get(r.name));return this.progress.taskState="Success",{progress:this.progress,na:this.collectionGroups,ra:t}})}};function Wg(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var Oo=class{constructor(t){this.key=t}},Lo=class{constructor(t){this.key=t}},qo=class{constructor(t,e){this.query=t,this.ia=e,this.sa=null,this.hasCachedResults=!1,this.current=!1,this.oa=k(),this.mutatedKeys=k(),this._a=tg(t),this.aa=new No(this._a)}get ua(){return this.ia}ca(t,e){let r=e?e.la:new Fo,i=e?e.aa:this.aa,s=e?e.mutatedKeys:this.mutatedKeys,o=i,a=!1,u=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((l,h)=>{let d=i.get(l),f=Wi(this.query,h)?h:null,E=!!d&&this.mutatedKeys.has(d.key),v=!!f&&(f.hasLocalMutations||this.mutatedKeys.has(f.key)&&f.hasCommittedMutations),w=!1;d&&f?d.data.isEqual(f.data)?E!==v&&(r.track({type:3,doc:f}),w=!0):this.ha(d,f)||(r.track({type:2,doc:f}),w=!0,(u&&this._a(f,u)>0||c&&this._a(f,c)<0)&&(a=!0)):!d&&f?(r.track({type:0,doc:f}),w=!0):d&&!f&&(r.track({type:1,doc:d}),w=!0,(u||c)&&(a=!0)),w&&(f?(o=o.add(f),s=v?s.add(l):s.delete(l)):(o=o.delete(l),s=s.delete(l)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let l=this.query.limitType==="F"?o.last():o.first();o=o.delete(l.key),s=s.delete(l.key),r.track({type:1,doc:l})}return{aa:o,la:r,Zi:a,mutatedKeys:s}}ha(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,r,i){let s=this.aa;this.aa=t.aa,this.mutatedKeys=t.mutatedKeys;let o=t.la.L_();o.sort((l,h)=>function(f,E){let v=w=>{switch(w){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return S()}};return v(f)-v(E)}(l.type,h.type)||this._a(l.doc,h.doc)),this.Pa(r),i=i!=null&&i;let a=e&&!i?this.Ia():[],u=this.oa.size===0&&this.current&&!i?1:0,c=u!==this.sa;return this.sa=u,o.length!==0||c?{snapshot:new Ir(this.query,t.aa,s,o,t.mutatedKeys,u===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),Ta:a}:{Ta:a}}Q_(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({aa:this.aa,la:new Fo,mutatedKeys:this.mutatedKeys,Zi:!1},!1)):{Ta:[]}}Ea(t){return!this.ia.has(t)&&!!this.aa.has(t)&&!this.aa.get(t).hasLocalMutations}Pa(t){t&&(t.addedDocuments.forEach(e=>this.ia=this.ia.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.ia=this.ia.delete(e)),this.current=t.current)}Ia(){if(!this.current)return[];let t=this.oa;this.oa=k(),this.aa.forEach(r=>{this.Ea(r.key)&&(this.oa=this.oa.add(r.key))});let e=[];return t.forEach(r=>{this.oa.has(r)||e.push(new Lo(r))}),this.oa.forEach(r=>{t.has(r)||e.push(new Oo(r))}),e}da(t){this.ia=t.ls,this.oa=k();let e=this.ca(t.documents);return this.applyChanges(e,!0)}Aa(){return Ir.fromInitialDocuments(this.query,this.aa,this.mutatedKeys,this.sa===0,this.hasCachedResults)}},Xc=class{constructor(t,e,r){this.query=t,this.targetId=e,this.view=r}},Jc=class{constructor(t){this.key=t,this.Ra=!1}},Zc=class{constructor(t,e,r,i,s,o){this.localStore=t,this.remoteStore=e,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Va={},this.ma=new he(a=>Jm(a),$i),this.fa=new Map,this.ga=new Set,this.pa=new Y(I.comparator),this.ya=new Map,this.wa=new Fi,this.Sa={},this.ba=new Map,this.Da=yr.Nn(),this.onlineState="Unknown",this.Ca=void 0}get isPrimaryClient(){return this.Ca===!0}};function vv(n,t){return p(this,null,function*(){let e=zl(n),r,i,s=e.ma.get(t);if(s)r=s.targetId,e.sharedClientState.addLocalQueryTarget(r),i=s.view.Aa();else{let o=yield wr(e.localStore,xt(t)),a=e.sharedClientState.addLocalQueryTarget(o.targetId);r=o.targetId,i=yield ql(e,t,r,a==="current",o.resumeToken),e.isPrimaryClient&&Xo(e.remoteStore,o)}return i})}function ql(n,t,e,r,i){return p(this,null,function*(){n.va=(h,d,f)=>function(v,w,C,V){return p(this,null,function*(){let R=w.view.ca(C);R.Zi&&(R=yield bo(v.localStore,w.query,!1).then(({documents:at})=>w.view.ca(at,R)));let N=V&&V.targetChanges.get(w.targetId),F=V&&V.targetMismatches.get(w.targetId)!=null,B=w.view.applyChanges(R,v.isPrimaryClient,N,F);return tl(v,w.targetId,B.Ta),B.snapshot})}(n,h,d,f);let s=yield bo(n.localStore,t,!0),o=new qo(t,s.ls),a=o.ca(s.documents),u=xi.createSynthesizedTargetChangeForCurrentChange(e,r&&n.onlineState!=="Offline",i),c=o.applyChanges(a,n.isPrimaryClient,u);tl(n,e,c.Ta);let l=new Xc(t,e,o);return n.ma.set(t,l),n.fa.has(e)?n.fa.get(e).push(t):n.fa.set(e,[t]),c.snapshot})}function Iv(n,t){return p(this,null,function*(){let e=A(n),r=e.ma.get(t),i=e.fa.get(r.targetId);if(i.length>1)return e.fa.set(r.targetId,i.filter(s=>!$i(s,t))),void e.ma.delete(t);e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(r.targetId),e.sharedClientState.isActiveQueryTarget(r.targetId)||(yield vr(e.localStore,r.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(r.targetId),Li(e.remoteStore,r.targetId),Er(e,r.targetId)}).catch(Ye))):(Er(e,r.targetId),yield vr(e.localStore,r.targetId,!0))})}function Ev(n,t,e){return p(this,null,function*(){let r=Gl(n);try{let i=yield function(o,a){let u=A(o),c=Z.now(),l=a.reduce((f,E)=>f.add(E.key),k()),h,d;return u.persistence.runTransaction("Locally write mutations","readwrite",f=>{let E=Nt(),v=k();return u.ss.getEntries(f,l).next(w=>{E=w,E.forEach((C,V)=>{V.isValidDocument()||(v=v.add(C))})}).next(()=>u.localDocuments.getOverlayedDocuments(f,E)).next(w=>{h=w;let C=[];for(let V of a){let R=qw(V,h.get(V.key).overlayedDocument);R!=null&&C.push(new Ht(V.key,R,Km(R.value.mapValue),nt.exists(!0)))}return u.mutationQueue.addMutationBatch(f,c,C,a)}).next(w=>{d=w;let C=w.applyToLocalDocumentSet(h,v);return u.documentOverlayCache.saveOverlays(f,w.batchId,C)})}).then(()=>({batchId:d.batchId,changes:ng(h)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,u){let c=o.Sa[o.currentUser.toKey()];c||(c=new Y(D)),c=c.insert(a,u),o.Sa[o.currentUser.toKey()]=c}(r,i.batchId,e),yield Te(r,i.changes),yield Cr(r.remoteStore)}catch(i){let s=Dr(i,"Failed to persist write");e.reject(s)}})}function Qg(n,t){return p(this,null,function*(){let e=A(n);try{let r=yield iv(e.localStore,t);t.targetChanges.forEach((i,s)=>{let o=e.ya.get(s);o&&(b(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.Ra=!0:i.modifiedDocuments.size>0?b(o.Ra):i.removedDocuments.size>0&&(b(o.Ra),o.Ra=!1))}),yield Te(e,r,t)}catch(r){yield Ye(r)}})}function Tm(n,t,e){let r=A(n);if(r.isPrimaryClient&&e===0||!r.isPrimaryClient&&e===1){let i=[];r.ma.forEach((s,o)=>{let a=o.view.Q_(t);a.snapshot&&i.push(a.snapshot)}),function(o,a){let u=A(o);u.onlineState=a;let c=!1;u.queries.forEach((l,h)=>{for(let d of h.listeners)d.Q_(a)&&(c=!0)}),c&&Ll(u)}(r.eventManager,t),i.length&&r.Va.a_(i),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function Tv(n,t,e){return p(this,null,function*(){let r=A(n);r.sharedClientState.updateQueryState(t,"rejected",e);let i=r.ya.get(t),s=i&&i.key;if(s){let o=new Y(I.comparator);o=o.insert(s,ft.newNoDocument(s,P.min()));let a=k().add(s),u=new Ci(P.min(),new Map,new Y(D),o,a);yield Qg(r,u),r.pa=r.pa.remove(s),r.ya.delete(t),jl(r)}else yield vr(r.localStore,t,!1).then(()=>Er(r,t,e)).catch(Ye)})}function Av(n,t){return p(this,null,function*(){let e=A(n),r=t.batch.batchId;try{let i=yield rv(e.localStore,t);Ul(e,r,null),Bl(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),yield Te(e,i)}catch(i){yield Ye(i)}})}function Sv(n,t,e){return p(this,null,function*(){let r=A(n);try{let i=yield function(o,a){let u=A(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let l;return u.mutationQueue.lookupMutationBatch(c,a).next(h=>(b(h!==null),l=h.keys(),u.mutationQueue.removeMutationBatch(c,h))).next(()=>u.mutationQueue.performConsistencyCheck(c)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(c,l,a)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,l)).next(()=>u.localDocuments.getDocuments(c,l))})}(r.localStore,t);Ul(r,t,e),Bl(r,t),r.sharedClientState.updateMutationState(t,"rejected",e),yield Te(r,i)}catch(i){yield Ye(i)}})}function Rv(n,t){return p(this,null,function*(){let e=A(n);Je(e.remoteStore)||y("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield function(o){let a=A(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",u=>a.mutationQueue.getHighestUnacknowledgedBatchId(u))}(e.localStore);if(r===-1)return void t.resolve();let i=e.ba.get(r)||[];i.push(t),e.ba.set(r,i)}catch(r){let i=Dr(r,"Initialization of waitForPendingWrites() operation failed");t.reject(i)}})}function Bl(n,t){(n.ba.get(t)||[]).forEach(e=>{e.resolve()}),n.ba.delete(t)}function Ul(n,t,e){let r=A(n),i=r.Sa[r.currentUser.toKey()];if(i){let s=i.get(t);s&&(e?s.reject(e):s.resolve(),i=i.remove(t)),r.Sa[r.currentUser.toKey()]=i}}function Er(n,t,e=null){n.sharedClientState.removeLocalQueryTarget(t);for(let r of n.fa.get(t))n.ma.delete(r),e&&n.Va.Fa(r,e);n.fa.delete(t),n.isPrimaryClient&&n.wa.Rr(t).forEach(r=>{n.wa.containsKey(r)||Hg(n,r)})}function Hg(n,t){n.ga.delete(t.path.canonicalString());let e=n.pa.get(t);e!==null&&(Li(n.remoteStore,e),n.pa=n.pa.remove(t),n.ya.delete(e),jl(n))}function tl(n,t,e){for(let r of e)r instanceof Oo?(n.wa.addReference(r.key,t),bv(n,r)):r instanceof Lo?(y("SyncEngine","Document no longer in limbo: "+r.key),n.wa.removeReference(r.key,t),n.wa.containsKey(r.key)||Hg(n,r.key)):S()}function bv(n,t){let e=t.key,r=e.path.canonicalString();n.pa.get(e)||n.ga.has(r)||(y("SyncEngine","New document in limbo: "+e),n.ga.add(r),jl(n))}function jl(n){for(;n.ga.size>0&&n.pa.size<n.maxConcurrentLimboResolutions;){let t=n.ga.values().next().value;n.ga.delete(t);let e=new I(U.fromString(t)),r=n.Da.next();n.ya.set(r,new Jc(e)),n.pa=n.pa.insert(e,r),Xo(n.remoteStore,new _r(xt(br(e.path)),r,"TargetPurposeLimboResolution",Ot._e))}}function Te(n,t,e){return p(this,null,function*(){let r=A(n),i=[],s=[],o=[];r.ma.isEmpty()||(r.ma.forEach((a,u)=>{o.push(r.va(u,t,e).then(c=>{if((c||e)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(u.targetId,c?.fromCache?"not-current":"current"),c){i.push(c);let l=Vc.Qi(u.targetId,c);s.push(l)}}))}),yield Promise.all(o),r.Va.a_(i),yield function(u,c){return p(this,null,function*(){let l=A(u);try{yield l.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>m.forEach(c,d=>m.forEach(d.ki,f=>l.persistence.referenceDelegate.addReference(h,d.targetId,f)).next(()=>m.forEach(d.qi,f=>l.persistence.referenceDelegate.removeReference(h,d.targetId,f)))))}catch(h){if(!Xe(h))throw h;y("LocalStore","Failed to update sequence numbers: "+h)}for(let h of c){let d=h.targetId;if(!h.fromCache){let f=l.ts.get(d),E=f.snapshotVersion,v=f.withLastLimboFreeSnapshotVersion(E);l.ts=l.ts.insert(d,v)}}})}(r.localStore,s))})}function Pv(n,t){return p(this,null,function*(){let e=A(n);if(!e.currentUser.isEqual(t)){y("SyncEngine","User change. New user:",t.toKey());let r=yield Fg(e.localStore,t);e.currentUser=t,function(s,o){s.ba.forEach(a=>{a.forEach(u=>{u.reject(new _(g.CANCELLED,o))})}),s.ba.clear()}(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),yield Te(e,r._s)}})}function Cv(n,t){let e=A(n),r=e.ya.get(t);if(r&&r.Ra)return k().add(r.key);{let i=k(),s=e.fa.get(t);if(!s)return i;for(let o of s){let a=e.ma.get(o);i=i.unionWith(a.view.ua)}return i}}function xv(n,t){return p(this,null,function*(){let e=A(n),r=yield bo(e.localStore,t.query,!0),i=t.view.da(r);return e.isPrimaryClient&&tl(e,t.targetId,i.Ta),i})}function Dv(n,t){return p(this,null,function*(){let e=A(n);return qg(e.localStore,t).then(r=>Te(e,r))})}function kv(n,t,e,r){return p(this,null,function*(){let i=A(n),s=yield function(a,u){let c=A(a),l=A(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",h=>l.Cn(h,u).next(d=>d?c.localDocuments.getDocuments(h,d):m.resolve(null)))}(i.localStore,t);s!==null?(e==="pending"?yield Cr(i.remoteStore):e==="acknowledged"||e==="rejected"?(Ul(i,t,r||null),Bl(i,t),function(a,u){A(A(a).mutationQueue).Fn(u)}(i.localStore,t)):S(),yield Te(i,s)):y("SyncEngine","Cannot apply mutation batch with id: "+t)})}function Vv(n,t){return p(this,null,function*(){let e=A(n);if(zl(e),Gl(e),t===!0&&e.Ca!==!0){let r=e.sharedClientState.getAllActiveQueryTargets(),i=yield Am(e,r.toArray());e.Ca=!0,yield Kc(e.remoteStore,!0);for(let s of i)Xo(e.remoteStore,s)}else if(t===!1&&e.Ca!==!1){let r=[],i=Promise.resolve();e.fa.forEach((s,o)=>{e.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(Er(e,o),vr(e.localStore,o,!0))),Li(e.remoteStore,o)}),yield i,yield Am(e,r),function(o){let a=A(o);a.ya.forEach((u,c)=>{Li(a.remoteStore,c)}),a.wa.Vr(),a.ya=new Map,a.pa=new Y(I.comparator)}(e),e.Ca=!1,yield Kc(e.remoteStore,!1)}})}function Am(n,t,e){return p(this,null,function*(){let r=A(n),i=[],s=[];for(let o of t){let a,u=r.fa.get(o);if(u&&u.length!==0){a=yield wr(r.localStore,xt(u[0]));for(let c of u){let l=r.ma.get(c),h=yield xv(r,l);h.snapshot&&s.push(h.snapshot)}}else{let c=yield Lg(r.localStore,o);a=yield wr(r.localStore,c),yield ql(r,Yg(c),o,!1,a.resumeToken)}i.push(a)}return r.Va.a_(s),i})}function Yg(n){return Xm(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function Nv(n){return function(e){return A(A(e).persistence).Bi()}(A(n).localStore)}function Fv(n,t,e,r){return p(this,null,function*(){let i=A(n);if(i.Ca)return void y("SyncEngine","Ignoring unexpected query state notification.");let s=i.fa.get(t);if(s&&s.length>0)switch(e){case"current":case"not-current":{let o=yield qg(i.localStore,Zm(s[0])),a=Ci.createSynthesizedRemoteEventForCurrentChange(t,e==="current",yt.EMPTY_BYTE_STRING);yield Te(i,o,a);break}case"rejected":yield vr(i.localStore,t,!0),Er(i,t,r);break;default:S()}})}function Mv(n,t,e){return p(this,null,function*(){let r=zl(n);if(r.Ca){for(let i of t){if(r.fa.has(i)){y("SyncEngine","Adding an already active target "+i);continue}let s=yield Lg(r.localStore,i),o=yield wr(r.localStore,s);yield ql(r,Yg(s),o.targetId,!1,o.resumeToken),Xo(r.remoteStore,o)}for(let i of e)r.fa.has(i)&&(yield vr(r.localStore,i,!1).then(()=>{Li(r.remoteStore,i),Er(r,i)}).catch(Ye))}})}function zl(n){let t=A(n);return t.remoteStore.remoteSyncer.applyRemoteEvent=Qg.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Cv.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Tv.bind(null,t),t.Va.a_=yv.bind(null,t.eventManager),t.Va.Fa=wv.bind(null,t.eventManager),t}function Gl(n){let t=A(n);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Av.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Sv.bind(null,t),t}function Ov(n,t,e){let r=A(n);(function(s,o,a){return p(this,null,function*(){try{let u=yield o.getMetadata();if(yield function(f,E){let v=A(f),w=ot(E.createTime);return v.persistence.runTransaction("hasNewerBundle","readonly",C=>v.Kr.getBundleMetadata(C,E.id)).then(C=>!!C&&C.createTime.compareTo(w)>=0)}(s.localStore,u))return yield o.close(),a._completeWith(function(f){return{taskState:"Success",documentsLoaded:f.totalDocuments,bytesLoaded:f.totalBytes,totalDocuments:f.totalDocuments,totalBytes:f.totalBytes}}(u)),Promise.resolve(new Set);a._updateProgress(Wg(u));let c=new Yc(u,s.localStore,o.serializer),l=yield o.Ma();for(;l;){let d=yield c.ea(l);d&&a._updateProgress(d),l=yield o.Ma()}let h=yield c.complete();return yield Te(s,h.ra,void 0),yield function(f,E){let v=A(f);return v.persistence.runTransaction("Save bundle","readwrite",w=>v.Kr.saveBundleMetadata(w,E))}(s.localStore,u),a._completeWith(h.progress),Promise.resolve(h.na)}catch(u){return jt("SyncEngine",`Loading bundle failed with ${u}`),a._failWith(u),Promise.resolve(new Set)}})})(r,t,e).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}var Bi=class{constructor(){this.synchronizeTabs=!1}initialize(t){return p(this,null,function*(){this.serializer=Qi(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),yield this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)})}createGarbageCollectionScheduler(t,e){return null}createIndexBackfillerScheduler(t,e){return null}createLocalStore(t){return Ng(this.persistence,new Ro,t.initialUser,this.serializer)}createPersistence(t){return new Ao(So.jr,this.serializer)}createSharedClientState(t){return new xo}terminate(){return p(this,null,function*(){this.gcScheduler&&this.gcScheduler.stop(),yield this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var Bo=class n extends Bi{constructor(t,e,r){super(),this.xa=t,this.cacheSizeBytes=e,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(t){return p(this,null,function*(){yield ha(n.prototype,this,"initialize").call(this,t),yield this.xa.initialize(this,t),yield Gl(this.xa.syncEngine),yield Cr(this.xa.remoteStore),yield this.persistence.mi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(t){return Ng(this.persistence,new Ro,t.initialUser,this.serializer)}createGarbageCollectionScheduler(t,e){let r=this.persistence.referenceDelegate.garbageCollector;return new yc(r,t.asyncQueue,e)}createIndexBackfillerScheduler(t,e){let r=new Ou(e,this.persistence);return new Mu(t.asyncQueue,r)}createPersistence(t){let e=kl(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Ut.withCacheSize(this.cacheSizeBytes):Ut.DEFAULT;return new kc(this.synchronizeTabs,e,t.clientId,r,t.asyncQueue,Ug(),Xs(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(t){return new xo}},el=class n extends Bo{constructor(t,e){super(t,e,!1),this.xa=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}initialize(t){return p(this,null,function*(){yield ha(n.prototype,this,"initialize").call(this,t);let e=this.xa.syncEngine;this.sharedClientState instanceof wi&&(this.sharedClientState.syncEngine={Ys:kv.bind(null,e),Zs:Fv.bind(null,e),Xs:Mv.bind(null,e),Bi:Nv.bind(null,e),Js:Dv.bind(null,e)},yield this.sharedClientState.start()),yield this.persistence.mi(r=>p(this,null,function*(){yield Vv(this.xa.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(t){let e=Ug();if(!wi.D(e))throw new _(g.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=kl(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new wi(e,t.asyncQueue,r,t.clientId,t.initialUser)}},Ui=class{initialize(t,e){return p(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Tm(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=Pv.bind(null,this.syncEngine),yield Kc(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new Qc}()}createDatastore(t){let e=Qi(t.databaseInfo.databaseId),r=function(s){return new qc(s)}(t.databaseInfo);return function(s,o,a,u){return new jc(s,o,a,u)}(t.authCredentials,t.appCheckCredentials,r,e)}createRemoteStore(t){return function(r,i,s,o,a){return new Gc(r,i,s,o,a)}(this.localStore,this.datastore,t.asyncQueue,e=>Tm(this.syncEngine,e,0),function(){return Do.D()?new Do:new Oc}())}createSyncEngine(t,e){return function(i,s,o,a,u,c,l){let h=new Zc(i,s,o,a,u,c);return l&&(h.Ca=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return function(e){return p(this,null,function*(){let r=A(e);y("RemoteStore","RemoteStore shutting down."),r.C_.add(5),yield Pr(r),r.F_.shutdown(),r.M_.set("Unknown")})}(this.remoteStore)}};function Sm(n,t=10240){let e=0;return{read(){return p(this,null,function*(){if(e<n.byteLength){let i={value:n.slice(e,e+t),done:!1};return e+=t,i}return{done:!0}})},cancel(){return p(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var Tr=class{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Oa(this.observer.next,t)}error(t){this.observer.error?this.Oa(this.observer.error,t):it("Uncaught Error in snapshot listener:",t.toString())}Na(){this.muted=!0}Oa(t,e){this.muted||setTimeout(()=>{this.muted||t(e)},0)}};var nl=class{constructor(t,e){this.Ba=t,this.serializer=e,this.metadata=new dt,this.buffer=new Uint8Array,this.La=function(){return new TextDecoder("utf-8")}(),this.ka().then(r=>{r&&r.Z_()?this.metadata.resolve(r.Y_.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.Y_)}`))},r=>this.metadata.reject(r))}close(){return this.Ba.cancel()}getMetadata(){return p(this,null,function*(){return this.metadata.promise})}Ma(){return p(this,null,function*(){return yield this.getMetadata(),this.ka()})}ka(){return p(this,null,function*(){let t=yield this.qa();if(t===null)return null;let e=this.La.decode(t),r=Number(e);isNaN(r)&&this.Qa(`length string (${e}) is not valid number`);let i=yield this.Ka(r);return new Hc(JSON.parse(i),t.length+r)})}$a(){return this.buffer.findIndex(t=>t==="{".charCodeAt(0))}qa(){return p(this,null,function*(){for(;this.$a()<0&&!(yield this.Ua()););if(this.buffer.length===0)return null;let t=this.$a();t<0&&this.Qa("Reached the end of bundle when a length string is expected.");let e=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),e})}Ka(t){return p(this,null,function*(){for(;this.buffer.length<t;)(yield this.Ua())&&this.Qa("Reached the end of bundle when more is expected.");let e=this.La.decode(this.buffer.slice(0,t));return this.buffer=this.buffer.slice(t),e})}Qa(t){throw this.Ba.cancel(),new Error(`Invalid bundle format: ${t}`)}Ua(){return p(this,null,function*(){let t=yield this.Ba.read();if(!t.done){let e=new Uint8Array(this.buffer.length+t.value.length);e.set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e}return t.done})}};var rl=class{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}lookup(t){return p(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new _(g.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");let e=yield function(i,s){return p(this,null,function*(){let o=A(i),a=ki(o.serializer)+"/documents",u={documents:s.map(d=>Di(o.serializer,d))},c=yield o.Co("BatchGetDocuments",a,u,s.length),l=new Map;c.forEach(d=>{let f=Kw(o.serializer,d);l.set(f.key.toString(),f)});let h=[];return s.forEach(d=>{let f=l.get(d.toString());b(!!f),h.push(f)}),h})}(this.datastore,t);return e.forEach(r=>this.recordVersion(r)),e})}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(r){this.lastWriteError=r}this.writtenDocs.add(t.toString())}delete(t){this.write(new Qe(t,this.precondition(t))),this.writtenDocs.add(t.toString())}commit(){return p(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;let t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,r)=>{let i=I.fromPath(r);this.mutations.push(new Ri(i,this.precondition(i)))}),yield function(r,i){return p(this,null,function*(){let s=A(r),o=ki(s.serializer)+"/documents",a={writes:i.map(u=>Vi(s.serializer,u))};yield s.wo("Commit",o,a)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw S();e=P.min()}let r=this.readVersions.get(t.key.toString());if(r){if(!e.isEqual(r))throw new _(g.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){let e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?e.isEqual(P.min())?nt.exists(!1):nt.updateTime(e):nt.none()}preconditionForUpdate(t){let e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(P.min()))throw new _(g.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return nt.updateTime(e)}return nt.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}};var il=class{constructor(t,e,r,i,s){this.asyncQueue=t,this.datastore=e,this.options=r,this.updateFunction=i,this.deferred=s,this.Wa=r.maxAttempts,this.zo=new Oi(this.asyncQueue,"transaction_retry")}run(){this.Wa-=1,this.Ga()}Ga(){this.zo.ko(()=>p(this,null,function*(){let t=new rl(this.datastore),e=this.za(t);e&&e.then(r=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.ja(i)}))}).catch(r=>{this.ja(r)})}))}za(t){try{let e=this.updateFunction(t);return!Gi(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}ja(t){this.Wa>0&&this.Ha(t)?(this.Wa-=1,this.asyncQueue.enqueueAndForget(()=>(this.Ga(),Promise.resolve()))):this.deferred.reject(t)}Ha(t){if(t.name==="FirebaseError"){let e=t.code;return e==="aborted"||e==="failed-precondition"||e==="already-exists"||!fg(e)}return!1}};var sl=class{constructor(t,e,r,i){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=r,this.databaseInfo=i,this.user=ht.UNAUTHENTICATED,this.clientId=to.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,s=>p(this,null,function*(){y("FirestoreClient","Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(r,s=>(y("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}getConfiguration(){return p(this,null,function*(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}})}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new _(g.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let t=new dt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>p(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){let r=Dr(e,"Failed to shutdown persistence");t.reject(r)}})),t.promise}};function Js(n,t){return p(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),y("FirestoreClient","Initializing OfflineComponentProvider");let e=yield n.getConfiguration();yield t.initialize(e);let r=e.initialUser;n.setCredentialChangeListener(i=>p(this,null,function*(){r.isEqual(i)||(yield Fg(t.localStore,i),r=i)})),t.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=t})}function ol(n,t){return p(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let e=yield Kl(n);y("FirestoreClient","Initializing OnlineComponentProvider");let r=yield n.getConfiguration();yield t.initialize(e,r),n.setCredentialChangeListener(i=>Em(t.remoteStore,i)),n.setAppCheckTokenChangeListener((i,s)=>Em(t.remoteStore,s)),n._onlineComponents=t})}function Xg(n){return n.name==="FirebaseError"?n.code===g.FAILED_PRECONDITION||n.code===g.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||n.code===22||n.code===20||n.code===11}function Kl(n){return p(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){y("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Js(n,n._uninitializedComponentsProvider._offline)}catch(t){let e=t;if(!Xg(e))throw e;jt("Error using user provided cache. Falling back to memory cache: "+e),yield Js(n,new Bi)}}else y("FirestoreClient","Using default OfflineComponentProvider"),yield Js(n,new Bi);return n._offlineComponents})}function Jo(n){return p(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(y("FirestoreClient","Using user provided OnlineComponentProvider"),yield ol(n,n._uninitializedComponentsProvider._online)):(y("FirestoreClient","Using default OnlineComponentProvider"),yield ol(n,new Ui))),n._onlineComponents})}function Jg(n){return Kl(n).then(t=>t.persistence)}function $l(n){return Kl(n).then(t=>t.localStore)}function Zg(n){return Jo(n).then(t=>t.remoteStore)}function Wl(n){return Jo(n).then(t=>t.syncEngine)}function Lv(n){return Jo(n).then(t=>t.datastore)}function Ar(n){return p(this,null,function*(){let t=yield Jo(n),e=t.eventManager;return e.onListen=vv.bind(null,t.syncEngine),e.onUnlisten=Iv.bind(null,t.syncEngine),e})}function qv(n){return n.asyncQueue.enqueue(()=>p(this,null,function*(){let t=yield Jg(n),e=yield Zg(n);return t.setNetworkEnabled(!0),function(i){let s=A(i);return s.C_.delete(0),Hi(s)}(e)}))}function Bv(n){return n.asyncQueue.enqueue(()=>p(this,null,function*(){let t=yield Jg(n),e=yield Zg(n);return t.setNetworkEnabled(!1),function(i){return p(this,null,function*(){let s=A(i);s.C_.add(0),yield Pr(s),s.M_.set("Offline")})}(e)}))}function Uv(n,t){let e=new dt;return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return function(i,s,o){return p(this,null,function*(){try{let a=yield function(c,l){let h=A(c);return h.persistence.runTransaction("read document","readonly",d=>h.localDocuments.getDocument(d,l))}(i,s);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new _(g.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){let u=Dr(a,`Failed to get document '${s} from cache`);o.reject(u)}})}(yield $l(n),t,e)})),e.promise}function tp(n,t,e={}){let r=new dt;return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return function(s,o,a,u,c){let l=new Tr({next:d=>{o.enqueueAndForget(()=>Ol(s,h));let f=d.docs.has(a);!f&&d.fromCache?c.reject(new _(g.UNAVAILABLE,"Failed to get document because the client is offline.")):f&&d.fromCache&&u&&u.source==="server"?c.reject(new _(g.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(d)},error:d=>c.reject(d)}),h=new qi(br(a.path),l,{includeMetadataChanges:!0,J_:!0});return Ml(s,h)}(yield Ar(n),n.asyncQueue,t,e,r)})),r.promise}function jv(n,t){let e=new dt;return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return function(i,s,o){return p(this,null,function*(){try{let a=yield bo(i,s,!0),u=new qo(s,a.ls),c=u.ca(a.documents),l=u.applyChanges(c,!1);o.resolve(l.snapshot)}catch(a){let u=Dr(a,`Failed to execute query '${s} against cache`);o.reject(u)}})}(yield $l(n),t,e)})),e.promise}function ep(n,t,e={}){let r=new dt;return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return function(s,o,a,u,c){let l=new Tr({next:d=>{o.enqueueAndForget(()=>Ol(s,h)),d.fromCache&&u.source==="server"?c.reject(new _(g.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(d)},error:d=>c.reject(d)}),h=new qi(a,l,{includeMetadataChanges:!0,J_:!0});return Ml(s,h)}(yield Ar(n),n.asyncQueue,t,e,r)})),r.promise}function zv(n,t){let e=new Tr(t);return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return function(i,s){A(i).q_.add(s),s.next()}(yield Ar(n),e)})),()=>{e.Na(),n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return function(i,s){A(i).q_.delete(s)}(yield Ar(n),e)}))}}function Gv(n,t,e,r){let i=function(o,a){let u;return u=typeof o=="string"?gg().encode(o):o,function(l,h){return new nl(l,h)}(function(l,h){if(l instanceof Uint8Array)return Sm(l,h);if(l instanceof ArrayBuffer)return Sm(new Uint8Array(l),h);if(l instanceof ReadableStream)return l.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(u),a)}(e,Qi(t));n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){Ov(yield Wl(n),i,r)}))}function Kv(n,t){return n.asyncQueue.enqueue(()=>p(this,null,function*(){return function(r,i){let s=A(r);return s.persistence.runTransaction("Get named query","readonly",o=>s.Kr.getNamedQuery(o,i))}(yield $l(n),t)}))}function np(n){let t={};return n.timeoutSeconds!==void 0&&(t.timeoutSeconds=n.timeoutSeconds),t}var Rm=new Map;function Ql(n,t,e){if(!e)throw new _(g.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${t}.`)}function Hl(n,t,e,r){if(t===!0&&r===!0)throw new _(g.INVALID_ARGUMENT,`${n} and ${e} cannot be used together.`)}function bm(n){if(!I.isDocumentKey(n))throw new _(g.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Pm(n){if(I.isDocumentKey(n))throw new _(g.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Zo(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let t=function(r){return r.constructor?r.constructor.name:null}(n);return t?`a custom ${t} object`:"an object"}}return typeof n=="function"?"a function":S()}function q(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new _(g.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let e=Zo(n);throw new _(g.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return n}function rp(n,t){if(t<=0)throw new _(g.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${t}.`)}var Uo=class{constructor(t){var e,r;if(t.host===void 0){if(t.ssl!==void 0)throw new _(g.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=(e=t.ssl)===null||e===void 0||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<1048576)throw new _(g.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}Hl("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=np((r=t.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new _(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new _(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new _(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}},bn=class{constructor(t,e,r,i){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Uo({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new _(g.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(t){if(this._settingsFrozen)throw new _(g.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Uo(t),t.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Ru;switch(r.type){case"firstParty":return new xu(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new _(g.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let r=Rm.get(e);r&&(y("ComponentProvider","Removing Datastore"),Rm.delete(e),r.terminate())}(this),Promise.resolve()}};function ip(n,t,e,r={}){var i;let s=(n=q(n,bn))._getSettings(),o=`${t}:${e}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&jt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,u;if(typeof r.mockUserToken=="string")a=r.mockUserToken,u=ht.MOCK_USER;else{a=jh(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new _(g.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new ht(c)}n._authCredentials=new bu(new Zs(a,u))}}var Et=class n{constructor(t,e,r){this.converter=e,this._query=r,this.type="query",this.firestore=t}withConverter(t){return new n(this.firestore,t,this._query)}},Q=class n{constructor(t,e,r){this.converter=e,this._key=r,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ue(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new n(this.firestore,t,this._key)}},ue=class n extends Et{constructor(t,e,r){super(t,e,br(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let t=this._path.popLast();return t.isEmpty()?null:new Q(this.firestore,null,new I(t))}withConverter(t){return new n(this.firestore,t,this._path)}};function Yl(n,t,...e){if(n=J(n),Ql("collection","path",t),n instanceof bn){let r=U.fromString(t,...e);return Pm(r),new ue(n,null,r)}{if(!(n instanceof Q||n instanceof ue))throw new _(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(U.fromString(t,...e));return Pm(r),new ue(n.firestore,null,r)}}function sp(n,t){if(n=q(n,bn),Ql("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new _(g.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Et(n,null,function(r){return new Qt(U.emptyPath(),r)}(t))}function Yi(n,t,...e){if(n=J(n),arguments.length===1&&(t=to.newId()),Ql("doc","path",t),n instanceof bn){let r=U.fromString(t,...e);return bm(r),new Q(n,null,new I(r))}{if(!(n instanceof Q||n instanceof ue))throw new _(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(U.fromString(t,...e));return bm(r),new Q(n.firestore,n instanceof ue?n.converter:null,new I(r))}}function Xl(n,t){return n=J(n),t=J(t),(n instanceof Q||n instanceof ue)&&(t instanceof Q||t instanceof ue)&&n.firestore===t.firestore&&n.path===t.path&&n.converter===t.converter}function Jl(n,t){return n=J(n),t=J(t),n instanceof Et&&t instanceof Et&&n.firestore===t.firestore&&$i(n._query,t._query)&&n.converter===t.converter}var al=class{constructor(){this.Ja=Promise.resolve(),this.Ya=[],this.Za=!1,this.Xa=[],this.eu=null,this.tu=!1,this.nu=!1,this.ru=[],this.zo=new Oi(this,"async_queue_retry"),this.iu=()=>{let e=Xs();e&&y("AsyncQueue","Visibility state changed to "+e.visibilityState),this.zo.Qo()};let t=Xs();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.iu)}get isShuttingDown(){return this.Za}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.su(),this.ou(t)}enterRestrictedMode(t){if(!this.Za){this.Za=!0,this.nu=t||!1;let e=Xs();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this.iu)}}enqueue(t){if(this.su(),this.Za)return new Promise(()=>{});let e=new dt;return this.ou(()=>this.Za&&this.nu?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Ya.push(t),this._u()))}_u(){return p(this,null,function*(){if(this.Ya.length!==0){try{yield this.Ya[0](),this.Ya.shift(),this.zo.reset()}catch(t){if(!Xe(t))throw t;y("AsyncQueue","Operation failed with retryable error: "+t)}this.Ya.length>0&&this.zo.ko(()=>this._u())}})}ou(t){let e=this.Ja.then(()=>(this.tu=!0,t().catch(r=>{this.eu=r,this.tu=!1;let i=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw it("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.tu=!1,r))));return this.Ja=e,e}enqueueAfterDelay(t,e,r){this.su(),this.ru.indexOf(t)>-1&&(e=0);let i=$c.createAndSchedule(this,t,e,r,s=>this.au(s));return this.Xa.push(i),i}su(){this.eu&&S()}verifyOperationInProgress(){}uu(){return p(this,null,function*(){let t;do t=this.Ja,yield t;while(t!==this.Ja)})}cu(t){for(let e of this.Xa)if(e.timerId===t)return!0;return!1}lu(t){return this.uu().then(()=>{this.Xa.sort((e,r)=>e.targetTimeMs-r.targetTimeMs);for(let e of this.Xa)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.uu()})}hu(t){this.ru.push(t)}au(t){let e=this.Xa.indexOf(t);this.Xa.splice(e,1)}};function ul(n){return function(e,r){if(typeof e!="object"||e===null)return!1;let i=e;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(n,["next","error","complete"])}var cl=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new dt,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,r){this._progressObserver={next:t,error:e,complete:r}}catch(t){return this._taskCompletionResolver.promise.catch(t)}then(t,e){return this._taskCompletionResolver.promise.then(t,e)}_completeWith(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)}_failWith(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)}_updateProgress(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}};var op=-1,X=class extends bn{constructor(t,e,r,i){super(t,e,r,i),this.type="firestore",this._queue=function(){return new al}(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||ap(this),this._firestoreClient.terminate()}};function mt(n){return n._firestoreClient||ap(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function ap(n){var t,e,r;let i=n._freezeSettings(),s=function(a,u,c,l){return new Lu(a,u,c,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,np(l.experimentalLongPollingOptions),l.useFetchStreams)}(n._databaseId,((t=n._app)===null||t===void 0?void 0:t.options.appId)||"",n._persistenceKey,i);n._firestoreClient=new sl(n._authCredentials,n._appCheckCredentials,n._queue,s),!((e=i.localCache)===null||e===void 0)&&e._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function up(n,t){_p(n=q(n,X));let e=mt(n);if(e._uninitializedComponentsProvider)throw new _(g.FAILED_PRECONDITION,"SDK cache is already specified.");jt("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=n._freezeSettings(),i=new Ui;return lp(e,i,new Bo(i,r.cacheSizeBytes,t?.forceOwnership))}function cp(n){_p(n=q(n,X));let t=mt(n);if(t._uninitializedComponentsProvider)throw new _(g.FAILED_PRECONDITION,"SDK cache is already specified.");jt("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=n._freezeSettings(),r=new Ui;return lp(t,r,new el(r,e.cacheSizeBytes))}function lp(n,t,e){let r=new dt;return n.asyncQueue.enqueue(()=>p(this,null,function*(){try{yield Js(n,e),yield ol(n,t),r.resolve()}catch(i){let s=i;if(!Xg(s))throw s;jt("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function hp(n){if(n._initialized&&!n._terminated)throw new _(g.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let t=new dt;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>p(this,null,function*(){try{yield function(r){return p(this,null,function*(){if(!Be.D())return Promise.resolve();let i=r+"main";yield Be.delete(i)})}(kl(n._databaseId,n._persistenceKey)),t.resolve()}catch(e){t.reject(e)}})),t.promise}function dp(n){return function(e){let r=new dt;return e.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return Rv(yield Wl(e),r)})),r.promise}(mt(n=q(n,X)))}function fp(n){return qv(mt(n=q(n,X)))}function mp(n){return Bv(mt(n=q(n,X)))}function gp(n,t){let e=mt(n=q(n,X)),r=new cl;return Gv(e,n._databaseId,t,r),r}function pp(n,t){return Kv(mt(n=q(n,X)),t).then(e=>e?new Et(n,null,e.query):null)}function _p(n){if(n._initialized||n._terminated)throw new _(g.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var de=class n{constructor(t){this._byteString=t}static fromBase64String(t){try{return new n(yt.fromBase64String(t))}catch(e){throw new _(g.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new n(yt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}};var Yt=class{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new _(g.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new st(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}};var Ie=class{constructor(t){this._methodName=t}};var Pn=class{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new _(g.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new _(g.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return D(this._lat,t._lat)||D(this._long,t._long)}};var $v=/^__.*__$/,ll=class{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return this.fieldMask!==null?new Ht(t,this.data,this.fieldMask,e,this.fieldTransforms):new We(t,this.data,e,this.fieldTransforms)}},jo=class{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return new Ht(t,this.data,this.fieldMask,e,this.fieldTransforms)}};function yp(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw S()}}var zo=class n{constructor(t,e,r,i,s,o){this.settings=t,this.databaseId=e,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.Pu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Iu(){return this.settings.Iu}Tu(t){return new n(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Eu(t){var e;let r=(e=this.path)===null||e===void 0?void 0:e.child(t),i=this.Tu({path:r,du:!1});return i.Au(t),i}Ru(t){var e;let r=(e=this.path)===null||e===void 0?void 0:e.child(t),i=this.Tu({path:r,du:!1});return i.Pu(),i}Vu(t){return this.Tu({path:void 0,du:!0})}mu(t){return Go(t,this.settings.methodName,this.settings.fu||!1,this.path,this.settings.gu)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}Pu(){if(this.path)for(let t=0;t<this.path.length;t++)this.Au(this.path.get(t))}Au(t){if(t.length===0)throw this.mu("Document fields must not be empty");if(yp(this.Iu)&&$v.test(t))throw this.mu('Document fields cannot begin and end with "__"')}},hl=class{constructor(t,e,r){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=r||Qi(t)}pu(t,e,r,i=!1){return new zo({Iu:t,methodName:e,gu:r,path:st.emptyPath(),du:!1,fu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function kn(n){let t=n._freezeSettings(),e=Qi(n._databaseId);return new hl(n._databaseId,!!t.ignoreUndefinedProperties,e)}function ta(n,t,e,r,i,s={}){let o=n.pu(s.merge||s.mergeFields?2:0,t,e,i);eh("Data must be an object, but it was:",o,r);let a=Ip(r,o),u,c;if(s.merge)u=new Lt(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){let l=[];for(let h of s.mergeFields){let d=pl(t,h,e);if(!o.contains(d))throw new _(g.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);Tp(l,d)||l.push(d)}u=new Lt(l),c=o.fieldTransforms.filter(h=>u.covers(h.field))}else u=null,c=o.fieldTransforms;return new ll(new Rt(a),u,c)}var ji=class n extends Ie{_toFieldTransform(t){if(t.Iu!==2)throw t.Iu===1?t.mu(`${this._methodName}() can only appear at the top level of your update data`):t.mu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof n}};function wp(n,t,e){return new zo({Iu:3,gu:t.settings.gu,methodName:n._methodName,du:e},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}var dl=class n extends Ie{_toFieldTransform(t){return new An(t.path,new Ke)}isEqual(t){return t instanceof n}},fl=class extends Ie{constructor(t,e){super(t),this.yu=e}_toFieldTransform(t){let e=wp(this,t,!0),r=this.yu.map(s=>Vn(s,e)),i=new we(r);return new An(t.path,i)}isEqual(t){return this===t}},ml=class extends Ie{constructor(t,e){super(t),this.yu=e}_toFieldTransform(t){let e=wp(this,t,!0),r=this.yu.map(s=>Vn(s,e)),i=new ve(r);return new An(t.path,i)}isEqual(t){return this===t}},gl=class extends Ie{constructor(t,e){super(t),this.wu=e}_toFieldTransform(t){let e=new $e(t.serializer,og(t.serializer,this.wu));return new An(t.path,e)}isEqual(t){return this===t}};function Zl(n,t,e,r){let i=n.pu(1,t,e);eh("Data must be an object, but it was:",i,r);let s=[],o=Rt.empty();Dn(r,(u,c)=>{let l=nh(t,u,e);c=J(c);let h=i.Ru(l);if(c instanceof ji)s.push(l);else{let d=Vn(c,h);d!=null&&(s.push(l),o.set(l,d))}});let a=new Lt(s);return new jo(o,a,i.fieldTransforms)}function th(n,t,e,r,i,s){let o=n.pu(1,t,e),a=[pl(t,r,e)],u=[i];if(s.length%2!=0)throw new _(g.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<s.length;d+=2)a.push(pl(t,s[d])),u.push(s[d+1]);let c=[],l=Rt.empty();for(let d=a.length-1;d>=0;--d)if(!Tp(c,a[d])){let f=a[d],E=u[d];E=J(E);let v=o.Ru(f);if(E instanceof ji)c.push(f);else{let w=Vn(E,v);w!=null&&(c.push(f),l.set(f,w))}}let h=new Lt(c);return new jo(l,h,o.fieldTransforms)}function vp(n,t,e,r=!1){return Vn(e,n.pu(r?4:3,t))}function Vn(n,t){if(Ep(n=J(n)))return eh("Unsupported field value:",t,n),Ip(n,t);if(n instanceof Ie)return function(r,i){if(!yp(i.Iu))throw i.mu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.mu(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,t),null;if(n===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),n instanceof Array){if(t.settings.du&&t.Iu!==4)throw t.mu("Nested arrays are not supported");return function(r,i){let s=[],o=0;for(let a of r){let u=Vn(a,i.Vu(o));u==null&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}}(n,t)}return function(r,i){if((r=J(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return og(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=Z.fromDate(r);return{timestampValue:pr(i.serializer,s)}}if(r instanceof Z){let s=new Z(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:pr(i.serializer,s)}}if(r instanceof Pn)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof de)return{bytesValue:pg(i.serializer,r._byteString)};if(r instanceof Q){let s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.mu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Cl(r.firestore._databaseId||i.databaseId,r._key.path)}}throw i.mu(`Unsupported field value: ${Zo(r)}`)}(n,t)}function Ip(n,t){let e={};return jm(n)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Dn(n,(r,i)=>{let s=Vn(i,t.Eu(r));s!=null&&(e[r]=s)}),{mapValue:{fields:e}}}function Ep(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Z||n instanceof Pn||n instanceof de||n instanceof Q||n instanceof Ie)}function eh(n,t,e){if(!Ep(e)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(e)){let r=Zo(e);throw r==="an object"?t.mu(n+" a custom object"):t.mu(n+" "+r)}}function pl(n,t,e){if((t=J(t))instanceof Yt)return t._internalPath;if(typeof t=="string")return nh(n,t);throw Go("Field path arguments must be of type string or ",n,!1,void 0,e)}var Wv=new RegExp("[~\\*/\\[\\]]");function nh(n,t,e){if(t.search(Wv)>=0)throw Go(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,e);try{return new Yt(...t.split("."))._internalPath}catch{throw Go(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,e)}}function Go(n,t,e,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${t}() called with invalid data`;e&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${r}`),o&&(u+=` in document ${i}`),u+=")"),new _(g.INVALID_ARGUMENT,a+n+u)}function Tp(n,t){return n.some(e=>e.isEqual(t))}var Cn=class{constructor(t,e,r,i,s){this._firestore=t,this._userDataWriter=e,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Q(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let t=new _l(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){let e=this._document.data.field(ea("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}},_l=class extends Cn{data(){return super.data()}};function ea(n,t){return typeof t=="string"?nh(n,t):t instanceof Yt?t._internalPath:t._delegate._internalPath}function Ap(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new _(g.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var zi=class{},xn=class extends zi{};function Ae(n,t,...e){let r=[];t instanceof zi&&r.push(t),r=r.concat(e),function(s){let o=s.filter(u=>u instanceof yl).length,a=s.filter(u=>u instanceof Ko).length;if(o>1||o>0&&a>0)throw new _(g.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let i of r)n=i._apply(n);return n}var Ko=class n extends xn{constructor(t,e,r){super(),this._field=t,this._op=e,this._value=r,this.type="where"}static _create(t,e,r){return new n(t,e,r)}_apply(t){let e=this._parse(t);return Np(t._query,e),new Et(t.firestore,t.converter,Xu(t._query,e))}_parse(t){let e=kn(t.firestore);return function(s,o,a,u,c,l,h){let d;if(c.isKeyField()){if(l==="array-contains"||l==="array-contains-any")throw new _(g.INVALID_ARGUMENT,`Invalid Query. You can't perform '${l}' queries on documentId().`);if(l==="in"||l==="not-in"){xm(h,l);let f=[];for(let E of h)f.push(Cm(u,s,E));d={arrayValue:{values:f}}}else d=Cm(u,s,h)}else l!=="in"&&l!=="not-in"&&l!=="array-contains-any"||xm(h,l),d=vp(a,o,h,l==="in"||l==="not-in");return O.create(c,l,d)}(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value)}};function Sp(n,t,e){let r=t,i=ea("where",n);return Ko._create(i,r,e)}var yl=class n extends zi{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new n(t,e)}_parse(t){let e=this._queryConstraints.map(r=>r._parse(t)).filter(r=>r.getFilters().length>0);return e.length===1?e[0]:K.create(e,this._getOperator())}_apply(t){let e=this._parse(t);return e.getFilters().length===0?t:(function(i,s){let o=i,a=s.getFlattenedFilters();for(let u of a)Np(o,u),o=Xu(o,u)}(t._query,e),new Et(t.firestore,t.converter,Xu(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var wl=class n extends xn{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new n(t,e)}_apply(t){let e=function(i,s,o){if(i.startAt!==null)throw new _(g.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new _(g.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new En(s,o)}(t._query,this._field,this._direction);return new Et(t.firestore,t.converter,function(i,s){let o=i.explicitOrderBy.concat([s]);return new Qt(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(t._query,e))}};function Rp(n,t="asc"){let e=t,r=ea("orderBy",n);return wl._create(r,e)}var $o=class n extends xn{constructor(t,e,r){super(),this.type=t,this._limit=e,this._limitType=r}static _create(t,e,r){return new n(t,e,r)}_apply(t){return new Et(t.firestore,t.converter,lo(t._query,this._limit,this._limitType))}};function bp(n){return rp("limit",n),$o._create("limit",n,"F")}function Pp(n){return rp("limitToLast",n),$o._create("limitToLast",n,"L")}var Wo=class n extends xn{constructor(t,e,r){super(),this.type=t,this._docOrFields=e,this._inclusive=r}static _create(t,e,r){return new n(t,e,r)}_apply(t){let e=Vp(t,this.type,this._docOrFields,this._inclusive);return new Et(t.firestore,t.converter,function(i,s){return new Qt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(t._query,e))}};function Cp(...n){return Wo._create("startAt",n,!0)}function xp(...n){return Wo._create("startAfter",n,!1)}var Qo=class n extends xn{constructor(t,e,r){super(),this.type=t,this._docOrFields=e,this._inclusive=r}static _create(t,e,r){return new n(t,e,r)}_apply(t){let e=Vp(t,this.type,this._docOrFields,this._inclusive);return new Et(t.firestore,t.converter,function(i,s){return new Qt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(t._query,e))}};function Dp(...n){return Qo._create("endBefore",n,!1)}function kp(...n){return Qo._create("endAt",n,!0)}function Vp(n,t,e,r){if(e[0]=J(e[0]),e[0]instanceof Cn)return function(s,o,a,u,c){if(!u)throw new _(g.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);let l=[];for(let h of ur(s))if(h.field.isKeyField())l.push(In(o,u.key));else{let d=u.data.field(h.field);if(Yo(d))throw new _(g.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+h.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(d===null){let f=h.field.canonicalString();throw new _(g.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${f}' (used as the orderBy) does not exist.`)}l.push(d)}return new le(l,c)}(n._query,n.firestore._databaseId,t,e[0]._document,r);{let i=kn(n.firestore);return function(o,a,u,c,l,h){let d=o.explicitOrderBy;if(l.length>d.length)throw new _(g.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let f=[];for(let E=0;E<l.length;E++){let v=l[E];if(d[E].field.isKeyField()){if(typeof v!="string")throw new _(g.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof v}`);if(!bl(o)&&v.indexOf("/")!==-1)throw new _(g.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${v}' contains a slash.`);let w=o.path.child(U.fromString(v));if(!I.isDocumentKey(w))throw new _(g.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${w}' is not because it contains an odd number of segments.`);let C=new I(w);f.push(In(a,C))}else{let w=vp(u,c,v);f.push(w)}}return new le(f,h)}(n._query,n.firestore._databaseId,i,t,e,r)}}function Cm(n,t,e){if(typeof(e=J(e))=="string"){if(e==="")throw new _(g.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!bl(t)&&e.indexOf("/")!==-1)throw new _(g.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);let r=t.path.child(U.fromString(e));if(!I.isDocumentKey(r))throw new _(g.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return In(n,new I(r))}if(e instanceof Q)return In(n,e._key);throw new _(g.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Zo(e)}.`)}function xm(n,t){if(!Array.isArray(n)||n.length===0)throw new _(g.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Np(n,t){let e=function(i,s){for(let o of i)for(let a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(e!==null)throw e===t.op?new _(g.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new _(g.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${e.toString()}' filters.`)}var Sr=class{convertValue(t,e="none"){switch(vn(t)){case 0:return null;case 1:return t.booleanValue;case 2:return et(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(je(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw S()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){let r={};return Dn(t,(i,s)=>{r[i]=this.convertValue(s,e)}),r}convertGeoPoint(t){return new Pn(et(t.latitude),et(t.longitude))}convertArray(t,e){return(t.values||[]).map(r=>this.convertValue(r,e))}convertServerTimestamp(t,e){switch(e){case"previous":let r=Sl(t);return r==null?null:this.convertValue(r,e);case"estimate":return this.convertTimestamp(Ti(t));default:return null}}convertTimestamp(t){let e=Ue(t);return new Z(e.seconds,e.nanos)}convertDocumentKey(t,e){let r=U.fromString(t);b(Rg(r));let i=new ze(r.get(1),r.get(3)),s=new I(r.popFirst(5));return i.isEqual(e)||it(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}};function na(n,t,e){let r;return r=n?e&&(e.merge||e.mergeFields)?n.toFirestore(t,e):n.toFirestore(t):t,r}var vl=class extends Sr{constructor(t){super(),this.firestore=t}convertBytes(t){return new de(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new Q(this.firestore,null,e)}};var ye=class{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}},Gt=class extends Cn{constructor(t,e,r,i,s,o){super(t,e,r,i,o),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){let e=new Le(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){let r=this._document.data.field(ea("DocumentSnapshot.get",t));if(r!==null)return this._userDataWriter.convertValue(r,e.serverTimestamps)}}},Le=class extends Gt{data(t={}){return super.data(t)}},Xt=class{constructor(t,e,r,i){this._firestore=t,this._userDataWriter=e,this._snapshot=i,this.metadata=new ye(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach(r=>{t.call(e,new Le(this._firestore,this._userDataWriter,r.key,r,new ye(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){let e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new _(g.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>{let u=new Le(i._firestore,i._userDataWriter,a.doc.key,a.doc,new ye(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{let u=new Le(i._firestore,i._userDataWriter,a.doc.key,a.doc,new ye(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),c=-1,l=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),l=o.indexOf(a.doc.key)),{type:Qv(a.type),doc:u,oldIndex:c,newIndex:l}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}};function Qv(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return S()}}function rh(n,t){return n instanceof Gt&&t instanceof Gt?n._firestore===t._firestore&&n._key.isEqual(t._key)&&(n._document===null?t._document===null:n._document.isEqual(t._document))&&n._converter===t._converter:n instanceof Xt&&t instanceof Xt&&n._firestore===t._firestore&&Jl(n.query,t.query)&&n.metadata.isEqual(t.metadata)&&n._snapshot.isEqual(t._snapshot)}function Fp(n){n=q(n,Q);let t=q(n.firestore,X);return tp(mt(t),n._key).then(e=>ah(t,n,e))}var Ee=class extends Sr{constructor(t){super(),this.firestore=t}convertBytes(t){return new de(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new Q(this.firestore,null,e)}};function Mp(n){n=q(n,Q);let t=q(n.firestore,X),e=mt(t),r=new Ee(t);return Uv(e,n._key).then(i=>new Gt(t,r,n._key,i,new ye(i!==null&&i.hasLocalMutations,!0),n.converter))}function Op(n){n=q(n,Q);let t=q(n.firestore,X);return tp(mt(t),n._key,{source:"server"}).then(e=>ah(t,n,e))}function Lp(n){n=q(n,Et);let t=q(n.firestore,X),e=mt(t),r=new Ee(t);return Ap(n._query),ep(e,n._query).then(i=>new Xt(t,r,n,i))}function qp(n){n=q(n,Et);let t=q(n.firestore,X),e=mt(t),r=new Ee(t);return jv(e,n._query).then(i=>new Xt(t,r,n,i))}function Bp(n){n=q(n,Et);let t=q(n.firestore,X),e=mt(t),r=new Ee(t);return ep(e,n._query,{source:"server"}).then(i=>new Xt(t,r,n,i))}function ih(n,t,e){n=q(n,Q);let r=q(n.firestore,X),i=na(n.converter,t,e);return kr(r,[ta(kn(r),"setDoc",n._key,i,n.converter!==null,e).toMutation(n._key,nt.none())])}function sh(n,t,e,...r){n=q(n,Q);let i=q(n.firestore,X),s=kn(i),o;return o=typeof(t=J(t))=="string"||t instanceof Yt?th(s,"updateDoc",n._key,t,e,r):Zl(s,"updateDoc",n._key,t),kr(i,[o.toMutation(n._key,nt.exists(!0))])}function Up(n){return kr(q(n.firestore,X),[new Qe(n._key,nt.none())])}function jp(n,t){let e=q(n.firestore,X),r=Yi(n),i=na(n.converter,t);return kr(e,[ta(kn(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,nt.exists(!1))]).then(()=>r)}function oh(n,...t){var e,r,i;n=J(n);let s={includeMetadataChanges:!1},o=0;typeof t[o]!="object"||ul(t[o])||(s=t[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges};if(ul(t[o])){let h=t[o];t[o]=(e=h.next)===null||e===void 0?void 0:e.bind(h),t[o+1]=(r=h.error)===null||r===void 0?void 0:r.bind(h),t[o+2]=(i=h.complete)===null||i===void 0?void 0:i.bind(h)}let u,c,l;if(n instanceof Q)c=q(n.firestore,X),l=br(n._key.path),u={next:h=>{t[o]&&t[o](ah(c,n,h))},error:t[o+1],complete:t[o+2]};else{let h=q(n,Et);c=q(h.firestore,X),l=h._query;let d=new Ee(c);u={next:f=>{t[o]&&t[o](new Xt(c,d,h,f))},error:t[o+1],complete:t[o+2]},Ap(n._query)}return function(d,f,E,v){let w=new Tr(v),C=new qi(f,w,E);return d.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return Ml(yield Ar(d),C)})),()=>{w.Na(),d.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return Ol(yield Ar(d),C)}))}}(mt(c),l,a,u)}function zp(n,t){return zv(mt(n=q(n,X)),ul(t)?t:{next:t})}function kr(n,t){return function(r,i){let s=new dt;return r.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return Ev(yield Wl(r),i,s)})),s.promise}(mt(n),t)}function ah(n,t,e){let r=e.docs.get(t._key),i=new Ee(n);return new Gt(n,i,t._key,r,new ye(e.hasPendingWrites,e.fromCache),t.converter)}var Hv={maxAttempts:5};var Ho=class{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=kn(t)}set(t,e,r){this._verifyNotCommitted();let i=Me(t,this._firestore),s=na(i.converter,e,r),o=ta(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,nt.none())),this}update(t,e,r,...i){this._verifyNotCommitted();let s=Me(t,this._firestore),o;return o=typeof(e=J(e))=="string"||e instanceof Yt?th(this._dataReader,"WriteBatch.update",s._key,e,r,i):Zl(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(o.toMutation(s._key,nt.exists(!0))),this}delete(t){this._verifyNotCommitted();let e=Me(t,this._firestore);return this._mutations=this._mutations.concat(new Qe(e._key,nt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new _(g.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Me(n,t){if((n=J(n)).firestore!==t)throw new _(g.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var Il=class extends class{constructor(e,r){this._firestore=e,this._transaction=r,this._dataReader=kn(e)}get(e){let r=Me(e,this._firestore),i=new vl(this._firestore);return this._transaction.lookup([r._key]).then(s=>{if(!s||s.length!==1)return S();let o=s[0];if(o.isFoundDocument())return new Cn(this._firestore,i,o.key,o,r.converter);if(o.isNoDocument())return new Cn(this._firestore,i,r._key,null,r.converter);throw S()})}set(e,r,i){let s=Me(e,this._firestore),o=na(s.converter,r,i),a=ta(this._dataReader,"Transaction.set",s._key,o,s.converter!==null,i);return this._transaction.set(s._key,a),this}update(e,r,i,...s){let o=Me(e,this._firestore),a;return a=typeof(r=J(r))=="string"||r instanceof Yt?th(this._dataReader,"Transaction.update",o._key,r,i,s):Zl(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(e){let r=Me(e,this._firestore);return this._transaction.delete(r._key),this}}{constructor(t,e){super(t,e),this._firestore=t}get(t){let e=Me(t,this._firestore),r=new Ee(this._firestore);return super.get(t).then(i=>new Gt(this._firestore,r,e._key,i._document,new ye(!1,!1),e.converter))}};function Gp(n,t,e){n=q(n,X);let r=Object.assign(Object.assign({},Hv),e);return function(s){if(s.maxAttempts<1)throw new _(g.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,o,a){let u=new dt;return s.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){let c=yield Lv(s);new il(s.asyncQueue,c,a,o,u).run()})),u.promise}(mt(n),i=>t(new Il(n,i)),r)}function Kp(){return new ji("deleteField")}function $p(){return new dl("serverTimestamp")}function Wp(...n){return new fl("arrayUnion",n)}function Qp(...n){return new ml("arrayRemove",n)}function Hp(n){return new gl("increment",n)}(function(t,e=!0){(function(i){Rr=i})($h),Or(new rn("firestore",(r,{instanceIdentifier:i,options:s})=>{let o=r.getProvider("app").getImmediate(),a=new X(new Pu(r.getProvider("auth-internal")),new ku(r.getProvider("app-check-internal")),function(c,l){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new _(g.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ze(c.options.projectId,l)}(o,i),o);return s=Object.assign({useFetchStreams:e},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),Ce(kf,"4.4.0",t),Ce(kf,"4.4.0","esm2017")})();var Yv="@firebase/firestore-compat",Xv="0.3.23";function fh(n,t){if(t===void 0)return{merge:!1};if(t.mergeFields!==void 0&&t.merge!==void 0)throw new _("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return t}function Yp(){if(typeof Uint8Array>"u")throw new _("unimplemented","Uint8Arrays are not available in this environment.")}function Xp(){if(!zm())throw new _("unimplemented","Blobs are unavailable in Firestore in this environment.")}var ra=class n{constructor(t){this._delegate=t}static fromBase64String(t){return Xp(),new n(de.fromBase64String(t))}static fromUint8Array(t){return Yp(),new n(de.fromUint8Array(t))}toBase64(){return Xp(),this._delegate.toBase64()}toUint8Array(){return Yp(),this._delegate.toUint8Array()}isEqual(t){return this._delegate.isEqual(t._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function uh(n){return Jv(n,["next","error","complete"])}function Jv(n,t){if(typeof n!="object"||n===null)return!1;let e=n;for(let r of t)if(r in e&&typeof e[r]=="function")return!0;return!1}var ch=class{enableIndexedDbPersistence(t,e){return up(t._delegate,{forceOwnership:e})}enableMultiTabIndexedDbPersistence(t){return cp(t._delegate)}clearIndexedDbPersistence(t){return hp(t._delegate)}},ia=class{constructor(t,e,r){this._delegate=e,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},t instanceof ze||(this._appCompat=t)}get _databaseId(){return this._delegate._databaseId}settings(t){let e=this._delegate._getSettings();!t.merge&&e.host!==t.host&&jt("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&(t=Object.assign(Object.assign({},e),t),delete t.merge),this._delegate._setSettings(t)}useEmulator(t,e,r={}){ip(this._delegate,t,e,r)}enableNetwork(){return fp(this._delegate)}disableNetwork(){return mp(this._delegate)}enablePersistence(t){let e=!1,r=!1;return t&&(e=!!t.synchronizeTabs,r=!!t.experimentalForceOwningTab,Hl("synchronizeTabs",e,"experimentalForceOwningTab",r)),e?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return dp(this._delegate)}onSnapshotsInSync(t){return zp(this._delegate,t)}get app(){if(!this._appCompat)throw new _("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(t){try{return new Fr(this,Yl(this._delegate,t))}catch(e){throw Dt(e,"collection()","Firestore.collection()")}}doc(t){try{return new fe(this,Yi(this._delegate,t))}catch(e){throw Dt(e,"doc()","Firestore.doc()")}}collectionGroup(t){try{return new On(this,sp(this._delegate,t))}catch(e){throw Dt(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(t){return Gp(this._delegate,e=>t(new sa(this,e)))}batch(){return mt(this._delegate),new oa(new Ho(this._delegate,t=>kr(this._delegate,t)))}loadBundle(t){return gp(this._delegate,t)}namedQuery(t){return pp(this._delegate,t).then(e=>e?new On(this,e):null)}},Vr=class extends Sr{constructor(t){super(),this.firestore=t}convertBytes(t){return new ra(new de(t))}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return fe.forKey(e,this.firestore,null)}};function Zv(n){Dm(n)}var sa=class{constructor(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new Vr(t)}get(t){let e=Nn(t);return this._delegate.get(e).then(r=>new Fn(this._firestore,new Gt(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,e.converter)))}set(t,e,r){let i=Nn(t);return r?(fh("Transaction.set",r),this._delegate.set(i,e,r)):this._delegate.set(i,e),this}update(t,e,r,...i){let s=Nn(t);return arguments.length===2?this._delegate.update(s,e):this._delegate.update(s,e,r,...i),this}delete(t){let e=Nn(t);return this._delegate.delete(e),this}},oa=class{constructor(t){this._delegate=t}set(t,e,r){let i=Nn(t);return r?(fh("WriteBatch.set",r),this._delegate.set(i,e,r)):this._delegate.set(i,e),this}update(t,e,r,...i){let s=Nn(t);return arguments.length===2?this._delegate.update(s,e):this._delegate.update(s,e,r,...i),this}delete(t){let e=Nn(t);return this._delegate.delete(e),this}commit(){return this._delegate.commit()}},Nr=class n{constructor(t,e,r){this._firestore=t,this._userDataWriter=e,this._delegate=r}fromFirestore(t,e){let r=new Le(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new Mn(this._firestore,r),e??{})}toFirestore(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)}static getInstance(t,e){let r=n.INSTANCES,i=r.get(t);i||(i=new WeakMap,r.set(t,i));let s=i.get(e);return s||(s=new n(t,new Vr(t),e),i.set(e,s)),s}};Nr.INSTANCES=new WeakMap;var fe=class n{constructor(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Vr(t)}static forPath(t,e,r){if(t.length%2!==0)throw new _("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${t.canonicalString()} has ${t.length}`);return new n(e,new Q(e._delegate,r,new I(t)))}static forKey(t,e,r){return new n(e,new Q(e._delegate,r,t))}get id(){return this._delegate.id}get parent(){return new Fr(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(t){try{return new Fr(this.firestore,Yl(this._delegate,t))}catch(e){throw Dt(e,"collection()","DocumentReference.collection()")}}isEqual(t){return t=J(t),t instanceof Q?Xl(this._delegate,t):!1}set(t,e){e=fh("DocumentReference.set",e);try{return e?ih(this._delegate,t,e):ih(this._delegate,t)}catch(r){throw Dt(r,"setDoc()","DocumentReference.set()")}}update(t,e,...r){try{return arguments.length===1?sh(this._delegate,t):sh(this._delegate,t,e,...r)}catch(i){throw Dt(i,"updateDoc()","DocumentReference.update()")}}delete(){return Up(this._delegate)}onSnapshot(...t){let e=Jp(t),r=Zp(t,i=>new Fn(this.firestore,new Gt(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return oh(this._delegate,e,r)}get(t){let e;return t?.source==="cache"?e=Mp(this._delegate):t?.source==="server"?e=Op(this._delegate):e=Fp(this._delegate),e.then(r=>new Fn(this.firestore,new Gt(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(t){return new n(this.firestore,t?this._delegate.withConverter(Nr.getInstance(this.firestore,t)):this._delegate.withConverter(null))}};function Dt(n,t,e){return n.message=n.message.replace(t,e),n}function Jp(n){for(let t of n)if(typeof t=="object"&&!uh(t))return t;return{}}function Zp(n,t){var e,r;let i;return uh(n[0])?i=n[0]:uh(n[1])?i=n[1]:typeof n[0]=="function"?i={next:n[0],error:n[1],complete:n[2]}:i={next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(t(s))},error:(e=i.error)===null||e===void 0?void 0:e.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var Fn=class{constructor(t,e){this._firestore=t,this._delegate=e}get ref(){return new fe(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(t){return this._delegate.data(t)}get(t,e){return this._delegate.get(t,e)}isEqual(t){return rh(this._delegate,t._delegate)}},Mn=class extends Fn{data(t){let e=this._delegate.data(t);return this._delegate._converter||km(e!==void 0,"Document in a QueryDocumentSnapshot should exist"),e}},On=class n{constructor(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Vr(t)}where(t,e,r){try{return new n(this.firestore,Ae(this._delegate,Sp(t,e,r)))}catch(i){throw Dt(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(t,e){try{return new n(this.firestore,Ae(this._delegate,Rp(t,e)))}catch(r){throw Dt(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(t){try{return new n(this.firestore,Ae(this._delegate,bp(t)))}catch(e){throw Dt(e,"limit()","Query.limit()")}}limitToLast(t){try{return new n(this.firestore,Ae(this._delegate,Pp(t)))}catch(e){throw Dt(e,"limitToLast()","Query.limitToLast()")}}startAt(...t){try{return new n(this.firestore,Ae(this._delegate,Cp(...t)))}catch(e){throw Dt(e,"startAt()","Query.startAt()")}}startAfter(...t){try{return new n(this.firestore,Ae(this._delegate,xp(...t)))}catch(e){throw Dt(e,"startAfter()","Query.startAfter()")}}endBefore(...t){try{return new n(this.firestore,Ae(this._delegate,Dp(...t)))}catch(e){throw Dt(e,"endBefore()","Query.endBefore()")}}endAt(...t){try{return new n(this.firestore,Ae(this._delegate,kp(...t)))}catch(e){throw Dt(e,"endAt()","Query.endAt()")}}isEqual(t){return Jl(this._delegate,t._delegate)}get(t){let e;return t?.source==="cache"?e=qp(this._delegate):t?.source==="server"?e=Bp(this._delegate):e=Lp(this._delegate),e.then(r=>new Xi(this.firestore,new Xt(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...t){let e=Jp(t),r=Zp(t,i=>new Xi(this.firestore,new Xt(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return oh(this._delegate,e,r)}withConverter(t){return new n(this.firestore,t?this._delegate.withConverter(Nr.getInstance(this.firestore,t)):this._delegate.withConverter(null))}},lh=class{constructor(t,e){this._firestore=t,this._delegate=e}get type(){return this._delegate.type}get doc(){return new Mn(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},Xi=class{constructor(t,e){this._firestore=t,this._delegate=e}get query(){return new On(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(t=>new Mn(this._firestore,t))}docChanges(t){return this._delegate.docChanges(t).map(e=>new lh(this._firestore,e))}forEach(t,e){this._delegate.forEach(r=>{t.call(e,new Mn(this._firestore,r))})}isEqual(t){return rh(this._delegate,t._delegate)}},Fr=class n extends On{constructor(t,e){super(t,e),this.firestore=t,this._delegate=e}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let t=this._delegate.parent;return t?new fe(this.firestore,t):null}doc(t){try{return t===void 0?new fe(this.firestore,Yi(this._delegate)):new fe(this.firestore,Yi(this._delegate,t))}catch(e){throw Dt(e,"doc()","CollectionReference.doc()")}}add(t){return jp(this._delegate,t).then(e=>new fe(this.firestore,e))}isEqual(t){return Xl(this._delegate,t._delegate)}withConverter(t){return new n(this.firestore,t?this._delegate.withConverter(Nr.getInstance(this.firestore,t)):this._delegate.withConverter(null))}};function Nn(n){return q(n,Q)}var hh=class n{constructor(...t){this._delegate=new Yt(...t)}static documentId(){return new n(st.keyField().canonicalString())}isEqual(t){return t=J(t),t instanceof Yt?this._delegate._internalPath.isEqual(t._internalPath):!1}};var dh=class n{constructor(t){this._delegate=t}static serverTimestamp(){let t=$p();return t._methodName="FieldValue.serverTimestamp",new n(t)}static delete(){let t=Kp();return t._methodName="FieldValue.delete",new n(t)}static arrayUnion(...t){let e=Wp(...t);return e._methodName="FieldValue.arrayUnion",new n(e)}static arrayRemove(...t){let e=Qp(...t);return e._methodName="FieldValue.arrayRemove",new n(e)}static increment(t){let e=Hp(t);return e._methodName="FieldValue.increment",new n(e)}isEqual(t){return this._delegate.isEqual(t._delegate)}};var tI={Firestore:ia,GeoPoint:Pn,Timestamp:Z,Blob:ra,Transaction:sa,WriteBatch:oa,DocumentReference:fe,DocumentSnapshot:Fn,Query:On,QueryDocumentSnapshot:Mn,QuerySnapshot:Xi,CollectionReference:Fr,FieldPath:hh,FieldValue:dh,setLogLevel:Zv,CACHE_SIZE_UNLIMITED:op};function eI(n,t){n.INTERNAL.registerComponent(new rn("firestore-compat",e=>{let r=e.getProvider("app-compat").getImmediate(),i=e.getProvider("firestore").getImmediate();return t(r,i)},"PUBLIC").setServiceProps(Object.assign({},tI)))}function nI(n){eI(n,(t,e)=>new ia(t,e,new ch)),n.registerVersion(Yv,Xv)}nI(kt);function rI(n,t=Ji){return new Ln(e=>{let r;return t!=null?t.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},e)}):r=n.onSnapshot({includeMetadataChanges:!0},e),()=>{r?.()}})}function t_(n,t){return rI(n,t)}function iI(n,t){return t_(n,t).pipe(es(void 0),Zi(),gt(e=>{let[r,i]=e;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function ph(n,t){return t_(n,t).pipe(gt(e=>({payload:e,type:"query"})))}var aa=class{ref;afs;constructor(t,e){this.ref=t,this.afs=e}set(t,e){return this.ref.set(t,e)}update(t){return this.ref.update(t)}delete(){return this.ref.delete()}collection(t,e){let r=this.ref.collection(t),{ref:i,query:s}=s_(r,e);return new ca(i,s,this.afs)}snapshotChanges(){return iI(this.ref,this.afs.schedulers.outsideAngular).pipe(Vt)}valueChanges(t={}){return this.snapshotChanges().pipe(gt(({payload:e})=>t.idField?la(Ze({},e.data()),{[t.idField]:e.id}):e.data()))}get(t){return Se(this.ref.get(t)).pipe(Vt)}};function ua(n,t){return ph(n,t).pipe(es(void 0),Zi(),gt(e=>{let[r,i]=e,s=i.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((a,u)=>{let c=s.find(h=>h.doc.ref.isEqual(a.ref)),l=r?.payload.docs.find(h=>h.ref.isEqual(a.ref));c&&JSON.stringify(c.doc.metadata)===JSON.stringify(a.metadata)||!c&&l&&JSON.stringify(l.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:u,newIndex:u,type:"modified",doc:a}})}),o}))}function e_(n,t,e){return ua(n,e).pipe(ts((r,i)=>sI(r,i.map(s=>s.payload),t),[]),Eh(),gt(r=>r.map(i=>({type:i.type,payload:i}))))}function sI(n,t,e){return t.forEach(r=>{e.indexOf(r.type)>-1&&(n=oI(n,r))}),n}function mh(n,t,e,...r){let i=n.slice();return i.splice(t,e,...r),i}function oI(n,t){switch(t.type){case"added":if(!(n[t.newIndex]&&n[t.newIndex].doc.ref.isEqual(t.doc.ref)))return mh(n,t.newIndex,0,t);break;case"modified":if(n[t.oldIndex]==null||n[t.oldIndex].doc.ref.isEqual(t.doc.ref))if(t.oldIndex!==t.newIndex){let e=n.slice();return e.splice(t.oldIndex,1),e.splice(t.newIndex,0,t),e}else return mh(n,t.newIndex,1,t);break;case"removed":if(n[t.oldIndex]&&n[t.oldIndex].doc.ref.isEqual(t.doc.ref))return mh(n,t.oldIndex,1);break}return n}function n_(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var ca=class{ref;query;afs;constructor(t,e,r){this.ref=t,this.query=e,this.afs=r}stateChanges(t){let e=ua(this.query,this.afs.schedulers.outsideAngular);return t&&t.length>0&&(e=e.pipe(gt(r=>r.filter(i=>t.indexOf(i.type)>-1)))),e.pipe(es(void 0),Zi(),Mr(([r,i])=>i.length>0||!r),gt(([,r])=>r),Vt)}auditTrail(t){return this.stateChanges(t).pipe(ts((e,r)=>[...e,...r],[]))}snapshotChanges(t){let e=n_(t);return e_(this.query,e,this.afs.schedulers.outsideAngular).pipe(Vt)}valueChanges(t={}){return ph(this.query,this.afs.schedulers.outsideAngular).pipe(gt(e=>e.payload.docs.map(r=>t.idField?la(Ze({},r.data()),{[t.idField]:r.id}):r.data())),Vt)}get(t){return Se(this.query.get(t)).pipe(Vt)}add(t){return this.ref.add(t)}doc(t){return new aa(this.ref.doc(t),this.afs)}},gh=class{query;afs;constructor(t,e){this.query=t,this.afs=e}stateChanges(t){return!t||t.length===0?ua(this.query,this.afs.schedulers.outsideAngular).pipe(Vt):ua(this.query,this.afs.schedulers.outsideAngular).pipe(gt(e=>e.filter(r=>t.indexOf(r.type)>-1)),Mr(e=>e.length>0),Vt)}auditTrail(t){return this.stateChanges(t).pipe(ts((e,r)=>[...e,...r],[]))}snapshotChanges(t){let e=n_(t);return e_(this.query,e,this.afs.schedulers.outsideAngular).pipe(Vt)}valueChanges(t={}){return ph(this.query,this.afs.schedulers.outsideAngular).pipe(gt(r=>r.payload.docs.map(i=>t.idField?Ze({[t.idField]:i.id},i.data()):i.data())),Vt)}get(t){return Se(this.query.get(t)).pipe(Vt)}},r_=new bt("angularfire2.enableFirestorePersistence"),i_=new bt("angularfire2.firestore.persistenceSettings"),aI=new bt("angularfire2.firestore.settings"),uI=new bt("angularfire2.firestore.use-emulator");function s_(n,t=e=>e){return{query:t(n),ref:n}}var _h=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(e,r,i,s,o,a,u,c,l,h,d,f,E,v,w,C,V){this.schedulers=u;let R=qr(e,a,r),N=l;h&&Da(R,a,d,E,v,w,f,C),[this.firestore,this.persistenceEnabled$]=fs(`${R.name}.firestore`,"AngularFirestore",R.name,()=>{let F=a.runOutsideAngular(()=>R.firestore());if(s&&F.settings(s),N&&F.useEmulator(...N),i&&!ss(o)){let B=()=>{try{return Se(F.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(at){return typeof console<"u"&&console.warn(at),Re(!1)}};return[F,a.runOutsideAngular(B)]}else return[F,Re(!1)]},[s,N,i])}collection(e,r){let i;typeof e=="string"?i=this.firestore.collection(e):i=e;let{ref:s,query:o}=s_(i,r),a=this.schedulers.ngZone.run(()=>s);return new ca(a,o,this)}collectionGroup(e,r){let i=r||(o=>o),s=this.firestore.collectionGroup(e);return new gh(i(s),this)}doc(e){let r;typeof e=="string"?r=this.firestore.doc(e):r=e;let i=this.schedulers.ngZone.run(()=>r);return new aa(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(r){return new(r||n)(M(zn),M(Gn,8),M(r_,8),M(aI,8),M(Bn),M(Pe),M(ls),M(i_,8),M(uI,8),M(cd,8),M(Sa,8),M(Ra,8),M(ba,8),M(Pa,8),M(Ca,8),M(xa,8),M(on,8))};static \u0275prov=be({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),cT=(()=>{class n{constructor(){kt.registerVersion("angularfire",jn.full,"fst-compat")}static enablePersistence(e){return{ngModule:n,providers:[{provide:r_,useValue:!0},{provide:i_,useValue:e}]}}static \u0275fac=function(r){return new(r||n)};static \u0275mod=nn({type:n});static \u0275inj=en({providers:[_h]})}return n})();var dT=(()=>{let t=class t{constructor(r){this.db=r,this.dbPath="/content",this.contentRef=r.collection(this.dbPath)}getAll(){return this.contentRef}getById(r){return console.log("Content ID:",r),this.contentRef.doc(r).get()}create(r){return this.contentRef.add(Ze({},r))}update(r,i){return this.contentRef.doc(r).update(i)}delete(r){return this.contentRef.doc(r).delete()}searchByTitle(r){return this.db.collection(this.dbPath,i=>i.where("title",">=",r).where("title","<=",r+"\uF8FF").orderBy("title")).snapshotChanges().pipe(gt(i=>i.map(s=>{let o=s.payload.doc.id,a=s.payload.doc.data();return Ze({id:o},a)})))}getRandomDocument(){return this.db.doc("/metadata/contentCount").valueChanges().pipe(me(r=>{let i=r?.count||0,s=Math.floor(Math.random()*i);return this.db.collection(this.dbPath,o=>o.limit(1).startAt(s)).valueChanges()}),gt(r=>r.length>0?r[0]:null))}};t.\u0275fac=function(i){return new(i||t)(M(_h))},t.\u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})();export{lE as a,cT as b,dT as c,lI as d,pI as e,TI as f};
